zjs.require("image.loader",function(){zjs.extendCore({moduleImageResizeOption:{aspectRatio:!1,pressShiftToAspectRatio:!0,minWidth:50,minHeight:50,changePosition:!0,changeZindex:!0,border:!0,hideCornerTimeout:600}});var v=1,A=function(a,e){var b=zjs(a),c=b.getData("zmoduleimageresizeoption");if(c)b.setData("zmoduleimageresizeoption",zjs.extend(c,e));else{var c=zjs.clone(zjs.moduleImageResizeOption),h=b.getAttr("data-option","");zjs.isString(h)&&""!=h.trim()&&(c=zjs.extend(c,h.jsonDecode()));b.removeAttr("data-option");
"undefined"!=typeof e&&(c=zjs.extend(c,e));0>=c.minWidth&&(c.minWidth=1);0>=c.minHeight&&(c.minHeight=1);h=b.getStyle("position");"absolute"!=h&&"fixed"!=h&&(c.changePosition=!1);c.changePosition||(c.changeZindex=!1);b.setData("zmoduleimageresizeoption",c);(h=b.getAttr("src",""))&&(!1 in zjs||zjs.loadImage({image:h,onLoaded:function(e){if(0!=b.width()&&0!=b.height()){var h=b.width()/b.height();b.setData("zmoduleimageresizeoriginalratio",h);h=b.parent(!0);b.setData("zmoduleimageresizeshadowimg",zjs('<img src="'+
e.src+'" />').addClass("zimage-resize-shadowimg").appendTo(h));c.border&&(b.setData("zmoduleimageresizebordertop",zjs('<div class="zimage-resize-border brtop"></div>').appendTo(h)),b.setData("zmoduleimageresizeborderleft",zjs('<div class="zimage-resize-border brleft"></div>').appendTo(h)),b.setData("zmoduleimageresizeborderright",zjs('<div class="zimage-resize-border brright"></div>').appendTo(h)),b.setData("zmoduleimageresizeborderbottom",zjs('<div class="zimage-resize-border brbottom"></div>').appendTo(h)));
e=0;for(e=1;8>=e;e++)b.setData("zmoduleimageresizecorner"+e,zjs("<div></div>").addClass("zimage-resize-corner").addClass("c"+e).setData("zmoduleimageresizecornerindexkey",e).drag({onStart:function(b,r){var d=zjs(a);if(d.getData("zmoduleimageresizecorner1",!1)){var e=zjs(r);parseInt(e.getData("zmoduleimageresizecornerindexkey"));clearTimeout(d.getData("zmoduleimageresizehidecortimeout"));d.setData("zmoduleimageresizeonprocess",!0);w(a);u(a);(d=zjs(a).getData("zmoduleimageresizeshadowimg"))&&d.show()}},
onDrag:function(b,r,d,e){var c=zjs(a);if(c.getData("zmoduleimageresizecorner1",!1)){var h=zjs(r);r=parseInt(h.getData("zmoduleimageresizecornerindexkey"));var n=0,g=c.getData("zmoduleimageresizeoption"),s=zjs(a).getData("zmoduleimageresizeshadowimg"),m=g.aspectRatio,q=parseFloat(c.getData("zmoduleimageresizeoriginalratio",1));g.pressShiftToAspectRatio&&b.shiftKey()&&(m=!0,q=c.width()/c.height());b=e.left+d.x;d=e.top+d.y;var p=s.left(),t=s.top(),k=s.width(),l=s.height(),f=!1;1==r?(n=8,f=c.getData("zmoduleimageresizecorner8"),
b>f.left()-g.minWidth&&(b=f.left()-g.minWidth),d>f.top()-g.minHeight&&(d=f.top()-g.minHeight),p=b,t=d,k=f.left()-b,l=f.top()-d,m&&(k/l>q?l=k/q:k=l*q,b=f.left()-k,d=f.top()-l,p=b,t=d)):3==r?(n=6,f=c.getData("zmoduleimageresizecorner6"),b<f.left()+g.minWidth&&(b=f.left()+g.minWidth),d>f.top()-g.minHeight&&(d=f.top()-g.minHeight),t=d,k=-f.left()+b,l=f.top()-d,m&&(k/l>q?l=k/q:k=l*q,b=f.left()+k,t=d=f.top()-l)):6==r?(n=3,f=c.getData("zmoduleimageresizecorner3"),b>f.left()-g.minWidth&&(b=f.left()-g.minWidth),
d<f.top()+g.minHeight&&(d=f.top()+g.minHeight),p=b,k=f.left()-b,l=-f.top()+d,m&&(k/l>q?l=k/q:k=l*q,b=f.left()-k,d=f.top()+l,p=b)):8==r?(n=1,f=c.getData("zmoduleimageresizecorner1"),b<f.left()+g.minWidth&&(b=f.left()+g.minWidth),d<f.top()+g.minHeight&&(d=f.top()+g.minHeight),k=-f.left()+b,l=-f.top()+d,m&&(k/l>q?l=k/q:k=l*q,b=f.left()+k,d=f.top()+l)):2==r?(n=7,f=c.getData("zmoduleimageresizecorner7"),b=e.left,d>f.top()-g.minHeight&&(d=f.top()-g.minHeight),t=d,l=f.top()-d,m&&(k=l*q,k<g.minWidth&&(k=
g.minWidth,l=k/q),p=b-k/2,t=d=f.top()-l)):4==r?(n=5,f=c.getData("zmoduleimageresizecorner5"),b>f.left()-g.minWidth&&(b=f.left()-g.minWidth),d=e.top,p=b,k=f.left()-b,m&&(l=k/q,l<g.minHeight&&(l=g.minHeight,k=l*q),p=b=f.left()-k,t=d-l/2)):5==r?(n=4,f=c.getData("zmoduleimageresizecorner4"),b<f.left()+g.minWidth&&(b=f.left()+g.minWidth),d=e.top,k=-f.left()+b,m&&(l=k/q,l<g.minHeight&&(l=g.minHeight,k=l*q),b=f.left()+k,t=d-l/2)):7==r&&(n=2,f=c.getData("zmoduleimageresizecorner2"),b=e.left,d<f.top()+g.minHeight&&
(d=f.top()+g.minHeight),l=-f.top()+d,m&&(k=l*q,k<g.minWidth&&(k=g.minWidth,l=k/q),p=b-k/2,d=f.top()+l));s.left(p).top(t).width(k).height(l);h.left(b).top(d);e=n;c=zjs(a);c.getData("zmoduleimageresizecorner1",!1)&&(h=c.getData("zmoduleimageresizeoption"),m=zjs(a).getData("zmoduleimageresizeshadowimg"))&&(n=m.top(),g=m.left(),s=m.width(),m=m.height(),1!=r&&1!=e&&c.getData("zmoduleimageresizecorner1").top(n).left(g),2!=r&&2!=e&&c.getData("zmoduleimageresizecorner2").top(n).left(g+s/2),3!=r&&3!=e&&c.getData("zmoduleimageresizecorner3").top(n).left(g+
s),4!=r&&4!=e&&c.getData("zmoduleimageresizecorner4").top(n+m/2).left(g),5!=r&&5!=e&&c.getData("zmoduleimageresizecorner5").top(n+m/2).left(g+s),6!=r&&6!=e&&c.getData("zmoduleimageresizecorner6").top(n+m).left(g),7!=r&&7!=e&&c.getData("zmoduleimageresizecorner7").top(n+m).left(g+s/2),8!=r&&8!=e&&c.getData("zmoduleimageresizecorner8").top(n+m).left(g+s),h.border&&(c.getData("zmoduleimageresizebordertop").top(n).left(g).width(s),c.getData("zmoduleimageresizeborderleft").top(n).left(g).height(m),c.getData("zmoduleimageresizeborderright").top(n).left(g+
s).height(m),c.getData("zmoduleimageresizeborderbottom").top(n+m).left(g).width(s)))}},onDrop:function(b,c,d,e){b=zjs(a);if(b.getData("zmoduleimageresizecorner1",!1)){c=zjs(c);parseInt(c.getData("zmoduleimageresizecornerindexkey"));c=b.getData("zmoduleimageresizeoption");b.setData("zmoduleimageresizeonprocess",!1);x(a);var h=zjs(a).getData("zmoduleimageresizeshadowimg");d=h.width();e=h.height();var p=h.left(),h=h.top();b.width(d).height(e);c.changePosition&&b.left(p).top(h);u(a);y(a)}}}).hover(function(){clearTimeout(b.getData("zmoduleimageresizehidecortimeout"));
b.getData("zmoduleimageresizeonprocess",!1)},function(){clearTimeout(b.getData("zmoduleimageresizehidecortimeout"));b.getData("zmoduleimageresizeonprocess",!1)||b.setData("zmoduleimageresizehidecortimeout",setTimeout(function(){z(a)},c.hideCornerTimeout))}).appendTo(h));u(a);c.border&&(b.getData("zmoduleimageresizebordertop").hide(),b.getData("zmoduleimageresizeborderleft").hide(),b.getData("zmoduleimageresizeborderright").hide(),b.getData("zmoduleimageresizeborderbottom").hide());b.getData("zmoduleimageresizecorner1").hide();
b.getData("zmoduleimageresizecorner2").hide();b.getData("zmoduleimageresizecorner3").hide();b.getData("zmoduleimageresizecorner4").hide();b.getData("zmoduleimageresizecorner5").hide();b.getData("zmoduleimageresizecorner6").hide();b.getData("zmoduleimageresizecorner7").hide();b.getData("zmoduleimageresizecorner8").hide();y(a);b.setData("zmoduleimageresizehidecortimeout",0);b.hover(function(a,b){var d=zjs(b);if(d.getData("zmoduleimageresizecorner1",!1)&&(clearTimeout(d.getData("zmoduleimageresizehidecortimeout")),
!d.getData("zmoduleimageresizeonprocess",!1))){d=zjs(b);if(d.getData("zmoduleimageresizecorner1",!1)){var c=d.getData("zmoduleimageresizeoption");d.getData("zmoduleimageresizecorner1").fadeStop().show().setStyle({opacity:1});d.getData("zmoduleimageresizecorner2").fadeStop().show().setStyle({opacity:1});d.getData("zmoduleimageresizecorner3").fadeStop().show().setStyle({opacity:1});d.getData("zmoduleimageresizecorner4").fadeStop().show().setStyle({opacity:1});d.getData("zmoduleimageresizecorner5").fadeStop().show().setStyle({opacity:1});
d.getData("zmoduleimageresizecorner6").fadeStop().show().setStyle({opacity:1});d.getData("zmoduleimageresizecorner7").fadeStop().show().setStyle({opacity:1});d.getData("zmoduleimageresizecorner8").fadeStop().show().setStyle({opacity:1});c.border&&(d.getData("zmoduleimageresizebordertop").fadeStop().show().setStyle({opacity:1}),d.getData("zmoduleimageresizeborderleft").fadeStop().show().setStyle({opacity:1}),d.getData("zmoduleimageresizeborderright").fadeStop().show().setStyle({opacity:1}),d.getData("zmoduleimageresizeborderbottom").fadeStop().show().setStyle({opacity:1}))}u(b)}},
function(a,b){var d=zjs(b);d.getData("zmoduleimageresizecorner1",!1)&&(clearTimeout(d.getData("zmoduleimageresizehidecortimeout")),d.getData("zmoduleimageresizeonprocess",!1)||d.setData("zmoduleimageresizehidecortimeout",setTimeout(function(){z(b)},c.hideCornerTimeout)))});c.changePosition&&(b.addClass("zimage-resize-movable"),b.drag({onStart:function(a,b){w(b)},onDrag:function(a,b,d,c){zjs(b).left(c.left+d.x).top(c.top+d.y);u(b)},onDrop:function(a,b,c,e){x(b)}}));c.changeZindex&&(b.setStyle("z-index",
v++),b.click(function(){this.setStyle("z-index",v++)}))}}}))}},u=function(a){a=zjs(a);if(a.getData("zmoduleimageresizecorner1",!1)){var e=a.getData("zmoduleimageresizeoption"),b=a.top(),c=a.left(),h=a.width(),p=a.height();a.getData("zmoduleimageresizecorner1").top(b).left(c);a.getData("zmoduleimageresizecorner2").top(b).left(c+h/2);a.getData("zmoduleimageresizecorner3").top(b).left(c+h);a.getData("zmoduleimageresizecorner4").top(b+p/2).left(c);a.getData("zmoduleimageresizecorner5").top(b+p/2).left(c+
h);a.getData("zmoduleimageresizecorner6").top(b+p).left(c);a.getData("zmoduleimageresizecorner7").top(b+p).left(c+h/2);a.getData("zmoduleimageresizecorner8").top(b+p).left(c+h);a.getData("zmoduleimageresizeshadowimg").top(b).left(c).width(h).height(p);e.border&&(a.getData("zmoduleimageresizebordertop").top(b).left(c).width(h),a.getData("zmoduleimageresizeborderleft").top(b).left(c).height(p),a.getData("zmoduleimageresizeborderright").top(b).left(c+h).height(p),a.getData("zmoduleimageresizeborderbottom").top(b+
p).left(c).width(h))}},y=function(a){(a=zjs(a).getData("zmoduleimageresizeshadowimg"))&&a.hide()},z=function(a){a=zjs(a);if(a.getData("zmoduleimageresizecorner1",!1)){var e=a.getData("zmoduleimageresizeoption");a.getData("zmoduleimageresizecorner1").fadeOut();a.getData("zmoduleimageresizecorner2").fadeOut();a.getData("zmoduleimageresizecorner3").fadeOut();a.getData("zmoduleimageresizecorner4").fadeOut();a.getData("zmoduleimageresizecorner5").fadeOut();a.getData("zmoduleimageresizecorner6").fadeOut();
a.getData("zmoduleimageresizecorner7").fadeOut();a.getData("zmoduleimageresizecorner8").fadeOut();e.border&&(a.getData("zmoduleimageresizebordertop").fadeOut(),a.getData("zmoduleimageresizeborderleft").fadeOut(),a.getData("zmoduleimageresizeborderright").fadeOut(),a.getData("zmoduleimageresizeborderbottom").fadeOut())}},w=function(a){a=zjs(a);if(a.getData("zmoduleimageresizecorner1",!1)){var e=a.getData("zmoduleimageresizeoption");zjs(document.body).addClass("zimage-resize-process");zjs(".zimage-resize-corner").fadeStop().hide();
a.getData("zmoduleimageresizecorner1").addClass("zimage-resize-corner-move").show();a.getData("zmoduleimageresizecorner2").addClass("zimage-resize-corner-move").show();a.getData("zmoduleimageresizecorner3").addClass("zimage-resize-corner-move").show();a.getData("zmoduleimageresizecorner4").addClass("zimage-resize-corner-move").show();a.getData("zmoduleimageresizecorner5").addClass("zimage-resize-corner-move").show();a.getData("zmoduleimageresizecorner6").addClass("zimage-resize-corner-move").show();
a.getData("zmoduleimageresizecorner7").addClass("zimage-resize-corner-move").show();a.getData("zmoduleimageresizecorner8").addClass("zimage-resize-corner-move").show();e.border&&(a.getData("zmoduleimageresizebordertop").addClass("zimage-resize-border-move").show(),a.getData("zmoduleimageresizeborderleft").addClass("zimage-resize-border-move").show(),a.getData("zmoduleimageresizeborderright").addClass("zimage-resize-border-move").show(),a.getData("zmoduleimageresizeborderbottom").addClass("zimage-resize-border-move").show())}},
x=function(a){a=zjs(a);if(a.getData("zmoduleimageresizecorner1",!1)){var e=a.getData("zmoduleimageresizeoption");a.getData("zmoduleimageresizecorner1").removeClass("zimage-resize-corner-move");a.getData("zmoduleimageresizecorner2").removeClass("zimage-resize-corner-move");a.getData("zmoduleimageresizecorner3").removeClass("zimage-resize-corner-move");a.getData("zmoduleimageresizecorner4").removeClass("zimage-resize-corner-move");a.getData("zmoduleimageresizecorner5").removeClass("zimage-resize-corner-move");
a.getData("zmoduleimageresizecorner6").removeClass("zimage-resize-corner-move");a.getData("zmoduleimageresizecorner7").removeClass("zimage-resize-corner-move");a.getData("zmoduleimageresizecorner8").removeClass("zimage-resize-corner-move");zjs(document.body).removeClass("zimage-resize-process");e.border&&(a.getData("zmoduleimageresizebordertop").removeClass("zimage-resize-border-move"),a.getData("zmoduleimageresizeborderleft").removeClass("zimage-resize-border-move"),a.getData("zmoduleimageresizeborderright").removeClass("zimage-resize-border-move"),
a.getData("zmoduleimageresizeborderbottom").removeClass("zimage-resize-border-move"))}};zjs.extendMethod({makeImageResize:function(a){return this.each(function(e){A(e,a)})},getResizedImagesInfo:function(){var a=[];this.each(function(e){e=zjs(e);e.getData("zmoduleimageresizecorner1",!1)&&a.push({id:e.getAttr("id"),imageid:e.getAttr("data-imageid",0).toInt(),src:e.getAttr("src",""),zindex:e.getStyle("z-index",0).toInt(),left:e.left(),top:e.top(),width:e.width(),height:e.height()})});return a.sort(function(a,
b){return isFinite(a.zindex)?isFinite(b.zindex)?a.zindex-b.zindex:1:-1})}});zjs.hook({after_setInnerHTML:function(a){zjs(a).find("img.zimageresize").makeImageResize()},after_insertDOM:function(a){zjs(a).hasClass("zimageresize")&&zjs(a).makeImageResize();zjs(a).find("img.zimageresize").makeImageResize()},before_removeDOM:function(a){a=zjs(a);a.getData("zmoduleimageresizecorner1",!1)&&(a.getData("zmoduleimageresizecorner1").remove(),a.getData("zmoduleimageresizecorner2").remove(),a.getData("zmoduleimageresizecorner3").remove(),
a.getData("zmoduleimageresizecorner4").remove(),a.getData("zmoduleimageresizecorner5").remove(),a.getData("zmoduleimageresizecorner6").remove(),a.getData("zmoduleimageresizecorner7").remove(),a.getData("zmoduleimageresizecorner8").remove(),a.getData("zmoduleimageresizeshadowimg").remove(),a.getData("zmoduleimageresizeoption").border&&(a.getData("zmoduleimageresizebordertop").remove(),a.getData("zmoduleimageresizeborderleft").remove(),a.getData("zmoduleimageresizeborderright").remove(),a.getData("zmoduleimageresizeborderbottom").remove()))}});
zjs.onready(function(){zjs("img.zimageresize").makeImageResize()});"required"in zjs&&zjs.required("image.resize")});
