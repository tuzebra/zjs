zjs.require("scrollbar, ui, ui.button",function(){"use strict";var e="zmoduleuiselectboxoption",t="zmoduleuiselectboxwrapel",a="zmoduleuiselectboxpanelel",s="zmoduleuiselectboxel";zjs.extendCore({moduleUiSelectboxOption:{width:"auto",customCssClass:"",panelmaxheight:250,itemtemplate:"${text}",panelAppendedToBody:!1}});var i="zui-selectbox",l="zui-selectbox__button-wrap",n="zui-selectbox__button",o="zui-contextual-button",d="zui-contextual-panel-wrap",r="zui-selectbox__panel-wrap",c="zui-initing",u="zui-hide",v="zui-selectbox__panel-inner",f="zui-selectbox__panel",m="zui-selectbox__placeholder",p='<div class="'+i+'"><div class="'+l+'"><a class="'+o+" "+n+'" href="javascript:"></a><div class="'+m+'"></div></div><div class="'+d+" "+r+" "+c+'"><div class="'+v+'"><div class="'+f+'"></div></div></div></div>',h="zui-selectbox__item",b="zui-selected",x="zui-disabled",g='<a class="'+h+'" href="javascript:"></a>',j="zui-selectbox__item-header",C="zui-selectbox__item-header-line",A='<span class="'+j+'"></span>',_="zui-button-label",k="activenothover",T="zui-uihide",D=/^data\-(.+)$/,y=function(i,l){var v=zjs(i),z=v.getData(e);if(z)v.setData(e,zjs.extend(z,l));else{z=zjs.clone(zjs.moduleUiSelectboxOption);var j=v.getAttr("data-option","");zjs.isString(j)&&""!=j.trim()&&(z=zjs.extend(z,j.jsonDecode())),v.removeAttr("data-option"),void 0!==l&&(z=zjs.extend(z,l)),v.setData(e,z);var y=zjs(p);"auto"==z.width&&y.width(v.width()),""!=z.customCssClass&&y.addClass(z.customCssClass),v.setData(t,y);var w=v.getAttr("placeholder","");""!==w?(y.find("."+n).addClass("label-placeholder"),y.find("."+m).html(w).hide()):y.find("."+m).remove(),y.insertAfter(v);var S=y.find("."+r),I=y.find("."+f);S.setData(s,v),v.setData(a,S);var H=0,L=0,B=0,E=null;v.find("option,optgroup").eachElement(function(e){var t=zjs(e);if(t.is("optgroup")){var a=zjs(A).appendTo(I);""!=t.getAttr("label","")?a.setInnerHTML(t.getAttr("label")):a.addClass(C)}else if(t.is("option")){H++;var s=zjs(g).appendTo(I),i=t.is("[value]")?t.getAttr("value",""):t.getInnerHTML();s.setAttr("data-value",i),null===E&&(E=i);var l=t.getAttr("data-html","");if(""==l){var n={value:i,text:t.getInnerHTML()};zjs.foreach(t.item(0,!0).attributes,function(e){if(D.test(e.nodeName)){var t=e.nodeName.match(D)[1];n[t]=e.nodeValue}});var o="";"function"==typeof z.itemtemplate&&(o=z.itemtemplate(n)),"string"==typeof z.itemtemplate&&(o=z.itemtemplate),"string"==typeof o&&(o=o.format(n)),l=o}if(s.setInnerHTML(l),t.is("[disabled]"))return void s.addClass(x);L++;var d=t.getAttr("data-href","");""!=d&&s.setAttr("href",d).addClass("has-link"),t.is("[selected]")&&(s.addClass(b),B=H-1,E=i),t.setAttr("value",s.getAttr("data-value"));var r=t.getAttr("data-class","");""!=r&&s.addClass(r)}}),i.selectedIndex=B,y.addClass("total-item-"+H).addClass("total-active-item-"+L),""!==E&&y.setAttr("data-selected-value",E);var V=I.height();V>z.panelmaxheight&&"makeScrollbar"in I&&I.makeScrollbar({height:z.panelmaxheight}),S.addClass(u).removeClass(c),0==I.find("."+h+"."+b).count()&&I.find("."+h+":not(."+x+")").item(0).addClass(b),S.on("click","."+h,function(e){var t=zjs(this);t.hasClass(x)||M(v,t.getAttr("data-value"),"click")});var q,O=y.find("."+n);zjs.isFunction(O.makeButton)?(O.makeButton(),q=O.find("."+_)):q=O,q.setInnerHTML(I.find("."+h+"."+b).item(0).getInnerHTML()),O.on("click",function(e){e.preventDefault(),e.stop();var t=O.hasClass(k);zjs("."+o).removeClass(k),zjs("."+d).addClass(u).eachElement(function(e){if(e!=S.item(0,1)){var t=zjs(e).getData(s);t&&t.trigger("ui:selectbox:hideselections")}}),t||(O.addClass(k),S.removeClass(u),v.trigger("ui:selectbox:showselections"))}),v.addClass(T);var F=v.getAttr("onchange","");if(""!=F){var N=new Function("event","return "+F+".call(this, event)");v.on("ui:selectbox:change",N)}v.setData("setValueCustomMethod","selectboxSelectValue"),z.panelAppendedToBody&&(v.on("ui:selectbox:showselections",function(){S.item(0,1).getBoundingClientRect&&function(){var e=S.item(0,1).getBoundingClientRect();S.appendTo(document.body).addClass("zui-contextual-panel-body-portal").setStyle({position:"absolute",top:e.top,left:e.left,width:e.width})}.delay(100)}),v.on("ui:selectbox:hideselections",function(){(function(){S.hasClass("zui-contextual-panel-body-portal")&&S.removeClass("zui-contextual-panel-body-portal").setAttr("style","").appendTo(y)}).delay(100)}))}};zjs(document).on("click",function(){zjs(".zselectbox").eachElement(function(e){var s=zjs(e).getData(t);if(s){var i=s.find("."+n),l=zjs(e).getData(a),o=i.hasClass(k);o&&(i.removeClass(k),l.addClass(u),zjs(e).trigger("ui:selectbox:blur"),zjs(e).trigger("ui:selectbox:hideselections"))}})});var M=function(e,s,i){var l=zjs(e),o=l.getData(t,!1);if(o){var d=l.getData(a).find("."+f),r=o.find("."+n),c=r.find("."+_);c.count()||(c=r);var u=d.find("."+h+'[data-value="'+s+'"]').item(0);if(!(u.count()<=0||u.hasClass(x))){d.find("."+h).removeClass(b),u.addClass(b),c.setInnerHTML(u.getInnerHTML()),l.find("option[selected]").removeAttr("selected").selected(!1),l.find('option[value="'+s+'"]').setAttr("selected","selected").selected(!0);try{l.item(0,1).value=s}catch(e){}o.setAttr("data-selected-value",s),void 0!==i&&"click"==i&&l.trigger("ui:selectbox:clickchange",{value:s,text:u.getInnerHTML()}),l.trigger("ui:selectbox:change",{value:s,text:u.getInnerHTML()})}}},w=function(e){var a=zjs(e),s=a.getData(t,!1);if(!s)return[];var i=[];return s.find("."+h).eachElement(function(e){i.push(z(e).getAttr("data-value",""))}),i};zjs.extendMethod({makeSelectbox:function(e){return this.eachElement(function(t){y(t,e)})},selectboxSelectValue:function(e){return this.eachElement(function(t){M(t,e)})},selectboxGetAllValue:function(){return w(this.item(0,!0))}}),zjs.hook({after_setInnerHTML:function(e){zjs(e).find(".zselectbox").makeSelectbox()},after_insertDOM:function(e){zjs(e).hasClass("zselectbox")&&zjs(e).makeSelectbox(),zjs(e).find(".zselectbox").makeSelectbox()}}),zjs.onready(function(){zjs(".zselectbox").makeSelectbox()}),"required"in zjs&&zjs.required("ui.selectbox")});