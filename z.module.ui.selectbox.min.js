zjs.require("scrollbar, ui, ui.button",function(){"use strict";var e="zmoduleuiselectboxoption",t="zmoduleuiselectboxwrapel";zjs.extendCore({moduleUiSelectboxOption:{width:"auto",customCssClass:"",panelmaxheight:250,itemtemplate:"${text}"}});var a="zui-selectbox",s="zui-selectbox__button-wrap",i="zui-selectbox__button",n="zui-contextual-button",l="zui-contextual-panel-wrap",o="zui-selectbox__panel-wrap",r="zui-initing",d="zui-hide",c="zui-selectbox__panel-inner",u="zui-selectbox__panel",v="zui-selectbox__placeholder",f='<div class="'+a+'"><div class="'+s+'"><a class="'+n+" "+i+'" href="javascript:"></a><div class="'+v+'"></div></div><div class="'+l+" "+o+" "+r+'"><div class="'+c+'"><div class="'+u+'"></div></div></div></div>',m="zui-selectbox__item",h="zui-selected",b="zui-disabled",p='<a class="'+m+'" href="javascript:"></a>',x="zui-selectbox__item-header",g="zui-selectbox__item-header-line",j='<span class="'+x+'"></span>',C="zui-button-label",A="activenothover",_="zui-uihide",k=/^data\-(.+)$/,M=function(a,s){var c=zjs(a),z=c.getData(e);if(z)return void c.setData(e,zjs.extend(z,s));z=zjs.clone(zjs.moduleUiSelectboxOption);var x=c.getAttr("data-option","");zjs.isString(x)&&""!=x.trim()&&(z=zjs.extend(z,x.jsonDecode())),c.removeAttr("data-option"),"undefined"!=typeof s&&(z=zjs.extend(z,s)),c.setData(e,z);var M=zjs(f);"auto"==z.width&&M.width(c.width()),""!=z.customCssClass&&M.addClass(z.customCssClass),c.setData(t,M);var I=c.getAttr("placeholder","");""!==I?(M.find("."+i).addClass("label-placeholder"),M.find("."+v).html(I).hide()):M.find("."+v).remove(),M.insertAfter(c);var S=M.find("."+o),D=M.find("."+u),H=0,L=0,w=0,y=null;c.find("option,optgroup").eachElement(function(e){var t=zjs(e);if(t.is("optgroup")){var a=zjs(j).appendTo(D);""!=t.getAttr("label","")?a.setInnerHTML(t.getAttr("label")):a.addClass(g)}else if(t.is("option")){H++;var s=zjs(p).appendTo(D),i=t.is("[value]")?t.getAttr("value",""):t.getInnerHTML();s.setAttr("data-value",i),null===y&&(y=i);var n=t.getAttr("data-html","");if(""==n){var l={value:i,text:t.getInnerHTML()};zjs.foreach(t.item(0,!0).attributes,function(e){if(k.test(e.nodeName)){var t=e.nodeName.match(k)[1];l[t]=e.nodeValue}});var o="";"function"==typeof z.itemtemplate&&(o=z.itemtemplate(l)),"string"==typeof z.itemtemplate&&(o=z.itemtemplate),"string"==typeof o&&(o=o.format(l)),n=o}if(s.setInnerHTML(n),t.is("[disabled]"))return void s.addClass(b);L++;var r=t.getAttr("data-href","");""!=r&&s.setAttr("href",r).addClass("has-link"),t.is("[selected]")&&(s.addClass(h),w=H-1,y=i),t.setAttr("value",s.getAttr("data-value"));var d=t.getAttr("data-class","");""!=d&&s.addClass(d)}}),a.selectedIndex=w,M.addClass("total-item-"+H).addClass("total-active-item-"+L),""!==y&&M.setAttr("data-selected-value",y);var E=D.height();E>z.panelmaxheight&&"makeScrollbar"in D&&D.makeScrollbar({height:z.panelmaxheight}),S.addClass(d).removeClass(r),0==D.find("."+m+"."+h).count()&&D.find("."+m+":not(."+b+")").item(0).addClass(h),D.on("click","."+m,function(e){var t=zjs(this);t.hasClass(b)||T(c,t.getAttr("data-value"),"click")});var V,q=M.find("."+i);zjs.isFunction(q.makeButton)?(q.makeButton(),V=q.find("."+C)):V=q,V.setInnerHTML(D.find("."+m+"."+h).item(0).getInnerHTML()),q.on("click",function(e){e.preventDefault(),e.stop();var t=q.hasClass(A);zjs("."+n).removeClass(A),zjs("."+l).addClass(d),t||(q.addClass(A),S.removeClass(d))}),c.addClass(_);var O=c.getAttr("onchange","");if(""!=O){var B=new Function("event","return "+O+".call(this, event)");c.on("ui:selectbox:change",B)}c.setData("setValueCustomMethod","selectboxSelectValue")};zjs(document).on("click",function(){zjs(".zselectbox").eachElement(function(e){var a=zjs(e).getData(t);if(a){var s=a.find("."+i),n=a.find("."+o),l=s.hasClass(A);l&&(s.removeClass(A),n.addClass(d),zjs(e).trigger("ui:selectbox:blur"))}})});var T=function(e,a,s){var n=zjs(e),l=n.getData(t,!1);if(l){var o=l.find("."+u),r=l.find("."+i),d=r.find("."+C);d.count()||(d=r);var c=o.find("."+m+'[data-value="'+a+'"]').item(0);if(!(c.count()<=0||c.hasClass(b))){o.find("."+m).removeClass(h),c.addClass(h),d.setInnerHTML(c.getInnerHTML()),n.find("option[selected]").removeAttr("selected").selected(!1),n.find('option[value="'+a+'"]').setAttr("selected","selected").selected(!0);try{n.item(0,1).value=a}catch(e){}l.setAttr("data-selected-value",a),"undefined"!=typeof s&&"click"==s&&n.trigger("ui:selectbox:clickchange",{value:a,text:c.getInnerHTML()}),n.trigger("ui:selectbox:change",{value:a,text:c.getInnerHTML()})}}},I=function(e){var a=zjs(e),s=a.getData(t,!1);if(!s)return[];var i=[];return s.find("."+m).eachElement(function(e){i.push(z(e).getAttr("data-value",""))}),i};zjs.extendMethod({makeSelectbox:function(e){return this.eachElement(function(t){M(t,e)})},selectboxSelectValue:function(e){return this.eachElement(function(t){T(t,e)})},selectboxGetAllValue:function(){return I(this.item(0,!0))}}),zjs.hook({after_setInnerHTML:function(e){zjs(e).find(".zselectbox").makeSelectbox()},after_insertDOM:function(e){zjs(e).hasClass("zselectbox")&&zjs(e).makeSelectbox(),zjs(e).find(".zselectbox").makeSelectbox()}}),zjs.onready(function(){zjs(".zselectbox").makeSelectbox()}),"required"in zjs&&zjs.required("ui.selectbox")});