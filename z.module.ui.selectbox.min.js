zjs.require("scrollbar, ui, ui.button",function(){zjs.extendCore({moduleUiSelectboxOption:{width:"auto",customCssClass:"",panelmaxheight:250,itemtemplate:"${text}"}});var p=/^data\-(.+)$/,u=function(a,d){var b=zjs(a),e=b.getData("zmoduleuiselectboxoption");if(e)b.setData("zmoduleuiselectboxoption",zjs.extend(e,d));else{e=zjs.clone(zjs.moduleUiSelectboxOption);var c=b.getAttr("data-option","");zjs.isString(c)&&""!=c.trim()&&(e=zjs.extend(e,c.jsonDecode()));b.removeAttr("data-option");"undefined"!=
typeof d&&(e=zjs.extend(e,d));b.setData("zmoduleuiselectboxoption",e);c=zjs('<div class="zui-selectbox"><div class="zui-selectbox__button-wrap"><a class="zui-contextual-button zui-selectbox__button"></a><div class="zui-selectbox__placeholder"></div></div><div class="zui-contextual-panel-wrap zui-selectbox__panel-wrap zui-initing"><div class="zui-selectbox__panel-inner"><div class="zui-selectbox__panel"></div></div></div></div>');"auto"==e.width&&c.width(b.width());""!=e.customCssClass&&c.addClass(e.customCssClass);
b.setData("zmoduleuiselectboxwrapel",c);var g=b.getAttr("placeholder","");""!==g?(c.find(".zui-selectbox__button").addClass("label-placeholder"),c.find(".zui-selectbox__placeholder").html(g).hide()):c.find(".zui-selectbox__placeholder").remove();c.insertAfter(b);var l=c.find(".zui-selectbox__panel-wrap"),h=c.find(".zui-selectbox__panel"),n=0,q=0,r=0,m=null;b.find("option,optgroup").eachElement(function(f){f=zjs(f);if(f.is("optgroup")){var a=zjs('<span class="zui-selectbox__item-header"></span>').appendTo(h);
""!=f.getAttr("label","")?a.setInnerHTML(f.getAttr("label")):a.addClass("zui-selectbox__item-header-line")}else if(f.is("option")){n++;a=zjs('<a class="zui-selectbox__item"></a>').appendTo(h);var c=f.is("[value]")?f.getAttr("value",""):f.getInnerHTML();a.setAttr("data-value",c);null===m&&(m=c);var b=f.getAttr("data-html","");if(""==b){var d={value:c,text:f.getInnerHTML()};zjs.foreach(f.item(0,!0).attributes,function(a){if(p.test(a.nodeName)){var b=a.nodeName.match(p)[1];d[b]=a.nodeValue}});b="";"function"==
typeof e.itemtemplate&&(b=e.itemtemplate(d));"string"==typeof e.itemtemplate&&(b=e.itemtemplate);"string"==typeof b&&(b=b.format(d))}a.setInnerHTML(b);f.is("[disabled]")?a.addClass("zui-disabled"):(q++,b=f.getAttr("data-href",""),""!=b&&a.setAttr("href",b),f.is("[selected]")&&(a.addClass("zui-selected"),r=n-1,m=c),f.setAttr("value",a.getAttr("data-value")),f=f.getAttr("data-class",""),""!=f&&a.addClass(f))}});a.selectedIndex=r;c.addClass("total-item-"+n).addClass("total-active-item-"+q);""!==m&&c.setAttr("data-selected-value",
m);h.height()>e.panelmaxheight&&"makeScrollbar"in h&&h.makeScrollbar({height:e.panelmaxheight});l.addClass("zui-hide").removeClass("zui-initing");0==h.find(".zui-selectbox__item.zui-selected").count()&&h.find(".zui-selectbox__item:not(.zui-disabled)").item(0).addClass("zui-selected");h.on("click",".zui-selectbox__item",function(a){a=zjs(this);a.hasClass("zui-disabled")||t(b,a.getAttr("data-value"),"click")});var k=c.find(".zui-selectbox__button");zjs.isFunction(k.makeButton)?(k.makeButton(),c=k.find(".zui-button-label")):
c=k;c.setInnerHTML(h.find(".zui-selectbox__item.zui-selected").item(0).getInnerHTML());k.on("click",function(a){a.preventDefault();a.stop();a=k.hasClass("activenothover");zjs(".zui-contextual-button").removeClass("activenothover");zjs(".zui-contextual-panel-wrap").addClass("zui-hide");a||(k.addClass("activenothover"),l.removeClass("zui-hide"))});b.addClass("zui-uihide");c=b.getAttr("onchange","");""!=c&&(c=new Function("event","return "+c+".call(this, event)"),b.on("ui:selectbox:change",c));b.setData("setValueCustomMethod",
"selectboxSelectValue")}};zjs(document).on("click",function(){zjs(".zselectbox").eachElement(function(a){var d=zjs(a).getData("zmoduleuiselectboxwrapel");if(d){var b=d.find(".zui-selectbox__button");d=d.find(".zui-selectbox__panel-wrap");b.hasClass("activenothover")&&(b.removeClass("activenothover"),d.addClass("zui-hide"),zjs(a).trigger("ui:selectbox:blur"))}})});var t=function(a,d,b){a=zjs(a);var e=a.getData("zmoduleuiselectboxwrapel",!1);if(e){var c=e.find(".zui-selectbox__panel"),g=e.find(".zui-selectbox__button"),
l=g.find(".zui-button-label");l.count()||(l=g);g=c.find('.zui-selectbox__item[data-value="'+d+'"]').item(0);0>=g.count()||g.hasClass("zui-disabled")||(c.find(".zui-selectbox__item").removeClass("zui-selected"),g.addClass("zui-selected"),l.setInnerHTML(g.getInnerHTML()),a.find("option[selected]").removeAttr("selected").selected(!1),a.find('option[value="'+d+'"]').setAttr("selected","selected").selected(!0),e.setAttr("data-selected-value",d),"undefined"!=typeof b&&"click"==b&&a.trigger("ui:selectbox:clickchange",
{value:d,text:g.getInnerHTML()}),a.trigger("ui:selectbox:change",{value:d,text:g.getInnerHTML()}))}},v=function(a){a=zjs(a).getData("zmoduleuiselectboxwrapel",!1);if(!a)return[];var d=[];a.find(".zui-selectbox__item").eachElement(function(a){d.push(z(a).getAttr("data-value",""))});return d};zjs.extendMethod({makeSelectbox:function(a){return this.eachElement(function(d){u(d,a)})},selectboxSelectValue:function(a){return this.eachElement(function(d){t(d,a)})},selectboxGetAllValue:function(){return v(this.item(0,
!0))}});zjs.hook({after_setInnerHTML:function(a){zjs(a).find(".zselectbox").makeSelectbox()},after_insertDOM:function(a){zjs(a).hasClass("zselectbox")&&zjs(a).makeSelectbox();zjs(a).find(".zselectbox").makeSelectbox()}});zjs.onready(function(){zjs(".zselectbox").makeSelectbox()});"required"in zjs&&zjs.required("ui.selectbox")});