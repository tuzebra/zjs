zjs.require("ui",function(){zjs.extendCore({moduleUiFreezepanelOption:{marginTop:0,marginBottom:0,autoDisableWhenWidthLessThan:0,overflowParent:"auto",pendingScrollTime:0,handlerFreezingElement:!1,handlerFreezingMethod:"meet-top"}});var r,l,t=function(){return!l.hasClass("zui-scrollbar-usedefault")&&0<parseInt(l.getData("zmodulescrollbarid",0))},H=function(e,b){function a(){if(x){var e;e=m?t()?l.scrollPosition():r.scrollTop():h.getStyle("scrollTop");var a=v("checkActivate",w,c,{scrollTop:e,orgAnchorPosition:y});
if(B){if(m&&t()){var b=l.getData("zmodulescrollbaroption");b&&b.usecss&&(d.hasClass("zui-freezing")?d.item(0,!0).style.webkitTransform="translate3d(0, "+e+"px, 0)":d.item(0,!0).style.webkitTransform="none")}if(a==z){if(u&&d.hasClass("zui-freezing")){var f=u.height(),a=d.height();k=u.getAbsoluteTop();m||(k-=h.getAbsoluteTop());h?m?(b=e-k,b+a>f&&(b=f-a)):(b=e,b+a>f+k&&(b=f+k-a)):(a=k+f-c.marginBottom-a,b=e+c.marginTop>a?a-e:c.marginTop);d.top(b)}}else if(z=a){var f=d.width(),a=d.height(),n=0,q=0;try{n=
d.getStyle("margin-top"),q=d.getStyle("margin-bottom")}catch(I){}b=c.marginTop;h&&(b=m?e-k:b+e);d.addClass("zui-freezing").top(b);p.addClass("zui-freezing");d.width(f);p.setStyle({height:a,"margin-top":n,"margin-bottom":q}).show();(function(){p.height(d.height())}).delay(50);f==d.parent().width()&&(E=!0);0<c.pendingScrollTime&&(C=!0,function(){C=!1}.delay(c.pendingScrollTime))}else g()}else a!=z&&(z=a)}}function g(){d.removeClass("zui-freezing").top("auto").width("auto");p.removeClass("zui-freezing").hide()}
var d=zjs(e),c=d.getData("zmoduleuifreezepaneloption");if(c)d.setData("zmoduleuifreezepaneloption",zjs.extend(c,b));else{var c=zjs.clone(zjs.moduleUiFreezepanelOption),f=d.getAttr("data-option","");zjs.isString(f)&&""!=f.trim()&&(c=zjs.extend(c,f.jsonDecode()));"undefined"!=typeof b&&(c=zjs.extend(c,b));c.autoDisableWhenWidthLessThan=parseInt(c.autoDisableWhenWidthLessThan);0>c.autoDisableWhenWidthLessThan&&(c.autoDisableWhenWidthLessThan=0);c.handlerFreezingMethod in D||(c.handlerFreezingMethod=
"meet-top");for(var u=!1,h=!1,f=e,A=!1,F=!1,m=!0;f;){f=f.parentNode;if(f==document.body||f==document){f=!1;break}!A&&zjs(f).hasClass("zfreezepanelwrap")&&(A=!0,u=zjs(f),d.setData("zmoduleuifreezepanelparentwrap",u));if("auto"==c.overflowParent&&!F){var q=zjs(f).getStyle("overflow");if("auto"===q||"scroll"===q)if(h=zjs(f),h.addClass("zui-freezepanel-scroll-wrap"),d.setData("zmoduleuifreezepaneloverflowparentwrap",h).addClass("zui-freeze-absolute"),F=!0,q=h.getStyle("overflow-y"),"auto"===q||"scroll"===
q)m=!1}}d.addClass("zui-freezepanel");var v=D[c.handlerFreezingMethod],w=c.handlerFreezingElement?zjs(c.handlerFreezingElement):d;w.item(0,!0)===d.item(0,!0)&&"scroll-over"==c.handlerFreezingMethod&&(c.handlerFreezingMethod="meet-top",c.handlerFreezingElement=!1,v=D[c.handlerFreezingMethod]);d.setData("zmoduleuifreezepaneloption",c);r=r||zjs(window);l=l||zjs(document.body);var y=v("getAnchorPosition",w),k=0,n=0,x=!0,B=!0;u&&(k=u.getAbsoluteTop());h&&(n=h.getAbsoluteTop());m?t()&&(x=!1,l.on("scrollbar:ready",
function(){y=v("getAnchorPosition",w);x=!0})):(y-=n,k-=n);var p=zjs("<div>").insertBefore(d).hide();p.addClass("zui-freezepanel-height-buffer");d.setData("zmoduleuifreezepanelbufferel",p);var z=!1,E=!1,C=!1,G=function(){0<c.autoDisableWhenWidthLessThan&&(d.width()<=c.autoDisableWhenWidthLessThan?(z=B=!1,g()):(B=!0,a()));p.height(d.height());var b=p.getAbsoluteTop();h&&(n=h.getAbsoluteTop());m?t()||(y=0!=b&&B&&d.hasClass("zui-freezing")?v("getAnchorPositionWhenActivated",w,c,{estimateOrgTop:b}):v("getAnchorPosition",
w)):(y-=n,k-=n);a();E&&d.width(d.parent().width())};d.on("trigger:refreshpanel",G);r.on("resize",function(){G.delay(100)});t()&&(console.log("isBodyScrollbarActive"),l.on("scrollbar:scroll",function(){a()}));if(m){if(0<c.pendingScrollTime)r.on("mousewheel",function(a){C&&(a.stopPropagation(),a.preventDefault())});r.on("scroll",function(b){C||t()||(!x&&zjs(document.body).hasClass("zui-scrollbar-usedefault")&&(x=!0),a())})}else h.on("scroll",a);a();d.trigger("ui:freezepanel:load")}},D={"meet-top":function(e,
b,a,g){if("getAnchorPosition"==e)return b.getAbsoluteTop();if("getAnchorPositionWhenActivated"==e)return a.handlerFreezingElement?b.getAbsoluteTop():g.estimateOrgTop;if("checkActivate"==e)return g.scrollTop>g.orgAnchorPosition-a.marginTop},"scroll-over":function(e,b,a,g){if("getAnchorPosition"==e)return b.getAbsoluteTop()+b.height();if("getAnchorPositionWhenActivated"==e)return a.handlerFreezingElement?b.getAbsoluteTop()+b.height():g.estimateOrgTop+b.height();if("checkActivate"==e)return g.scrollTop>
g.orgAnchorPosition}},A=function(e,b){var a=zjs(b);if(!a.getData("zmoduleuifreezepaneloption")||!a.hasClass("zui-freezing"))return a.getAbsoluteTop();var g=a.getData("zmoduleuifreezepanelbufferel");if(!g)return a.getAbsoluteTop();if("original"==e)return g.getAbsoluteTop();a=a.getAbsoluteTop();g=g=t()?l.scrollPosition():r.scrollTop();return g+a};zjs.extendMethod({makeFreezepanel:function(e){return this.eachElement(function(b){H(b,e)})},freezepanelGetOriginalTop:function(){return A("original",this.item(0))},
freezepanelGetAbsoluteTop:function(){return A("absolute",this.item(0))}});zjs.hook({after_setInnerHTML:function(e){zjs(e).find(".zfreezepanel").makeFreezepanel()},after_insertDOM:function(e){zjs(e).hasClass("zfreezepanel")&&zjs(e).makeFreezepanel();zjs(e).find(".zfreezepanel").makeFreezepanel()}});zjs.onready(function(){zjs(".zfreezepanel").makeFreezepanel()});"required"in zjs&&zjs.required("ui.freezepanel")});