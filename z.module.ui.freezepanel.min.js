zjs.require("ui",function(){zjs.extendCore({moduleUiFreezepanelOption:{freeze:!0,marginTop:0,marginBottom:0,autoDisableWhenWidthLessThan:0,autoDisableWhenWindowWidthLessThan:0,overflowParent:"auto",pendingScrollTime:0,autoHideWhenReach:!1,autoHideSpeed:2E3,autoHideDelay:0,useHeightBuffer:!0,excludeFromFreezingStack:!1,handlerFreezingElement:!1,handlerFreezingMethod:"meet-top"}});var q,L,t,y=function(){return!t.hasClass("zui-scrollbar-usedefault")&&0<parseInt(t.getData("zmodulescrollbarid",0))},g=
[],W=function(c){for(var e=0;e<g.length;e++)if(g[e].el===c)return e;return-1},Q=function(c,e,a){a=a||null;var f=W(c);0>f||(g[f].top=null!==a?a:zjs(c).top(),g[f].height=zjs(c).height(),g[f].freezing=e?1:0)},X=function(c){var e=0,a,f;for(a=0;a<g.length;a++){zjs(g[a].el).setStyle("z-index",g.length-a);if(g[a].el===c)break;!g[a].exclude&&g[a].freezing&&(f=g[a].top+g[a].height,e<f&&(e=f))}return e},r=0,l=function(c){return c.getAbsoluteTop()+r},ca=function(c,e){function a(){if(H){var a;a=x?y()?t.scrollPosition():
q.scrollTop()+r:n.getStyle("scrollTop");W(c);var p=X(c),e=A("checkActivate",B,b,{scrollTop:a,viewTop:p,orgAnchorPosition:I});if(C){if(x&&y()){var f=t.getData("zmodulescrollbaroption");f&&f.usecss&&(d.hasClass("zui-freezing")?d.item(0,!0).style.webkitTransform="translate3d(0, "+a+"px, 0)":d.item(0,!0).style.webkitTransform="none")}if(e===D){var k;if(d.hasClass("zui-freezing")){var f=z?z.height():L.height(),e=d.height(),g=u?l(u):L.height();v=z?l(z):0;x||(v-=l(n));var h=v+f;h>g&&(h=g);n?x?(k=a+p-v,k+
e>f&&(k=f-e)):(k=a+p,k+e>f+v&&(k=f+v-e)):(f=h-b.marginBottom-e,k=a+p+b.marginTop>f?f-a:p+b.marginTop);u&&(k<-e&&(k=-e),p=!1,M<=a?(M=a,p=!1):p=!0,p&&(k+=M-a,0<k&&(k=0,M=a+e)));d.getData("zmoduleuifreezepanelalwayshow")&&(k=0);d.top(k)}Q(c,d.hasClass("zui-freezing"),k)}else{if(D=e){var f=d.width(),e=d.height(),h=g=0,w=d.getAbsoluteTop();R=1>=Math.abs(f-d.parent().width());try{g=d.getStyle("margin-top"),h=d.getStyle("margin-bottom")}catch(da){}m=zjs("<div>");b.useHeightBuffer&&m.insertBefore(d);m.setStyle({height:e,
"margin-top":g,"margin-bottom":h}).addClass("zui-freezepanel-height-buffer");d.setData("zmoduleuifreezepanelbufferel",m);(function(){m&&m.height(d.height())}).delay(50);k=b.marginTop+p;n&&(k=x?a+p-v:k+(a+p));d.addClass("zui-freezing");E?(E=!1,d.top(w-a),setTimeout(function(){d.top(k)})):d.top(k);d.width(f);0<b.pendingScrollTime&&(N=!0,function(){N=!1}.delay(b.pendingScrollTime))}else Y();Q(c,d.hasClass("zui-freezing"))}}else Q(c,0),e!=D&&(D=e)}}function f(){O&&(d.removeClass("zui-freezing").top(null).width(null),
m&&(m.remove(),m=null),O=!1)}function Y(){R=!1;O=!0;if(E&&m){E=!1;var b=m.getAbsoluteTop(),a=y()?t.scrollPosition():q.scrollTop()+r;d.top(b-a);(function(){f()}).delay(300)}else f();d.setData("zmoduleuifreezepanelbufferel",null)}var d=zjs(c),b=d.getData("zmoduleuifreezepaneloption");if(b)d.setData("zmoduleuifreezepaneloption",zjs.extend(b,e));else{var b=zjs.clone(zjs.moduleUiFreezepanelOption),h=d.getAttr("data-option","");zjs.isString(h)&&""!=h.trim()&&(b=zjs.extend(b,h.jsonDecode()));d.removeAttr("data-option");
"undefined"!=typeof e&&(b=zjs.extend(b,e));b.autoDisableWhenWidthLessThan=parseInt(b.autoDisableWhenWidthLessThan);0>b.autoDisableWhenWidthLessThan&&(b.autoDisableWhenWidthLessThan=0);b.autoDisableWhenWindowWidthLessThan=parseInt(b.autoDisableWhenWindowWidthLessThan);0>b.autoDisableWhenWindowWidthLessThan&&(b.autoDisableWhenWindowWidthLessThan=0);b.handlerFreezingMethod in S||(b.handlerFreezingMethod="meet-top");b.excludeFromFreezingStack=!!b.excludeFromFreezingStack;for(var z=!1,n=!1,h=c,G=!1,K=
!1,x=!0;h;){h=h.parentNode;if(h==document.body||h==document){h=!1;break}!G&&zjs(h).hasClass("zfreezepanelwrap")&&(G=!0,z=zjs(h),d.setData("zmoduleuifreezepanelparentwrap",z));if("auto"==b.overflowParent&&!K){var J=zjs(h).getStyle("overflow");if("auto"===J||"scroll"===J)if(n=zjs(h),n.addClass("zui-freezepanel-scroll-wrap"),d.setData("zmoduleuifreezepaneloverflowparentwrap",n).addClass("zui-freeze-absolute"),K=!0,J=n.getStyle("overflow-y"),"auto"===J||"scroll"===J)x=!1}}d.addClass("zui-freezepanel");
var A=S[b.handlerFreezingMethod],B=b.handlerFreezingElement?zjs(b.handlerFreezingElement):d;B.item(0,!0)===d.item(0,!0)&&"scroll-over"==b.handlerFreezingMethod&&(b.handlerFreezingMethod="meet-top",b.handlerFreezingElement=!1,A=S[b.handlerFreezingMethod]);var u=!1;zjs.isString(b.autoHideWhenReach)?(u=zjs(b.autoHideWhenReach),u=1>u.count()?b.autoHideWhenReach=!1:u.item(0)):zjs.isNumeric(b.autoHideWhenReach)&&(u={getAbsoluteTop:function(){return b.autoHideWhenReach}});var w=!1;b.autoHideSpeed=parseInt(b.autoHideSpeed,
10);b.autoHideDelay=parseInt(b.autoHideDelay,10);if(isNaN(b.autoHideDelay)||0>b.autoHideDelay)b.autoHideDelay=0;isNaN(b.autoHideSpeed)||0>b.autoHideSpeed?b.autoHideSpeed=0:w=zjs.timer({from:0,to:0,time:b.autoHideSpeed,onStart:function(b,a){r=b;T()},onProcess:function(b,a,d){r=b;T()},onFinish:function(b,a){r=a;T()}});d.setData("zmoduleuifreezepaneloption",b);g.push({el:c,zEl:d,top:l(d),height:0,freezing:0,viewTop:0,exclude:b.excludeFromFreezingStack});g.sort(function(b,a){return b.el===a.el?0:b.el.compareDocumentPosition?
b.el.compareDocumentPosition(a.el)&2?1:-1:b.el.sourceIndex-a.el.sourceIndex});q=q||zjs(window);t=t||zjs(document.body);L=L||zjs(document);var I=A("getAnchorPosition",B),v=0,F=0,H=!0,C=!0,E=!1;z&&(v=l(z));n&&(F=l(n));x?y()&&(H=!1,t.on("scrollbar:ready",function(){I=A("getAnchorPosition",B);H=!0})):(I-=F,v-=F);var m,D=!1,R=!1,N=!1,M=d.height(),O=!1,P=function(){C&&(D=C=!1,Y())},U=function(){C||(O&&f(),C=!0,D=!1,a())},Z=function(){0<b.autoDisableWhenWidthLessThan&&(d.width()<=b.autoDisableWhenWidthLessThan?
P():U());0<b.autoDisableWhenWindowWidthLessThan&&(q.width()<=b.autoDisableWhenWindowWidthLessThan?P():U());var c=0,e=d.getData("zmoduleuifreezepaneldisablechangeheightbufferkey");m&&(e||m.height(d.height()),c=l(m));n&&(F=l(n));x?y()||(I=0!=c&&C&&d.hasClass("zui-freezing")?A("getAnchorPositionWhenActivated",B,b,{estimateOrgTop:c}):A("getAnchorPosition",B)):(I-=F,v-=F);a();R&&d.width(d.parent().width())};d.on("trigger:refreshpanel",Z);q.on("resize",function(){Z.delay(100)});if(y())t.on("scrollbar:scroll",
function(){a()});if(x){var ba=function(){if(!d.getData("zmoduleuifreezepaneldisableshowhide",!1)){var b=q.scrollTop(),a=aa-b;0>a?a=-1:0<a&&(a=1);aa=b;0!==a&&a!=V&&(w.stop(),V=a);if(!w.isRunning()){var b=2*d.height(),c=u.getAbsoluteTop()-q.scrollTop();0>=c&&0>a&&r<b&&(w.isRunning()||w.set({from:r,to:b}).run());0>=c&&0<a&&0<r&&(a!=V&&w.stop(),w.isRunning()||w.set({from:r,to:0}).run())}}};if(0<b.pendingScrollTime)q.on("mousewheel",function(a){N&&(a.stopPropagation(),a.preventDefault())});var V=0,aa=
0;q.on("scroll",function(c){N||y()||(!H&&zjs(document.body).hasClass("zui-scrollbar-usedefault")&&(H=!0),a(),0>=b.autoHideSpeed||!u||(0<b.autoHideDelay?ba.delay(b.autoHideDelay):ba()))})}else n.on("scroll",a);b.freeze?a():(P(),d.on("trigger:enablefreeze",function(a){E=a.getData()&&a.getData().effect;U()}),d.on("trigger:disablefreeze",function(a){E=a.getData()&&a.getData().effect;P()}));d.trigger("ui:freezepanel:load")}},K=function(c){zjs(c).trigger("trigger:refreshpanel")},T=function(){g.map(function(c){c.zEl.trigger("trigger:refreshpanel")})},
S={"meet-top":function(c,e,a,f){if("getAnchorPosition"==c)return l(e);if("getAnchorPositionWhenActivated"==c)return a.handlerFreezingElement?l(e):f.estimateOrgTop;if("checkActivate"==c)return f.scrollTop+f.viewTop>=f.orgAnchorPosition-a.marginTop},"scroll-over":function(c,e,a,f){if("getAnchorPosition"==c)return l(e)+e.height();if("getAnchorPositionWhenActivated"==c)return a.handlerFreezingElement?l(e)+e.height():f.estimateOrgTop+e.height();if("checkActivate"==c)return f.scrollTop+f.viewTop>=f.orgAnchorPosition}},
G=function(c,e){var a=zjs(e);if(!a.getData("zmoduleuifreezepaneloption")){for(var f=!1,g,d=a.parent(!0).item(0,!0);d&&d!=document.body;){g=zjs(d);if(g.getData("zmoduleuifreezepaneloption")){f=!0;break}d=g.parent(!0).item(0,!0)}return f?g.hasClass("zui-freezing")?l(a)+G(c,d):l(a):l(a)}if(!a.hasClass("zui-freezing"))return l(a);f=a.getData("zmoduleuifreezepanelbufferel",null);if("original"==c)return f?l(f):l(a);a=l(a);f=f=y()?t.scrollPosition():q.scrollTop()+r;return f+a};zjs.extendMethod({makeFreezepanel:function(c){return this.eachElement(function(e){ca(e,
c)})},freezepanelGetOriginalTop:function(){return G("original",this.item(0))},freezepanelGetAbsoluteTop:function(){return G("absolute",this.item(0))},freezepanelRefresh:function(){return this.eachElement(function(c){K(c)})},freezepanelDisableAutoShowHide:function(c){return this.eachElement(function(e){zjs(e).setData("zmoduleuifreezepaneldisableshowhide",c)})},freezepanelAlwayShow:function(c){return this.eachElement(function(e){var a=zjs(e),f=a.getData("zmoduleuifreezepaneloption");a.setData("zmoduleuifreezepaneldisableshowhide",
c);a.setData("zmoduleuifreezepanelalwayshow",c);f.freeze?K(e):c?a.trigger("trigger:enablefreeze",{effect:!0}):a.trigger("trigger:disablefreeze",{effect:!0})})},freezepanelDisableChangeHeightBuffer:function(c){return this.eachElement(function(e){zjs(e).setData("zmoduleuifreezepaneldisablechangeheightbufferkey",c)})}});zjs.extendCore({freezepanelGetVisibleFreezingHeight:function(){return X(window)}});zjs.hook({after_setInnerHTML:function(c){zjs(c).find(".zfreezepanel").makeFreezepanel()},after_insertDOM:function(c){zjs(c).hasClass("zfreezepanel")&&
zjs(c).makeFreezepanel();zjs(c).find(".zfreezepanel").makeFreezepanel()}});zjs.onready(function(){zjs(".zfreezepanel").makeFreezepanel()});"required"in zjs&&zjs.required("ui.freezepanel")});