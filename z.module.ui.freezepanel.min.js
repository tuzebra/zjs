zjs.require("ui",function(){zjs.extendCore({moduleUiFreezepanelOption:{freeze:!0,marginTop:0,marginBottom:0,autoDisableWhenWidthLessThan:0,overflowParent:"auto",pendingScrollTime:0,autoHideWhenReach:!1,autoHideSpeed:2E3,autoHideDelay:0,useHeightBuffer:!0,excludeFromFreezingStack:!1,handlerFreezingElement:!1,handlerFreezingMethod:"meet-top"}});var r,K,t,x=function(){return!t.hasClass("zui-scrollbar-usedefault")&&0<parseInt(t.getData("zmodulescrollbarid",0))},g=[],U=function(c){for(var f=0;f<g.length;f++)if(g[f].el===
c)return f;return-1},O=function(c,f,a){a=a||null;var e=U(c);0>e||(g[e].top=null!==a?a:zjs(c).top(),g[e].height=zjs(c).height(),g[e].freezing=f?1:0)},aa=function(c){var f=0,a,e;for(a=0;a<g.length;a++){zjs(g[a].el).setStyle("z-index",g.length-a);if(g[a].el===c)break;!g[a].exclude&&g[a].freezing&&(e=g[a].top+g[a].height,f<e&&(f=e))}return f},q=0,l=function(c){return c.getAbsoluteTop()+q},ba=function(c,f){function a(){if(G){var a;a=w?x()?t.scrollPosition():r.scrollTop()+q:p.getStyle("scrollTop");U(c);
var f=aa(c),e=A("checkActivate",B,b,{scrollTop:a,viewTop:f,orgAnchorPosition:H});if(C){if(w&&x()){var g=t.getData("zmodulescrollbaroption");g&&g.usecss&&(d.hasClass("zui-freezing")?d.item(0,!0).style.webkitTransform="translate3d(0, "+a+"px, 0)":d.item(0,!0).style.webkitTransform="none")}if(e===D){var h;if(d.hasClass("zui-freezing")){var g=y?y.height():K.height(),e=d.height(),k=u?l(u):K.height();v=y?l(y):0;w||(v-=l(p));var m=v+g;m>k&&(m=k);p?w?(h=a+f-v,h+e>g&&(h=g-e)):(h=a+f,h+e>g+v&&(h=g+v-e)):(g=
m-b.marginBottom-e,h=a+f+b.marginTop>g?g-a:f+b.marginTop);u&&(h<-e&&(h=-e),f=!1,L<=a?(L=a,f=!1):f=!0,f&&(h+=L-a,0<h&&(h=0,L=a+e)));d.getData("zmoduleuifreezepanelalwayshow")&&(h=0);d.top(h)}O(c,d.hasClass("zui-freezing"),h)}else{if(D=e){var g=d.width(),e=d.height(),m=k=0,z=d.getAbsoluteTop();P=1>=Math.abs(g-d.parent().width());try{k=d.getStyle("margin-top"),m=d.getStyle("margin-bottom")}catch(ca){}n=zjs("<div>");b.useHeightBuffer&&n.insertBefore(d);n.setStyle({height:e,"margin-top":k,"margin-bottom":m}).addClass("zui-freezepanel-height-buffer");
d.setData("zmoduleuifreezepanelbufferel",n);(function(){n&&n.height(d.height())}).delay(50);h=b.marginTop+f;p&&(h=w?a+f-v:h+(a+f));d.addClass("zui-freezing");E?(E=!1,d.top(z-a),setTimeout(function(){d.top(h)})):d.top(h);d.width(g);0<b.pendingScrollTime&&(M=!0,function(){M=!1}.delay(b.pendingScrollTime))}else V();O(c,d.hasClass("zui-freezing"))}}else O(c,0),e!=D&&(D=e)}}function e(){N&&(d.removeClass("zui-freezing").top(null).width(null),n&&(n.remove(),n=null),N=!1)}function V(){P=!1;N=!0;if(E&&n){E=
!1;var a=n.getAbsoluteTop(),b=x()?t.scrollPosition():r.scrollTop()+q;d.top(a-b);(function(){e()}).delay(300)}else e();d.setData("zmoduleuifreezepanelbufferel",null)}var d=zjs(c),b=d.getData("zmoduleuifreezepaneloption");if(b)d.setData("zmoduleuifreezepaneloption",zjs.extend(b,f));else{var b=zjs.clone(zjs.moduleUiFreezepanelOption),k=d.getAttr("data-option","");zjs.isString(k)&&""!=k.trim()&&(b=zjs.extend(b,k.jsonDecode()));d.removeAttr("data-option");"undefined"!=typeof f&&(b=zjs.extend(b,f));b.autoDisableWhenWidthLessThan=
parseInt(b.autoDisableWhenWidthLessThan);0>b.autoDisableWhenWidthLessThan&&(b.autoDisableWhenWidthLessThan=0);b.handlerFreezingMethod in Q||(b.handlerFreezingMethod="meet-top");b.excludeFromFreezingStack=!!b.excludeFromFreezingStack;for(var y=!1,p=!1,k=c,F=!1,J=!1,w=!0;k;){k=k.parentNode;if(k==document.body||k==document){k=!1;break}!F&&zjs(k).hasClass("zfreezepanelwrap")&&(F=!0,y=zjs(k),d.setData("zmoduleuifreezepanelparentwrap",y));if("auto"==b.overflowParent&&!J){var I=zjs(k).getStyle("overflow");
if("auto"===I||"scroll"===I)if(p=zjs(k),p.addClass("zui-freezepanel-scroll-wrap"),d.setData("zmoduleuifreezepaneloverflowparentwrap",p).addClass("zui-freeze-absolute"),J=!0,I=p.getStyle("overflow-y"),"auto"===I||"scroll"===I)w=!1}}d.addClass("zui-freezepanel");var A=Q[b.handlerFreezingMethod],B=b.handlerFreezingElement?zjs(b.handlerFreezingElement):d;B.item(0,!0)===d.item(0,!0)&&"scroll-over"==b.handlerFreezingMethod&&(b.handlerFreezingMethod="meet-top",b.handlerFreezingElement=!1,A=Q[b.handlerFreezingMethod]);
var u=!1;zjs.isString(b.autoHideWhenReach)?(u=zjs(b.autoHideWhenReach),u=1>u.count()?b.autoHideWhenReach=!1:u.item(0)):zjs.isNumeric(b.autoHideWhenReach)&&(u={getAbsoluteTop:function(){return b.autoHideWhenReach}});var m=!1;b.autoHideSpeed=parseInt(b.autoHideSpeed,10);b.autoHideDelay=parseInt(b.autoHideDelay,10);if(isNaN(b.autoHideDelay)||0>b.autoHideDelay)b.autoHideDelay=0;isNaN(b.autoHideSpeed)||0>b.autoHideSpeed?b.autoHideSpeed=0:m=zjs.timer({from:0,to:0,time:b.autoHideSpeed,onStart:function(a,
b){q=a;R()},onProcess:function(a,b,d){q=a;R()},onFinish:function(a,b){q=b;R()}});d.setData("zmoduleuifreezepaneloption",b);g.push({el:c,zEl:d,top:l(d),height:0,freezing:0,viewTop:0,exclude:b.excludeFromFreezingStack});g.sort(function(a,b){return parseInt(a.top,10)-parseInt(b.top,10)});r=r||zjs(window);t=t||zjs(document.body);K=K||zjs(document);var H=A("getAnchorPosition",B),v=0,z=0,G=!0,C=!0,E=!1;y&&(v=l(y));p&&(z=l(p));w?x()&&(G=!1,t.on("scrollbar:ready",function(){H=A("getAnchorPosition",B);G=!0})):
(H-=z,v-=z);var n,D=!1,P=!1,M=!1,L=d.height(),N=!1,S=function(){C&&(D=C=!1,V())},W=function(){C||(N&&e(),C=!0,D=!1,a())},X=function(){0<b.autoDisableWhenWidthLessThan&&(d.width()<=b.autoDisableWhenWidthLessThan?S():W());var c=0,e=d.getData("zmoduleuifreezepaneldisablechangeheightbufferkey");n&&(e||n.height(d.height()),c=l(n));p&&(z=l(p));w?x()||(H=0!=c&&C&&d.hasClass("zui-freezing")?A("getAnchorPositionWhenActivated",B,b,{estimateOrgTop:c}):A("getAnchorPosition",B)):(H-=z,v-=z);a();P&&d.width(d.parent().width())};
d.on("trigger:refreshpanel",X);r.on("resize",function(){X.delay(100)});if(x())t.on("scrollbar:scroll",function(){a()});if(w){var Z=function(){if(!d.getData("zmoduleuifreezepaneldisableshowhide",!1)){var a=r.scrollTop(),b=Y-a;0>b?b=-1:0<b&&(b=1);Y=a;0!==b&&b!=T&&(m.stop(),T=b);if(!m.isRunning()){var a=2*d.height(),c=u.getAbsoluteTop()-r.scrollTop();0>=c&&0>b&&q<a&&(m.isRunning()||m.set({from:q,to:a}).run());0>=c&&0<b&&0<q&&(b!=T&&m.stop(),m.isRunning()||m.set({from:q,to:0}).run())}}};if(0<b.pendingScrollTime)r.on("mousewheel",
function(a){M&&(a.stopPropagation(),a.preventDefault())});var T=0,Y=0;r.on("scroll",function(c){M||x()||(!G&&zjs(document.body).hasClass("zui-scrollbar-usedefault")&&(G=!0),a(),0>=b.autoHideSpeed||!u||(0<b.autoHideDelay?Z.delay(b.autoHideDelay):Z()))})}else p.on("scroll",a);b.freeze?a():(S(),d.on("trigger:enablefreeze",function(a){E=a.getData()&&a.getData().effect;W()}),d.on("trigger:disablefreeze",function(a){E=a.getData()&&a.getData().effect;S()}));d.trigger("ui:freezepanel:load")}},J=function(c){zjs(c).trigger("trigger:refreshpanel")},
R=function(){g.map(function(c){c.zEl.trigger("trigger:refreshpanel")})},Q={"meet-top":function(c,f,a,e){if("getAnchorPosition"==c)return l(f);if("getAnchorPositionWhenActivated"==c)return a.handlerFreezingElement?l(f):e.estimateOrgTop;if("checkActivate"==c)return e.scrollTop+e.viewTop>=e.orgAnchorPosition-a.marginTop},"scroll-over":function(c,f,a,e){if("getAnchorPosition"==c)return l(f)+f.height();if("getAnchorPositionWhenActivated"==c)return a.handlerFreezingElement?l(f)+f.height():e.estimateOrgTop+
f.height();if("checkActivate"==c)return e.scrollTop+e.viewTop>=e.orgAnchorPosition}},F=function(c,f){var a=zjs(f);if(!a.getData("zmoduleuifreezepaneloption")){for(var e=!1,g,d=a.parent(!0).item(0,!0);d&&d!=document.body;){g=zjs(d);if(g.getData("zmoduleuifreezepaneloption")){e=!0;break}d=g.parent(!0).item(0,!0)}return e?g.hasClass("zui-freezing")?l(a)+F(c,d):l(a):l(a)}if(!a.hasClass("zui-freezing"))return l(a);e=a.getData("zmoduleuifreezepanelbufferel",null);if("original"==c)return e?l(e):l(a);a=l(a);
e=e=x()?t.scrollPosition():r.scrollTop()+q;return e+a};zjs.extendMethod({makeFreezepanel:function(c){return this.eachElement(function(f){ba(f,c)})},freezepanelGetOriginalTop:function(){return F("original",this.item(0))},freezepanelGetAbsoluteTop:function(){return F("absolute",this.item(0))},freezepanelRefresh:function(){return this.eachElement(function(c){J(c)})},freezepanelDisableAutoShowHide:function(c){return this.eachElement(function(f){zjs(f).setData("zmoduleuifreezepaneldisableshowhide",c)})},
freezepanelAlwayShow:function(c){return this.eachElement(function(f){var a=zjs(f),e=a.getData("zmoduleuifreezepaneloption");a.setData("zmoduleuifreezepaneldisableshowhide",c);a.setData("zmoduleuifreezepanelalwayshow",c);e.freeze?J(f):c?a.trigger("trigger:enablefreeze",{effect:!0}):a.trigger("trigger:disablefreeze",{effect:!0})})},freezepanelDisableChangeHeightBuffer:function(c){return this.eachElement(function(f){zjs(f).setData("zmoduleuifreezepaneldisablechangeheightbufferkey",c)})}});zjs.hook({after_setInnerHTML:function(c){zjs(c).find(".zfreezepanel").makeFreezepanel()},
after_insertDOM:function(c){zjs(c).hasClass("zfreezepanel")&&zjs(c).makeFreezepanel();zjs(c).find(".zfreezepanel").makeFreezepanel()}});zjs.onready(function(){zjs(".zfreezepanel").makeFreezepanel()});"required"in zjs&&zjs.required("ui.freezepanel")});