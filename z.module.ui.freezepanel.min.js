zjs.require("ui",function(){zjs.extendCore({moduleUiFreezepanelOption:{marginTop:0,marginBottom:0,autoDisableWhenWidthLessThan:0,overflowParent:"auto",pendingScrollTime:0,autoHideWhenReach:!1,useHeightBuffer:!0,excludeFromFreezingStack:!1,handlerFreezingElement:!1,handlerFreezingMethod:"meet-top"}});var w,E,q,x=function(){return!q.hasClass("zui-scrollbar-usedefault")&&0<parseInt(q.getData("zmodulescrollbarid",0))},b=[],L=function(f){for(var d=0;d<b.length;d++)if(b[d].el===f)return d;return-1},I=function(f,
d,a){a=a||null;var k=L(f);0>k||(b[k].top=null!==a?a:zjs(f).top(),b[k].height=zjs(f).height(),b[k].freezing=d?1:0)},O=function(f){var d=0,a,k;for(a=0;a<b.length;a++){zjs(b[a].el).setStyle("z-index",b.length-a);if(b[a].el===f)break;!b[a].exclude&&b[a].freezing&&(k=b[a].top+b[a].height,d<k&&(d=k))}return d},P=function(f,d){function a(){if(A){var a;a=r?x()?q.scrollPosition():w.scrollTop():l.getStyle("scrollTop");L(f);var d=O(f),b=y("checkActivate",z,c,{scrollTop:a,viewTop:d,orgAnchorPosition:B});if(F){if(r&&
x()){var g=q.getData("zmodulescrollbaroption");g&&g.usecss&&(e.hasClass("zui-freezing")?e.item(0,!0).style.webkitTransform="translate3d(0, "+a+"px, 0)":e.item(0,!0).style.webkitTransform="none")}if(b===C){if(e.hasClass("zui-freezing")){var g=u?u.height():E.height(),b=e.height(),h=v?v.getAbsoluteTop():E.height();p=u?u.getAbsoluteTop():0;r||(p-=l.getAbsoluteTop());var m=p+g;m>h&&(m=h);l?r?(h=a+d-p,h+b>g&&(h=g-b)):(h=a+d,h+b>g+p&&(h=g+p-b)):(h=m-c.marginBottom-b,h=a+d+c.marginTop>h?h-a:d+c.marginTop);
v&&(h<-b&&(h=-b),d=!1,G<=a?(G=a,d=!1):d=!0,d&&(h+=G-a,0<h&&(h=0,G=a+b)));e.top(h)}I(f,e.hasClass("zui-freezing"),h)}else{if(C=b){var g=e.width(),b=e.height(),t=m=0;J=1>=Math.abs(g-e.parent().width());try{m=e.getStyle("margin-top"),t=e.getStyle("margin-bottom")}catch(Q){}h=c.marginTop+d;l&&(h=r?a+d-p:h+(a+d));e.addClass("zui-freezing").top(h);e.width(g);n=zjs("<div>");c.useHeightBuffer&&n.insertBefore(e);n.setStyle({height:b,"margin-top":m,"margin-bottom":t}).addClass("zui-freezepanel-height-buffer");
e.setData("zmoduleuifreezepanelbufferel",n);(function(){n&&n.height(e.height())}).delay(50);0<c.pendingScrollTime&&(H=!0,function(){H=!1}.delay(c.pendingScrollTime))}else k();I(f,e.hasClass("zui-freezing"))}}else I(f,0),b!=C&&(C=b)}}function k(){J=!1;e.removeClass("zui-freezing").top(null).width(null);n.remove();n=null;e.setData("zmoduleuifreezepanelbufferel",null)}var e=zjs(f),c=e.getData("zmoduleuifreezepaneloption");if(c)e.setData("zmoduleuifreezepaneloption",zjs.extend(c,d));else{var c=zjs.clone(zjs.moduleUiFreezepanelOption),
g=e.getAttr("data-option","");zjs.isString(g)&&""!=g.trim()&&(c=zjs.extend(c,g.jsonDecode()));e.removeAttr("data-option");"undefined"!=typeof d&&(c=zjs.extend(c,d));c.autoDisableWhenWidthLessThan=parseInt(c.autoDisableWhenWidthLessThan);0>c.autoDisableWhenWidthLessThan&&(c.autoDisableWhenWidthLessThan=0);c.handlerFreezingMethod in K||(c.handlerFreezingMethod="meet-top");c.excludeFromFreezingStack=!!c.excludeFromFreezingStack;for(var u=!1,l=!1,g=f,t=!1,M=!1,r=!0;g;){g=g.parentNode;if(g==document.body||
g==document){g=!1;break}!t&&zjs(g).hasClass("zfreezepanelwrap")&&(t=!0,u=zjs(g),e.setData("zmoduleuifreezepanelparentwrap",u));if("auto"==c.overflowParent&&!M){var D=zjs(g).getStyle("overflow");if("auto"===D||"scroll"===D)if(l=zjs(g),l.addClass("zui-freezepanel-scroll-wrap"),e.setData("zmoduleuifreezepaneloverflowparentwrap",l).addClass("zui-freeze-absolute"),M=!0,D=l.getStyle("overflow-y"),"auto"===D||"scroll"===D)r=!1}}e.addClass("zui-freezepanel");var y=K[c.handlerFreezingMethod],z=c.handlerFreezingElement?
zjs(c.handlerFreezingElement):e;z.item(0,!0)===e.item(0,!0)&&"scroll-over"==c.handlerFreezingMethod&&(c.handlerFreezingMethod="meet-top",c.handlerFreezingElement=!1,y=K[c.handlerFreezingMethod]);var v=!1;zjs.isString(c.autoHideWhenReach)?(v=zjs(c.autoHideWhenReach),v=1>v.count()?c.autoHideWhenReach=!1:v.item(0)):zjs.isNumeric(c.autoHideWhenReach)&&(v={getAbsoluteTop:function(){return c.autoHideWhenReach}});e.setData("zmoduleuifreezepaneloption",c);b.push({el:f,top:e.getAbsoluteTop(),height:0,freezing:0,
viewTop:0,exclude:c.excludeFromFreezingStack});b.sort(function(a,c){return parseInt(a.top,10)-parseInt(c.top,10)});w=w||zjs(window);q=q||zjs(document.body);E=E||zjs(document);var B=y("getAnchorPosition",z),p=0,m=0,A=!0,F=!0;u&&(p=u.getAbsoluteTop());l&&(m=l.getAbsoluteTop());r?x()&&(A=!1,q.on("scrollbar:ready",function(){B=y("getAnchorPosition",z);A=!0})):(B-=m,p-=m);var n,C=!1,J=!1,H=!1,G=e.height(),N=function(){0<c.autoDisableWhenWidthLessThan&&(e.width()<=c.autoDisableWhenWidthLessThan?(C=F=!1,
k()):(F=!0,a()));var d=0;n&&(n.height(e.height()),d=n.getAbsoluteTop());l&&(m=l.getAbsoluteTop());r?x()||(B=0!=d&&F&&e.hasClass("zui-freezing")?y("getAnchorPositionWhenActivated",z,c,{estimateOrgTop:d}):y("getAnchorPosition",z)):(B-=m,p-=m);a();J&&e.width(e.parent().width())};e.on("trigger:refreshpanel",N);w.on("resize",function(){N.delay(100)});if(x())q.on("scrollbar:scroll",function(){a()});if(r){if(0<c.pendingScrollTime)w.on("mousewheel",function(a){H&&(a.stopPropagation(),a.preventDefault())});
w.on("scroll",function(c){H||x()||(!A&&zjs(document.body).hasClass("zui-scrollbar-usedefault")&&(A=!0),a())})}else l.on("scroll",a);a();e.trigger("ui:freezepanel:load")}},K={"meet-top":function(f,d,a,b){if("getAnchorPosition"==f)return d.getAbsoluteTop();if("getAnchorPositionWhenActivated"==f)return a.handlerFreezingElement?d.getAbsoluteTop():b.estimateOrgTop;if("checkActivate"==f)return b.scrollTop+b.viewTop>=b.orgAnchorPosition-a.marginTop},"scroll-over":function(b,d,a,k){if("getAnchorPosition"==
b)return d.getAbsoluteTop()+d.height();if("getAnchorPositionWhenActivated"==b)return a.handlerFreezingElement?d.getAbsoluteTop()+d.height():k.estimateOrgTop+d.height();if("checkActivate"==b)return k.scrollTop+k.viewTop>=k.orgAnchorPosition}},t=function(b,d){var a=zjs(d);if(!a.getData("zmoduleuifreezepaneloption")){for(var f=!1,e,c=a.parent(!0).item(0,!0);c&&c!=document.body;){e=zjs(c);if(e.getData("zmoduleuifreezepaneloption")){f=!0;break}c=e.parent(!0).item(0,!0)}return f?e.hasClass("zui-freezing")?
a.getAbsoluteTop()+t(b,c):a.getAbsoluteTop():a.getAbsoluteTop()}if(!a.hasClass("zui-freezing"))return a.getAbsoluteTop();f=a.getData("zmoduleuifreezepanelbufferel",null);if("original"==b)return f?f.getAbsoluteTop():a.getAbsoluteTop();a=a.getAbsoluteTop();f=f=x()?q.scrollPosition():w.scrollTop();return f+a};zjs.extendMethod({makeFreezepanel:function(b){return this.eachElement(function(d){P(d,b)})},freezepanelGetOriginalTop:function(){return t("original",this.item(0))},freezepanelGetAbsoluteTop:function(){return t("absolute",
this.item(0))}});zjs.hook({after_setInnerHTML:function(b){zjs(b).find(".zfreezepanel").makeFreezepanel()},after_insertDOM:function(b){zjs(b).hasClass("zfreezepanel")&&zjs(b).makeFreezepanel();zjs(b).find(".zfreezepanel").makeFreezepanel()}});zjs.onready(function(){zjs(".zfreezepanel").makeFreezepanel()});"required"in zjs&&zjs.required("ui.freezepanel")});