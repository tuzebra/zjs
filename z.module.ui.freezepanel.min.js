zjs.require("ui",function(){zjs.extendCore({moduleUiFreezepanelOption:{marginTop:0,marginBottom:0,autoDisableWhenWidthLessThan:0,overflowParent:"auto",pendingScrollTime:0,handlerFreezingElement:!1,handlerFreezingMethod:"meet-top"}});var r=function(){return!zjs(document.body).hasClass("zui-scrollbar-usedefault")&&0<parseInt(zjs(document.body).getData("zmodulescrollbarid",0))},I=function(d,b){function g(){if(v){var d;d=m?r()?z.scrollPosition():A.scrollTop():h.getStyle("scrollTop");var f=t("checkActivate",
u,a,{scrollTop:d,orgAnchorPosition:w});if(B){if(m&&r()){var b=z.getData("zmodulescrollbaroption");b&&b.usecss&&(c.hasClass("zui-freezing")?c.item(0,!0).style.webkitTransform="translate3d(0, "+d+"px, 0)":c.item(0,!0).style.webkitTransform="none")}if(f==x){if(p&&c.hasClass("zui-freezing")){var e=p.height(),f=c.height();k=p.getAbsoluteTop();m||(k-=h.getAbsoluteTop());h?m?(b=d-k,b+f>e&&(b=e-f)):(b=d,b+f>e+k&&(b=e+k-f)):(f=k+e-a.marginBottom-f,b=d+a.marginTop>f?f-d:a.marginTop);c.top(b)}}else if(x=f){var e=
c.width(),f=c.height(),g=0,n=0;try{g=c.getStyle("margin-top"),n=c.getStyle("margin-bottom")}catch(J){}b=a.marginTop;h&&(b=m?d-k:b+d);c.addClass("zui-freezing").top(b);q.addClass("zui-freezing");c.width(e);q.setStyle({height:f,"margin-top":g,"margin-bottom":n}).show();(function(){q.height(c.height())}).delay(50);e==c.parent().width()&&(E=!0);0<a.pendingScrollTime&&(C=!0,function(){C=!1}.delay(a.pendingScrollTime))}else l()}else f!=x&&(x=f)}}function l(){c.removeClass("zui-freezing").top("auto").width("auto");
q.removeClass("zui-freezing").hide()}var c=zjs(d),a=c.getData("zmoduleuifreezepaneloption");if(a)c.setData("zmoduleuifreezepaneloption",zjs.extend(a,b));else{var a=zjs.clone(zjs.moduleUiFreezepanelOption),e=c.getAttr("data-option","");zjs.isString(e)&&""!=e.trim()&&(a=zjs.extend(a,e.jsonDecode()));"undefined"!=typeof b&&(a=zjs.extend(a,b));a.autoDisableWhenWidthLessThan=parseInt(a.autoDisableWhenWidthLessThan);0>a.autoDisableWhenWidthLessThan&&(a.autoDisableWhenWidthLessThan=0);a.handlerFreezingMethod in
D||(a.handlerFreezingMethod="meet-top");for(var p=!1,h=!1,e=d,F=!1,G=!1,m=!0;e;){e=e.parentNode;if(e==document.body||e==document){e=!1;break}!F&&zjs(e).hasClass("zfreezepanelwrap")&&(F=!0,p=zjs(e),c.setData("zmoduleuifreezepanelparentwrap",p));if("auto"==a.overflowParent&&!G){var y=zjs(e).getStyle("overflow");if("auto"===y||"scroll"===y)if(h=zjs(e),h.addClass("zui-freezepanel-scroll-wrap"),c.setData("zmoduleuifreezepaneloverflowparentwrap",h).addClass("zui-freeze-absolute"),G=!0,y=h.getStyle("overflow-y"),
"auto"===y||"scroll"===y)m=!1}}c.addClass("zui-freezepanel");var t=D[a.handlerFreezingMethod],u=a.handlerFreezingElement?zjs(a.handlerFreezingElement):c;u.item(0,!0)===c.item(0,!0)&&"scroll-over"==a.handlerFreezingMethod&&(a.handlerFreezingMethod="meet-top",a.handlerFreezingElement=!1,t=D[a.handlerFreezingMethod]);c.setData("zmoduleuifreezepaneloption",a);var A=zjs(window),z=zjs(document.body),w=t("getAnchorPosition",u),k=0,n=0,v=!0,B=!0;p&&(k=p.getAbsoluteTop());h&&(n=h.getAbsoluteTop());m?r()&&
(v=!1,z.on("scrollbar.ready",function(){w=t("getAnchorPosition",u);v=!0})):(w-=n,k-=n);var q=zjs("<div>").insertBefore(c).hide();q.addClass("zui-freezepanel-height-buffer");var x=!1,E=!1,C=!1,H=function(){0<a.autoDisableWhenWidthLessThan&&(c.width()<=a.autoDisableWhenWidthLessThan?(x=B=!1,l()):(B=!0,g()));q.height(c.height());var b=q.getAbsoluteTop();h&&(n=h.getAbsoluteTop());m?r()||(w=0!=b&&B&&c.hasClass("zui-freezing")?t("getAnchorPositionWhenActivated",u,a,{estimateOrgTop:b}):t("getAnchorPosition",
u)):(w-=n,k-=n);g();E&&c.width(c.parent().width())};c.on("trigger:refreshpanel",H);A.on("resize",function(){H.delay(100)});if(r())z.on("scrollbar.scroll",function(){g()});if(m){if(0<a.pendingScrollTime)A.on("mousewheel",function(a){C&&(a.stopPropagation(),a.preventDefault())});A.on("scroll",function(a){C||r()||(!v&&zjs(document.body).hasClass("zui-scrollbar-usedefault")&&(v=!0),g())})}else h.on("scroll",g);g();c.trigger("ui.freezepanel.load")}},D={"meet-top":function(d,b,g,l){if("getAnchorPosition"==
d)return b.getAbsoluteTop();if("getAnchorPositionWhenActivated"==d)return g.handlerFreezingElement?b.getAbsoluteTop():l.estimateOrgTop;if("checkActivate"==d)return l.scrollTop>l.orgAnchorPosition-g.marginTop},"scroll-over":function(d,b,g,l){if("getAnchorPosition"==d)return b.getAbsoluteTop()+b.height();if("getAnchorPositionWhenActivated"==d)return g.handlerFreezingElement?b.getAbsoluteTop()+b.height():l.estimateOrgTop+b.height();if("checkActivate"==d)return l.scrollTop>l.orgAnchorPosition}};zjs.extendMethod({makeFreezepanel:function(d){return this.each(function(b){I(b,
d)})}});zjs.hook({after_setInnerHTML:function(d){zjs(d).find(".zfreezepanel").makeFreezepanel()},after_insertDOM:function(d){zjs(d).hasClass("zfreezepanel")&&zjs(d).makeFreezepanel();zjs(d).find(".zfreezepanel").makeFreezepanel()}});zjs.onready(function(){zjs(".zfreezepanel").makeFreezepanel()});"required"in zjs&&zjs.required("ui.freezepanel")});