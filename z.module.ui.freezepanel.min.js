zjs.require("ui",function(){function M(){g.map(function(e){e.zEl.trigger("trigger:refreshpanel")})}zjs.extendCore({moduleUiFreezepanelOption:{marginTop:0,marginBottom:0,autoDisableWhenWidthLessThan:0,overflowParent:"auto",pendingScrollTime:0,autoHideWhenReach:!1,autoHideSpeed:2E3,autoHideDelay:0,useHeightBuffer:!0,excludeFromFreezingStack:!1,handlerFreezingElement:!1,handlerFreezingMethod:"meet-top"}});var v,I,w,z=function(){return!w.hasClass("zui-scrollbar-usedefault")&&0<parseInt(w.getData("zmodulescrollbarid",
0))},g=[],R=function(e){for(var c=0;c<g.length;c++)if(g[c].el===e)return c;return-1},N=function(e,c,b){b=b||null;var f=R(e);0>f||(g[f].top=null!==b?b:zjs(e).top(),g[f].height=zjs(e).height(),g[f].freezing=c?1:0)},W=function(e){var c=0,b,f;for(b=0;b<g.length;b++){zjs(g[b].el).setStyle("z-index",g.length-b);if(g[b].el===e)break;!g[b].exclude&&g[b].freezing&&(f=g[b].top+g[b].height,c<f&&(c=f))}return c},r=0,l=function(e){return e.getAbsoluteTop()+r},X=function(e,c){function b(){if(E){var b;b=x?z()?w.scrollPosition():
v.scrollTop()+r:m.getStyle("scrollTop");R(e);var n=W(e),c=A("checkActivate",B,a,{scrollTop:b,viewTop:n,orgAnchorPosition:F});if(J){if(x&&z()){var g=w.getData("zmodulescrollbaroption");g&&g.usecss&&(d.hasClass("zui-freezing")?d.item(0,!0).style.webkitTransform="translate3d(0, "+b+"px, 0)":d.item(0,!0).style.webkitTransform="none")}if(c===G){if(d.hasClass("zui-freezing")){var g=y?y.height():I.height(),c=d.height(),h=t?l(t):I.height();u=y?l(y):0;x||(u-=l(m));var k=u+g;k>h&&(k=h);m?x?(h=b+n-u,h+c>g&&
(h=g-c)):(h=b+n,h+c>g+u&&(h=g+u-c)):(h=k-a.marginBottom-c,h=b+n+a.marginTop>h?h-b:n+a.marginTop);t&&(h<-c&&(h=-c),n=!1,K<=b?(K=b,n=!1):n=!0,n&&(h+=K-b,0<h&&(h=0,K=b+c)));d.top(h)}N(e,d.hasClass("zui-freezing"),h)}else{if(G=c){var g=d.width(),c=d.height(),q=k=0;O=1>=Math.abs(g-d.parent().width());try{k=d.getStyle("margin-top"),q=d.getStyle("margin-bottom")}catch(Y){}h=a.marginTop+n;m&&(h=x?b+n-u:h+(b+n));d.addClass("zui-freezing").top(h);d.width(g);p=zjs("<div>");a.useHeightBuffer&&p.insertBefore(d);
p.setStyle({height:c,"margin-top":k,"margin-bottom":q}).addClass("zui-freezepanel-height-buffer");d.setData("zmoduleuifreezepanelbufferel",p);(function(){p&&p.height(d.height())}).delay(50);0<a.pendingScrollTime&&(L=!0,function(){L=!1}.delay(a.pendingScrollTime))}else f();N(e,d.hasClass("zui-freezing"))}}else N(e,0),c!=G&&(G=c)}}function f(){O=!1;d.removeClass("zui-freezing").top(null).width(null);p.remove();p=null;d.setData("zmoduleuifreezepanelbufferel",null)}var d=zjs(e),a=d.getData("zmoduleuifreezepaneloption");
if(a)d.setData("zmoduleuifreezepaneloption",zjs.extend(a,c));else{var a=zjs.clone(zjs.moduleUiFreezepanelOption),k=d.getAttr("data-option","");zjs.isString(k)&&""!=k.trim()&&(a=zjs.extend(a,k.jsonDecode()));d.removeAttr("data-option");"undefined"!=typeof c&&(a=zjs.extend(a,c));a.autoDisableWhenWidthLessThan=parseInt(a.autoDisableWhenWidthLessThan);0>a.autoDisableWhenWidthLessThan&&(a.autoDisableWhenWidthLessThan=0);a.handlerFreezingMethod in P||(a.handlerFreezingMethod="meet-top");a.excludeFromFreezingStack=
!!a.excludeFromFreezingStack;for(var y=!1,m=!1,k=e,D=!1,S=!1,x=!0;k;){k=k.parentNode;if(k==document.body||k==document){k=!1;break}!D&&zjs(k).hasClass("zfreezepanelwrap")&&(D=!0,y=zjs(k),d.setData("zmoduleuifreezepanelparentwrap",y));if("auto"==a.overflowParent&&!S){var H=zjs(k).getStyle("overflow");if("auto"===H||"scroll"===H)if(m=zjs(k),m.addClass("zui-freezepanel-scroll-wrap"),d.setData("zmoduleuifreezepaneloverflowparentwrap",m).addClass("zui-freeze-absolute"),S=!0,H=m.getStyle("overflow-y"),"auto"===
H||"scroll"===H)x=!1}}d.addClass("zui-freezepanel");var A=P[a.handlerFreezingMethod],B=a.handlerFreezingElement?zjs(a.handlerFreezingElement):d;B.item(0,!0)===d.item(0,!0)&&"scroll-over"==a.handlerFreezingMethod&&(a.handlerFreezingMethod="meet-top",a.handlerFreezingElement=!1,A=P[a.handlerFreezingMethod]);var t=!1;zjs.isString(a.autoHideWhenReach)?(t=zjs(a.autoHideWhenReach),t=1>t.count()?a.autoHideWhenReach=!1:t.item(0)):zjs.isNumeric(a.autoHideWhenReach)&&(t={getAbsoluteTop:function(){return a.autoHideWhenReach}});
var q=!1;a.autoHideSpeed=parseInt(a.autoHideSpeed,10);a.autoHideDelay=parseInt(a.autoHideDelay,10);if(isNaN(a.autoHideDelay)||0>a.autoHideDelay)a.autoHideDelay=0;isNaN(a.autoHideSpeed)||0>a.autoHideSpeed?a.autoHideSpeed=0:q=zjs.timer({from:0,to:0,time:a.autoHideSpeed,onStart:function(a,b){r=a;M()},onProcess:function(a,b,d){r=a;M()},onFinish:function(a,b){r=b;M()}});d.setData("zmoduleuifreezepaneloption",a);g.push({el:e,zEl:d,top:l(d),height:0,freezing:0,viewTop:0,exclude:a.excludeFromFreezingStack});
g.sort(function(a,b){return parseInt(a.top,10)-parseInt(b.top,10)});v=v||zjs(window);w=w||zjs(document.body);I=I||zjs(document);var F=A("getAnchorPosition",B),u=0,C=0,E=!0,J=!0;y&&(u=l(y));m&&(C=l(m));x?z()&&(E=!1,w.on("scrollbar:ready",function(){F=A("getAnchorPosition",B);E=!0})):(F-=C,u-=C);var p,G=!1,O=!1,L=!1,K=d.height(),T=function(){0<a.autoDisableWhenWidthLessThan&&(d.width()<=a.autoDisableWhenWidthLessThan?(G=J=!1,f()):(J=!0,b()));var c=0;p&&(p.height(d.height()),c=l(p));m&&(C=l(m));x?z()||
(F=0!=c&&J&&d.hasClass("zui-freezing")?A("getAnchorPositionWhenActivated",B,a,{estimateOrgTop:c}):A("getAnchorPosition",B)):(F-=C,u-=C);b();O&&d.width(d.parent().width())};d.on("trigger:refreshpanel",T);v.on("resize",function(){T.delay(100)});if(z())w.on("scrollbar:scroll",function(){b()});if(x){var V=function(){var a=v.scrollTop(),b=U-a;0>b?b=-1:0<b&&(b=1);U=a;0!==b&&b!=Q&&(q.stop(),Q=b);if(!q.isRunning()){var a=2*d.height(),c=t.getAbsoluteTop()-v.scrollTop();0>=c&&0>b&&r<a&&(q.isRunning()||q.set({from:r,
to:a}).run());0>=c&&0<b&&0<r&&(b!=Q&&q.stop(),q.isRunning()||q.set({from:r,to:0}).run())}};if(0<a.pendingScrollTime)v.on("mousewheel",function(a){L&&(a.stopPropagation(),a.preventDefault())});var Q=0,U=0;v.on("scroll",function(c){L||z()||(!E&&zjs(document.body).hasClass("zui-scrollbar-usedefault")&&(E=!0),b(),0>=a.autoHideSpeed||!t||(0<a.autoHideDelay?V.delay(a.autoHideDelay):V()))})}else m.on("scroll",b);b();d.trigger("ui:freezepanel:load")}},P={"meet-top":function(e,c,b,f){if("getAnchorPosition"==
e)return l(c);if("getAnchorPositionWhenActivated"==e)return b.handlerFreezingElement?l(c):f.estimateOrgTop;if("checkActivate"==e)return f.scrollTop+f.viewTop>=f.orgAnchorPosition-b.marginTop},"scroll-over":function(e,c,b,f){if("getAnchorPosition"==e)return l(c)+c.height();if("getAnchorPositionWhenActivated"==e)return b.handlerFreezingElement?l(c)+c.height():f.estimateOrgTop+c.height();if("checkActivate"==e)return f.scrollTop+f.viewTop>=f.orgAnchorPosition}},D=function(e,c){var b=zjs(c);if(!b.getData("zmoduleuifreezepaneloption")){for(var f=
!1,d,a=b.parent(!0).item(0,!0);a&&a!=document.body;){d=zjs(a);if(d.getData("zmoduleuifreezepaneloption")){f=!0;break}a=d.parent(!0).item(0,!0)}return f?d.hasClass("zui-freezing")?l(b)+D(e,a):l(b):l(b)}if(!b.hasClass("zui-freezing"))return l(b);f=b.getData("zmoduleuifreezepanelbufferel",null);if("original"==e)return f?l(f):l(b);b=l(b);f=f=z()?w.scrollPosition():v.scrollTop()+r;return f+b};zjs.extendMethod({makeFreezepanel:function(e){return this.eachElement(function(c){X(c,e)})},freezepanelGetOriginalTop:function(){return D("original",
this.item(0))},freezepanelGetAbsoluteTop:function(){return D("absolute",this.item(0))},freezepanelRefresh:function(){return this.eachElement(function(e){zjs(e).trigger("trigger:refreshpanel")})}});zjs.hook({after_setInnerHTML:function(e){zjs(e).find(".zfreezepanel").makeFreezepanel()},after_insertDOM:function(e){zjs(e).hasClass("zfreezepanel")&&zjs(e).makeFreezepanel();zjs(e).find(".zfreezepanel").makeFreezepanel()}});zjs.onready(function(){zjs(".zfreezepanel").makeFreezepanel()});"required"in zjs&&
zjs.required("ui.freezepanel")});