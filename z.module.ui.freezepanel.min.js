zjs.require("ui",function(){zjs.extendCore({moduleUiFreezepanelOption:{marginTop:0,marginBottom:0,autoDisableWhenWidthLessThan:0,overflowParent:"auto",pendingScrollTime:0,autoHideWhenReach:!1,handlerFreezingElement:!1,handlerFreezingMethod:"meet-top"}});var v,F,q,w=function(){return!q.hasClass("zui-scrollbar-usedefault")&&0<parseInt(q.getData("zmodulescrollbarid",0))},g=[],M=function(e){for(var b=0;b<g.length;b++)if(g[b].el===e)return b;return-1},J=function(e,b,a){a=a||null;var f=M(e);0>f||(g[f].top=
null!==a?a:zjs(e).top(),g[f].height=zjs(e).height(),g[f].freezing=b?1:0)},P=function(e){var b=0,a,f;for(a=0;a<g.length;a++){zjs(g[a].el).setStyle("z-index",g.length-a);if(g[a].el===e)break;g[a].freezing&&(f=g[a].top+g[a].height,b<f&&(b=f))}return b},Q=function(e,b){function a(){if(B){var a;a=r?w()?q.scrollPosition():v.scrollTop():m.getStyle("scrollTop");M(e);var b=P(e),l=x("checkActivate",y,c,{scrollTop:a,viewTop:b,orgAnchorPosition:C});if(G){if(r&&w()){var g=q.getData("zmodulescrollbaroption");g&&
g.usecss&&(d.hasClass("zui-freezing")?d.item(0,!0).style.webkitTransform="translate3d(0, "+a+"px, 0)":d.item(0,!0).style.webkitTransform="none")}if(l===D){if(d.hasClass("zui-freezing")){var g=u?u.height():F.height(),l=d.height(),h=z?z.getAbsoluteTop():F.height();n=u?u.getAbsoluteTop():0;r||(n-=m.getAbsoluteTop());var k=n+g;k>h&&(k=h);m?r?(h=a+b-n,h+l>g&&(h=g-l)):(h=a+b,h+l>g+n&&(h=g+n-l)):(h=k-c.marginBottom-l,h=a+b+c.marginTop>h?h-a:b+c.marginTop);z&&(h<-l&&(h=-l),b=!1,H<=a?(H=a,b=!1):b=!0,b&&(h+=
H-a,0<h&&(h=0,H=a+l)));d.top(h)}J(e,d.hasClass("zui-freezing"),h)}else{if(D=l){var g=d.width(),l=d.height(),t=k=0;K=1>=Math.abs(g-d.parent().width());try{k=d.getStyle("margin-top"),t=d.getStyle("margin-bottom")}catch(R){}h=c.marginTop+b;m&&(h=r?a+b-n:h+(a+b));d.addClass("zui-freezing").top(h);d.width(g);p=zjs("<div>").insertBefore(d);p.setStyle({height:l,"margin-top":k,"margin-bottom":t}).addClass("zui-freezepanel-height-buffer");d.setData("zmoduleuifreezepanelbufferel",p);(function(){p&&p.height(d.height())}).delay(50);
0<c.pendingScrollTime&&(I=!0,function(){I=!1}.delay(c.pendingScrollTime))}else f();J(e,d.hasClass("zui-freezing"))}}else J(e,0),l!=D&&(D=l)}}function f(){K=!1;d.removeClass("zui-freezing").top(null).width(null);p.remove();p=null;d.setData("zmoduleuifreezepanelbufferel",null)}var d=zjs(e),c=d.getData("zmoduleuifreezepaneloption");if(c)d.setData("zmoduleuifreezepaneloption",zjs.extend(c,b));else{var c=zjs.clone(zjs.moduleUiFreezepanelOption),k=d.getAttr("data-option","");zjs.isString(k)&&""!=k.trim()&&
(c=zjs.extend(c,k.jsonDecode()));"undefined"!=typeof b&&(c=zjs.extend(c,b));c.autoDisableWhenWidthLessThan=parseInt(c.autoDisableWhenWidthLessThan);0>c.autoDisableWhenWidthLessThan&&(c.autoDisableWhenWidthLessThan=0);c.handlerFreezingMethod in L||(c.handlerFreezingMethod="meet-top");for(var u=!1,m=!1,k=e,A=!1,N=!1,r=!0;k;){k=k.parentNode;if(k==document.body||k==document){k=!1;break}!A&&zjs(k).hasClass("zfreezepanelwrap")&&(A=!0,u=zjs(k),d.setData("zmoduleuifreezepanelparentwrap",u));if("auto"==c.overflowParent&&
!N){var E=zjs(k).getStyle("overflow");if("auto"===E||"scroll"===E)if(m=zjs(k),m.addClass("zui-freezepanel-scroll-wrap"),d.setData("zmoduleuifreezepaneloverflowparentwrap",m).addClass("zui-freeze-absolute"),N=!0,E=m.getStyle("overflow-y"),"auto"===E||"scroll"===E)r=!1}}d.addClass("zui-freezepanel");var x=L[c.handlerFreezingMethod],y=c.handlerFreezingElement?zjs(c.handlerFreezingElement):d;y.item(0,!0)===d.item(0,!0)&&"scroll-over"==c.handlerFreezingMethod&&(c.handlerFreezingMethod="meet-top",c.handlerFreezingElement=
!1,x=L[c.handlerFreezingMethod]);var z=!1;c.autoHideWhenReach&&(z=zjs(c.autoHideWhenReach),1>z.count()&&(z=c.autoHideWhenReach=!1));d.setData("zmoduleuifreezepaneloption",c);g.push({el:e,top:d.getAbsoluteTop(),height:0,freezing:0,viewTop:0});g.sort(function(a,c){return parseInt(a.top,10)-parseInt(c.top,10)});v=v||zjs(window);q=q||zjs(document.body);F=F||zjs(document);var C=x("getAnchorPosition",y),n=0,t=0,B=!0,G=!0;u&&(n=u.getAbsoluteTop());m&&(t=m.getAbsoluteTop());r?w()&&(B=!1,q.on("scrollbar:ready",
function(){C=x("getAnchorPosition",y);B=!0})):(C-=t,n-=t);var p,D=!1,K=!1,I=!1,H=0,O=function(){0<c.autoDisableWhenWidthLessThan&&(d.width()<=c.autoDisableWhenWidthLessThan?(D=G=!1,f()):(G=!0,a()));var b=0;p&&(p.height(d.height()),b=p.getAbsoluteTop());m&&(t=m.getAbsoluteTop());r?w()||(C=0!=b&&G&&d.hasClass("zui-freezing")?x("getAnchorPositionWhenActivated",y,c,{estimateOrgTop:b}):x("getAnchorPosition",y)):(C-=t,n-=t);a();K&&d.width(d.parent().width())};d.on("trigger:refreshpanel",O);v.on("resize",
function(){O.delay(100)});if(w())q.on("scrollbar:scroll",function(){a()});if(r){if(0<c.pendingScrollTime)v.on("mousewheel",function(a){I&&(a.stopPropagation(),a.preventDefault())});v.on("scroll",function(b){I||w()||(!B&&zjs(document.body).hasClass("zui-scrollbar-usedefault")&&(B=!0),a())})}else m.on("scroll",a);a();d.trigger("ui:freezepanel:load")}},L={"meet-top":function(e,b,a,f){if("getAnchorPosition"==e)return b.getAbsoluteTop();if("getAnchorPositionWhenActivated"==e)return a.handlerFreezingElement?
b.getAbsoluteTop():f.estimateOrgTop;if("checkActivate"==e)return f.scrollTop+f.viewTop>f.orgAnchorPosition-a.marginTop},"scroll-over":function(e,b,a,f){if("getAnchorPosition"==e)return b.getAbsoluteTop()+b.height();if("getAnchorPositionWhenActivated"==e)return a.handlerFreezingElement?b.getAbsoluteTop()+b.height():f.estimateOrgTop+b.height();if("checkActivate"==e)return f.scrollTop+f.viewTop>f.orgAnchorPosition}},A=function(e,b){var a=zjs(b);if(!a.getData("zmoduleuifreezepaneloption")){for(var f=
!1,d,c=a.parent(!0).item(0,!0);c&&c!=document.body;){d=zjs(c);if(d.getData("zmoduleuifreezepaneloption")){f=!0;break}c=d.parent(!0).item(0,!0)}return f?d.hasClass("zui-freezing")?a.getAbsoluteTop()+A(e,c):a.getAbsoluteTop():a.getAbsoluteTop()}if(!a.hasClass("zui-freezing"))return a.getAbsoluteTop();f=a.getData("zmoduleuifreezepanelbufferel",null);if("original"==e)return f?f.getAbsoluteTop():a.getAbsoluteTop();a=a.getAbsoluteTop();f=f=w()?q.scrollPosition():v.scrollTop();return f+a};zjs.extendMethod({makeFreezepanel:function(e){return this.eachElement(function(b){Q(b,
e)})},freezepanelGetOriginalTop:function(){return A("original",this.item(0))},freezepanelGetAbsoluteTop:function(){return A("absolute",this.item(0))}});zjs.hook({after_setInnerHTML:function(e){zjs(e).find(".zfreezepanel").makeFreezepanel()},after_insertDOM:function(e){zjs(e).hasClass("zfreezepanel")&&zjs(e).makeFreezepanel();zjs(e).find(".zfreezepanel").makeFreezepanel()}});zjs.onready(function(){zjs(".zfreezepanel").makeFreezepanel()});"required"in zjs&&zjs.required("ui.freezepanel")});