zjs.require("ui",function(){zjs.extendCore({moduleUiFreezepanelOption:{freeze:!0,marginTop:0,marginBottom:0,autoDisableWhenWidthLessThan:0,autoDisableWhenWindowWidthLessThan:0,overflowParent:"auto",pendingScrollTime:0,autoHideWhenReach:!1,autoHideSpeed:2E3,autoHideDelay:0,useHeightBuffer:!0,excludeFromFreezingStack:!1,handlerFreezingElement:!1,handlerFreezingMethod:"meet-top"}});var q,K,t,y=function(){return!t.hasClass("zui-scrollbar-usedefault")&&0<parseInt(t.getData("zmodulescrollbarid",0))},g=
[],V=function(d){for(var e=0;e<g.length;e++)if(g[e].el===d)return e;return-1},P=function(d,e,a){a=a||null;var f=V(d);0>f||(g[f].top=null!==a?a:zjs(d).top(),g[f].height=zjs(d).height(),g[f].freezing=e?1:0)},W=function(d){var e=0,a;for(a=0;a<g.length;a++){zjs(g[a].el).setStyle("z-index",g.length-a);if(g[a].el===d)break;if(!g[a].exclude&&g[a].freezing){var f=g[a].top+g[a].height;e<f&&(e=f)}}return e},r=0,k=function(d){return d.getAbsoluteTop()+r},ba=function(d,e){function a(){if(G){var a=w?y()?t.scrollPosition():
q.scrollTop()+r:p.getStyle("scrollTop");V(d);var f=W(d);var e=A("checkActivate",B,b,{scrollTop:a,viewTop:f,orgAnchorPosition:H,parentEl:x,freezepanelEl:c});if(C){if(w&&y()){var g=t.getData("zmodulescrollbaroption");g&&g.usecss&&(c.hasClass("zui-freezing")?c.item(0,!0).style.webkitTransform="translate3d(0, "+a+"px, 0)":c.item(0,!0).style.webkitTransform="none")}if(e===D){if(c.hasClass("zui-freezing")){g=x?x.height():K.height();e=c.height();var h=u?k(u):K.height();v=x?k(x):0;w||(v-=k(p));var m=v+g;
m>h&&(m=h);if(p)if(w){var l=a+f-v;l+e>g&&(l=g-e)}else l=a+f,l+e>g+v&&(l=g+v-e);else g=m-b.marginBottom-e,l=a+f+b.marginTop>g?g-a:f+b.marginTop;u&&(l<-e&&(l=-e),f=!1,L<=a?(L=a,f=!1):f=!0,f&&(l+=L-a,0<l&&(l=0,L=a+e)));c.getData("zmoduleuifreezepanelalwayshow")&&(l=0);c.top(l)}P(d,c.hasClass("zui-freezing"),l)}else{if(D=e){g=c.width();e=c.height();var m=h=0,z=c.getAbsoluteTop();Q=1>=Math.abs(g-c.parent().width());try{h=c.getStyle("margin-top"),m=c.getStyle("margin-bottom")}catch(ca){}n=zjs("<div>");
b.useHeightBuffer&&n.insertBefore(c);n.setStyle({height:e,"margin-top":h,"margin-bottom":m}).addClass("zui-freezepanel-height-buffer");c.setData("zmoduleuifreezepanelbufferel",n);(function(){n&&n.height(c.height())}).delay(50);l=b.marginTop+f;p&&(l=w?a+f-v:l+(a+f));c.addClass("zui-freezing");E?(E=!1,c.top(z-a),setTimeout(function(){c.top(l)})):c.top(l);c.width(g);0<b.pendingScrollTime&&(M=!0,function(){M=!1}.delay(b.pendingScrollTime))}else X();P(d,c.hasClass("zui-freezing"))}}else P(d,0),e!=D&&(D=
e)}}function f(){N&&(c.removeClass("zui-freezing").top(null).width(null),n&&(n.remove(),n=null),N=!1)}function X(){Q=!1;N=!0;if(E&&n){E=!1;var b=n.getAbsoluteTop(),a=y()?t.scrollPosition():q.scrollTop()+r;c.top(b-a);(function(){f()}).delay(300)}else f();c.setData("zmoduleuifreezepanelbufferel",null)}var c=zjs(d),b=c.getData("zmoduleuifreezepaneloption");if(b)c.setData("zmoduleuifreezepaneloption",zjs.extend(b,e));else{var b=zjs.clone(zjs.moduleUiFreezepanelOption),h=c.getAttr("data-option","");zjs.isString(h)&&
""!=h.trim()&&(b=zjs.extend(b,h.jsonDecode()));c.removeAttr("data-option");"undefined"!=typeof e&&(b=zjs.extend(b,e));b.autoDisableWhenWidthLessThan=parseInt(b.autoDisableWhenWidthLessThan);0>b.autoDisableWhenWidthLessThan&&(b.autoDisableWhenWidthLessThan=0);b.autoDisableWhenWindowWidthLessThan=parseInt(b.autoDisableWhenWindowWidthLessThan);0>b.autoDisableWhenWindowWidthLessThan&&(b.autoDisableWhenWindowWidthLessThan=0);b.handlerFreezingMethod in R||(b.handlerFreezingMethod="meet-top");b.excludeFromFreezingStack=
!!b.excludeFromFreezingStack;for(var x=!1,p=!1,h=d,F=!1,J=!1,w=!0;h;){h=h.parentNode;if(h==document.body||h==document){h=!1;break}!F&&zjs(h).hasClass("zfreezepanelwrap")&&(F=!0,x=zjs(h),c.setData("zmoduleuifreezepanelparentwrap",x));if("auto"==b.overflowParent&&!J){var I=zjs(h).getStyle("overflow");if("auto"===I||"scroll"===I)if(p=zjs(h),p.addClass("zui-freezepanel-scroll-wrap"),c.setData("zmoduleuifreezepaneloverflowparentwrap",p).addClass("zui-freeze-absolute"),J=!0,I=p.getStyle("overflow-y"),"auto"===
I||"scroll"===I)w=!1}}c.addClass("zui-freezepanel");var A=R[b.handlerFreezingMethod],B=b.handlerFreezingElement?zjs(b.handlerFreezingElement):c;B.item(0,!0)===c.item(0,!0)&&"scroll-over"==b.handlerFreezingMethod&&(b.handlerFreezingMethod="meet-top",b.handlerFreezingElement=!1,A=R[b.handlerFreezingMethod]);var u=!1;zjs.isString(b.autoHideWhenReach)?(u=zjs(b.autoHideWhenReach),u=1>u.count()?b.autoHideWhenReach=!1:u.item(0)):zjs.isNumeric(b.autoHideWhenReach)&&(u={getAbsoluteTop:function(){return b.autoHideWhenReach}});
var m=!1;b.autoHideSpeed=parseInt(b.autoHideSpeed,10);b.autoHideDelay=parseInt(b.autoHideDelay,10);if(isNaN(b.autoHideDelay)||0>b.autoHideDelay)b.autoHideDelay=0;isNaN(b.autoHideSpeed)||0>b.autoHideSpeed?b.autoHideSpeed=0:m=zjs.timer({from:0,to:0,time:b.autoHideSpeed,onStart:function(b,a){r=b;S()},onProcess:function(b,a,c){r=b;S()},onFinish:function(b,a){r=a;S()}});c.setData("zmoduleuifreezepaneloption",b);g.push({el:d,zEl:c,top:k(c),height:0,freezing:0,viewTop:0,exclude:b.excludeFromFreezingStack});
g.sort(function(b,a){return b.el===a.el?0:b.el.compareDocumentPosition?b.el.compareDocumentPosition(a.el)&2?1:-1:b.el.sourceIndex-a.el.sourceIndex});q=q||zjs(window);t=t||zjs(document.body);K=K||zjs(document);var H=A("getAnchorPosition",B),v=0,z=0,G=!0,C=!0,E=!1;x&&(v=k(x));p&&(z=k(p));w?y()&&(G=!1,t.on("scrollbar:ready",function(){H=A("getAnchorPosition",B);G=!0})):(H-=z,v-=z);var n,D=!1,Q=!1,M=!1,L=c.height(),N=!1,O=function(){C&&(D=C=!1,X())},T=function(){C||(N&&f(),C=!0,D=!1,a())},Y=function(){0<
b.autoDisableWhenWidthLessThan&&(c.width()<=b.autoDisableWhenWidthLessThan?O():T());0<b.autoDisableWhenWindowWidthLessThan&&(q.width()<=b.autoDisableWhenWindowWidthLessThan?O():T());var d=0,e=c.getData("zmoduleuifreezepaneldisablechangeheightbufferkey");n&&(e||n.height(c.height()),d=k(n));p&&(z=k(p));w?y()||(H=0!=d&&C&&c.hasClass("zui-freezing")?A("getAnchorPositionWhenActivated",B,b,{estimateOrgTop:d}):A("getAnchorPosition",B)):(H-=z,v-=z);a();Q&&c.width(c.parent().width())};c.on("trigger:refreshpanel",
Y);q.on("resize",function(){Y.delay(100)});if(y())t.on("scrollbar:scroll",function(){a()});if(w){var aa=function(){if(!c.getData("zmoduleuifreezepaneldisableshowhide",!1)){var b=q.scrollTop(),a=Z-b;0>a?a=-1:0<a&&(a=1);Z=b;0!==a&&a!=U&&(m.stop(),U=a);if(!m.isRunning()){var b=2*c.height(),d=u.getAbsoluteTop()-q.scrollTop();0>=d&&0>a&&r<b&&(m.isRunning()||m.set({from:r,to:b}).run());0>=d&&0<a&&0<r&&(a!=U&&m.stop(),m.isRunning()||m.set({from:r,to:0}).run())}}};if(0<b.pendingScrollTime)q.on("mousewheel",
function(a){M&&(a.stopPropagation(),a.preventDefault())});var U=0,Z=0;q.on("scroll",function(c){M||y()||(!G&&zjs(document.body).hasClass("zui-scrollbar-usedefault")&&(G=!0),a(),0>=b.autoHideSpeed||!u||(0<b.autoHideDelay?aa.delay(b.autoHideDelay):aa()))})}else p.on("scroll",a);b.freeze?a():(O(),c.on("trigger:enablefreeze",function(a){E=a.getData()&&a.getData().effect;T()}),c.on("trigger:disablefreeze",function(a){E=a.getData()&&a.getData().effect;O()}));c.trigger("ui:freezepanel:load")}},J=function(d){zjs(d).trigger("trigger:refreshpanel")},
S=function(){g.map(function(d){d.zEl.trigger("trigger:refreshpanel")})},R={"meet-top":function(d,e,a,f){if("getAnchorPosition"==d)return k(e);if("getAnchorPositionWhenActivated"==d)return a.handlerFreezingElement?k(e):f.estimateOrgTop;if("checkActivate"==d)return f.parentEl&&f.freezepanelEl.height()>=f.parentEl.height()?!1:f.scrollTop+f.viewTop>=f.orgAnchorPosition-a.marginTop},"scroll-over":function(d,e,a,f){if("getAnchorPosition"==d)return k(e)+e.height();if("getAnchorPositionWhenActivated"==d)return a.handlerFreezingElement?
k(e)+e.height():f.estimateOrgTop+e.height();if("checkActivate"==d)return f.scrollTop+f.viewTop>=f.orgAnchorPosition}},F=function(d,e){var a=zjs(e);if(!a.getData("zmoduleuifreezepaneloption")){for(var f=!1,g,c=a.parent(!0).item(0,!0);c&&c!=document.body;){g=zjs(c);if(g.getData("zmoduleuifreezepaneloption")){f=!0;break}c=g.parent(!0).item(0,!0)}return f?g.hasClass("zui-freezing")?k(a)+F(d,c):k(a):k(a)}if(!a.hasClass("zui-freezing"))return k(a);f=a.getData("zmoduleuifreezepanelbufferel",null);if("original"==
d)return f?k(f):k(a);a=k(a);f=f=y()?t.scrollPosition():q.scrollTop()+r;return f+a};zjs.extendMethod({makeFreezepanel:function(d){return this.eachElement(function(e){ba(e,d)})},freezepanelGetOriginalTop:function(){return F("original",this.item(0))},freezepanelGetAbsoluteTop:function(){return F("absolute",this.item(0))},freezepanelRefresh:function(){return this.eachElement(function(d){J(d)})},freezepanelDisableAutoShowHide:function(d){return this.eachElement(function(e){zjs(e).setData("zmoduleuifreezepaneldisableshowhide",
d)})},freezepanelAlwayShow:function(d){return this.eachElement(function(e){var a=zjs(e),f=a.getData("zmoduleuifreezepaneloption");a.setData("zmoduleuifreezepaneldisableshowhide",d);a.setData("zmoduleuifreezepanelalwayshow",d);f.freeze?J(e):d?a.trigger("trigger:enablefreeze",{effect:!0}):a.trigger("trigger:disablefreeze",{effect:!0})})},freezepanelDisableChangeHeightBuffer:function(d){return this.eachElement(function(e){zjs(e).setData("zmoduleuifreezepaneldisablechangeheightbufferkey",d)})}});zjs.extendCore({freezepanelGetVisibleFreezingHeight:function(){return W(window)}});
zjs.hook({after_setInnerHTML:function(d){zjs(d).find(".zfreezepanel").makeFreezepanel()},after_insertDOM:function(d){zjs(d).hasClass("zfreezepanel")&&zjs(d).makeFreezepanel();zjs(d).find(".zfreezepanel").makeFreezepanel()}});zjs.onready(function(){zjs(".zfreezepanel").makeFreezepanel()});"required"in zjs&&zjs.required("ui.freezepanel")});