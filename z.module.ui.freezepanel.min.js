zjs.require("ui",function(){zjs.extendCore({moduleUiFreezepanelOption:{marginTop:0,marginBottom:0,autoDisableWhenWidthLessThan:0,overflowParent:"auto",pendingScrollTime:0,handlerFreezingElement:!1,handlerFreezingMethod:"meet-top"}});var r=function(){return!zjs(document.body).hasClass("zui-scrollbar-usedefault")&&0<parseInt(zjs(document.body).getData("zmodulescrollbarid",0))},I=function(d,a){function g(){if(t){var d;d=m?r()?z.scrollPosition():A.scrollTop():h.getStyle("scrollTop");var f=u("checkActivate",
v,c,{scrollTop:d,orgAnchorPosition:w});if(B){if(m&&r()){var a=z.getData("zmodulescrollbaroption");a&&a.usecss&&(b.hasClass("zui-freezing")?b.item(0,!0).style.webkitTransform="translate3d(0, "+d+"px, 0)":b.item(0,!0).style.webkitTransform="none")}if(f==x){if(p&&b.hasClass("zui-freezing")){var e=p.height(),f=b.height();k=p.getAbsoluteTop();m||(k-=h.getAbsoluteTop());h?m?(a=d-k,a+f>e&&(a=e-f)):(a=d,a+f>e+k&&(a=e+k-f)):(f=k+e-c.marginBottom-f,a=d+c.marginTop>f?f-d:c.marginTop);b.top(a)}}else if(x=f){var e=
b.width(),f=b.height(),g=0,n=0;try{g=b.getStyle("margin-top"),n=b.getStyle("margin-bottom")}catch(J){}a=c.marginTop;h&&(a=m?d-k:a+d);b.addClass("zui-freezing").top(a);q.addClass("zui-freezing");b.width(e);q.setStyle({height:f,"margin-top":g,"margin-bottom":n}).show();(function(){q.height(b.height())}).delay(50);e==b.parent().width()&&(D=!0);0<c.pendingScrollTime&&(C=!0,function(){C=!1}.delay(c.pendingScrollTime))}else l()}else f!=x&&(x=f)}}function l(){b.removeClass("zui-freezing").top("auto").width("auto");
q.removeClass("zui-freezing").hide()}var b=zjs(d),c=b.getData("zmoduleuifreezepaneloption");if(c)b.setData("zmoduleuifreezepaneloption",zjs.extend(c,a));else{var c=zjs.clone(zjs.moduleUiFreezepanelOption),e=b.getAttr("data-option","");zjs.isString(e)&&""!=e.trim()&&(c=zjs.extend(c,e.jsonDecode()));"undefined"!=typeof a&&(c=zjs.extend(c,a));c.autoDisableWhenWidthLessThan=parseInt(c.autoDisableWhenWidthLessThan);0>c.autoDisableWhenWidthLessThan&&(c.autoDisableWhenWidthLessThan=0);c.handlerFreezingMethod in
E||(c.handlerFreezingMethod="meet-top");b.setData("zmoduleuifreezepaneloption",c);for(var p=!1,h=!1,e=d,F=!1,G=!1,m=!0;e;){e=e.parentNode;if(e==document.body||e==document){e=!1;break}!F&&zjs(e).hasClass("zfreezepanelwrap")&&(F=!0,p=zjs(e),b.setData("zmoduleuifreezepanelparentwrap",p));if("auto"==c.overflowParent&&!G){var y=zjs(e).getStyle("overflow");if("auto"===y||"scroll"===y)if(h=zjs(e),h.addClass("zui-freezepanel-scroll-wrap"),b.setData("zmoduleuifreezepaneloverflowparentwrap",h).addClass("zui-freeze-absolute"),
G=!0,y=h.getStyle("overflow-y"),"auto"===y||"scroll"===y)m=!1}}b.addClass("zui-freezepanel");var u=E[c.handlerFreezingMethod],v=c.handlerFreezingElement?zjs(c.handlerFreezingElement):b,A=zjs(window),z=zjs(document.body),w=u("getAnchorPosition",v),k=0,n=0,t=!0,B=!0;p&&(k=p.getAbsoluteTop());h&&(n=h.getAbsoluteTop());m?r()&&(t=!1,z.on("scrollbar.ready",function(){w=u("getAnchorPosition",v);t=!0})):(w-=n,k-=n);var q=zjs("<div>").insertBefore(b).hide();q.addClass("zui-freezepanel-height-buffer");var x=
!1,D=!1,C=!1,H=function(){0<c.autoDisableWhenWidthLessThan&&(b.width()<=c.autoDisableWhenWidthLessThan?(x=B=!1,l()):(B=!0,g()));q.height(b.height());var a=q.getAbsoluteTop();h&&(n=h.getAbsoluteTop());m?r()||(w=0!=a&&B&&b.hasClass("zui-freezing")?u("getAnchorPositionWhenActivated",v,c,{estimateOrgTop:a}):u("getAnchorPosition",v)):(w-=n,k-=n);g();D&&b.width(b.parent().width())};b.on("trigger:refreshpanel",H);A.on("resize",function(){H.delay(100)});if(r())z.on("scrollbar.scroll",function(){g()});if(m){if(0<
c.pendingScrollTime)A.on("mousewheel",function(a){C&&(a.stopPropagation(),a.preventDefault())});A.on("scroll",function(a){C||r()||(!t&&zjs(document.body).hasClass("zui-scrollbar-usedefault")&&(t=!0),g())})}else h.on("scroll",g);g();b.trigger("ui.freezepanel.load")}},E={"meet-top":function(d,a,g,l){if("getAnchorPosition"==d)return a.getAbsoluteTop();if("getAnchorPositionWhenActivated"==d)return g.handlerFreezingElement?a.getAbsoluteTop():l.estimateOrgTop;if("checkActivate"==d)return l.scrollTop>l.orgAnchorPosition-
g.marginTop},"scroll-over":function(d,a,g,l){if("getAnchorPosition"==d)return a.getAbsoluteTop()+a.height();if("getAnchorPositionWhenActivated"==d)return g.handlerFreezingElement?a.getAbsoluteTop()+a.height():l.estimateOrgTop+a.height();if("checkActivate"==d)return l.scrollTop>l.orgAnchorPosition}};zjs.extendMethod({makeFreezepanel:function(d){return this.each(function(a){I(a,d)})}});zjs.hook({after_setInnerHTML:function(d){zjs(d).find(".zfreezepanel").makeFreezepanel()},after_insertDOM:function(d){zjs(d).hasClass("zfreezepanel")&&
zjs(d).makeFreezepanel();zjs(d).find(".zfreezepanel").makeFreezepanel()}});zjs.onready(function(){zjs(".zfreezepanel").makeFreezepanel()});"required"in zjs&&zjs.required("ui.freezepanel")});