zjs.require("ui",function(){zjs.extendCore({moduleUiFreezepanelOption:{freeze:!0,marginTop:0,marginBottom:0,autoDisableWhenWidthLessThan:0,overflowParent:"auto",pendingScrollTime:0,autoHideWhenReach:!1,autoHideSpeed:2E3,autoHideDelay:0,useHeightBuffer:!0,excludeFromFreezingStack:!1,handlerFreezingElement:!1,handlerFreezingMethod:"meet-top"}});var t,L,u,y=function(){return!u.hasClass("zui-scrollbar-usedefault")&&0<parseInt(u.getData("zmodulescrollbarid",0))},g=[],U=function(c){for(var e=0;e<g.length;e++)if(g[e].el===
c)return e;return-1},O=function(c,e,a){a=a||null;var f=U(c);0>f||(g[f].top=null!==a?a:zjs(c).top(),g[f].height=zjs(c).height(),g[f].freezing=e?1:0)},Y=function(c){var e=0,a,f;for(a=0;a<g.length;a++){zjs(g[a].el).setStyle("z-index",g.length-a);if(g[a].el===c)break;!g[a].exclude&&g[a].freezing&&(f=g[a].top+g[a].height,e<f&&(e=f))}return e},r=0,l=function(c){return c.getAbsoluteTop()+r},Z=function(c,e){function a(){if(H){var a;a=x?y()?u.scrollPosition():t.scrollTop()+r:q.getStyle("scrollTop");U(c);var e=
Y(c),n=D("checkActivate",E,b,{scrollTop:a,viewTop:e,orgAnchorPosition:I});if(z){if(x&&y()){var g=u.getData("zmodulescrollbaroption");g&&g.usecss&&(d.hasClass("zui-freezing")?d.item(0,!0).style.webkitTransform="translate3d(0, "+a+"px, 0)":d.item(0,!0).style.webkitTransform="none")}if(n===C){var h;if(d.hasClass("zui-freezing")){var g=A?A.height():L.height(),n=d.height(),k=v?l(v):L.height();w=A?l(A):0;x||(w-=l(q));var p=w+g;p>k&&(p=k);q?x?(h=a+e-w,h+n>g&&(h=g-n)):(h=a+e,h+n>g+w&&(h=g+w-n)):(g=p-b.marginBottom-
n,h=a+e+b.marginTop>g?g-a:e+b.marginTop);v&&(h<-n&&(h=-n),e=!1,M<=a?(M=a,e=!1):e=!0,e&&(h+=M-a,0<h&&(h=0,M=a+n)));d.getData("zmoduleuifreezepanelalwayshow")&&(h=0);d.top(h)}O(c,d.hasClass("zui-freezing"),h)}else{if(C=n){var g=d.width(),n=d.height(),p=k=0,B=d.getAbsoluteTop();P=1>=Math.abs(g-d.parent().width());try{k=d.getStyle("margin-top"),p=d.getStyle("margin-bottom")}catch(aa){}m=zjs("<div>");b.useHeightBuffer&&m.insertBefore(d);m.setStyle({height:n,"margin-top":k,"margin-bottom":p}).addClass("zui-freezepanel-height-buffer");
d.setData("zmoduleuifreezepanelbufferel",m);(function(){m&&m.height(d.height())}).delay(50);h=b.marginTop+e;q&&(h=x?a+e-w:h+(a+e));d.addClass("zui-freezing");F?(F=!1,d.top(B-a),function(){d.top(h)}.delay(100)):d.top(h);d.width(g);0<b.pendingScrollTime&&(N=!0,function(){N=!1}.delay(b.pendingScrollTime))}else f();O(c,d.hasClass("zui-freezing"))}}else O(c,0),n!=C&&(C=n)}}function f(){P=!1;if(F&&m){F=!1;var b=m.getAbsoluteTop(),a=y()?u.scrollPosition():t.scrollTop()+r;d.top(b-a);(function(){d.removeClass("zui-freezing").top(null).width(null);
m.remove();m=null}).delay(300)}else d.removeClass("zui-freezing").top(null).width(null),m&&(m.remove(),m=null);d.setData("zmoduleuifreezepanelbufferel",null)}var d=zjs(c),b=d.getData("zmoduleuifreezepaneloption");if(b)d.setData("zmoduleuifreezepaneloption",zjs.extend(b,e));else{var b=zjs.clone(zjs.moduleUiFreezepanelOption),k=d.getAttr("data-option","");zjs.isString(k)&&""!=k.trim()&&(b=zjs.extend(b,k.jsonDecode()));d.removeAttr("data-option");"undefined"!=typeof e&&(b=zjs.extend(b,e));b.autoDisableWhenWidthLessThan=
parseInt(b.autoDisableWhenWidthLessThan);0>b.autoDisableWhenWidthLessThan&&(b.autoDisableWhenWidthLessThan=0);b.handlerFreezingMethod in Q||(b.handlerFreezingMethod="meet-top");b.excludeFromFreezingStack=!!b.excludeFromFreezingStack;for(var A=!1,q=!1,k=c,G=!1,K=!1,x=!0;k;){k=k.parentNode;if(k==document.body||k==document){k=!1;break}!G&&zjs(k).hasClass("zfreezepanelwrap")&&(G=!0,A=zjs(k),d.setData("zmoduleuifreezepanelparentwrap",A));if("auto"==b.overflowParent&&!K){var J=zjs(k).getStyle("overflow");
if("auto"===J||"scroll"===J)if(q=zjs(k),q.addClass("zui-freezepanel-scroll-wrap"),d.setData("zmoduleuifreezepaneloverflowparentwrap",q).addClass("zui-freeze-absolute"),K=!0,J=q.getStyle("overflow-y"),"auto"===J||"scroll"===J)x=!1}}d.addClass("zui-freezepanel");var D=Q[b.handlerFreezingMethod],E=b.handlerFreezingElement?zjs(b.handlerFreezingElement):d;E.item(0,!0)===d.item(0,!0)&&"scroll-over"==b.handlerFreezingMethod&&(b.handlerFreezingMethod="meet-top",b.handlerFreezingElement=!1,D=Q[b.handlerFreezingMethod]);
var v=!1;zjs.isString(b.autoHideWhenReach)?(v=zjs(b.autoHideWhenReach),v=1>v.count()?b.autoHideWhenReach=!1:v.item(0)):zjs.isNumeric(b.autoHideWhenReach)&&(v={getAbsoluteTop:function(){return b.autoHideWhenReach}});var p=!1;b.autoHideSpeed=parseInt(b.autoHideSpeed,10);b.autoHideDelay=parseInt(b.autoHideDelay,10);if(isNaN(b.autoHideDelay)||0>b.autoHideDelay)b.autoHideDelay=0;isNaN(b.autoHideSpeed)||0>b.autoHideSpeed?b.autoHideSpeed=0:p=zjs.timer({from:0,to:0,time:b.autoHideSpeed,onStart:function(b,
a){r=b;R()},onProcess:function(b,a,d){r=b;R()},onFinish:function(b,a){r=a;R()}});d.setData("zmoduleuifreezepaneloption",b);g.push({el:c,zEl:d,top:l(d),height:0,freezing:0,viewTop:0,exclude:b.excludeFromFreezingStack});g.sort(function(b,a){return parseInt(b.top,10)-parseInt(a.top,10)});t=t||zjs(window);u=u||zjs(document.body);L=L||zjs(document);var I=D("getAnchorPosition",E),w=0,B=0,H=!0,z=!0,F=!1;A&&(w=l(A));q&&(B=l(q));x?y()&&(H=!1,u.on("scrollbar:ready",function(){I=D("getAnchorPosition",E);H=!0})):
(I-=B,w-=B);var m,C=!1,P=!1,N=!1,M=d.height(),S=function(){z&&(C=z=!1,f())},V=function(){0<b.autoDisableWhenWidthLessThan&&(d.width()<=b.autoDisableWhenWidthLessThan?S():z||(z=!0,C=!1,a()));var c=0,e=d.getData("zmoduleuifreezepaneldisablechangeheightbufferkey");m&&(e||m.height(d.height()),c=l(m));q&&(B=l(q));x?y()||(I=0!=c&&z&&d.hasClass("zui-freezing")?D("getAnchorPositionWhenActivated",E,b,{estimateOrgTop:c}):D("getAnchorPosition",E)):(I-=B,w-=B);a();P&&d.width(d.parent().width())};d.on("trigger:refreshpanel",
V);t.on("resize",function(){V.delay(100)});if(y())u.on("scrollbar:scroll",function(){a()});if(x){var X=function(){if(!d.getData("zmoduleuifreezepaneldisableshowhide",!1)){var b=t.scrollTop(),a=W-b;0>a?a=-1:0<a&&(a=1);W=b;0!==a&&a!=T&&(p.stop(),T=a);if(!p.isRunning()){var b=2*d.height(),c=v.getAbsoluteTop()-t.scrollTop();0>=c&&0>a&&r<b&&(p.isRunning()||p.set({from:r,to:b}).run());0>=c&&0<a&&0<r&&(a!=T&&p.stop(),p.isRunning()||p.set({from:r,to:0}).run())}}};if(0<b.pendingScrollTime)t.on("mousewheel",
function(a){N&&(a.stopPropagation(),a.preventDefault())});var T=0,W=0;t.on("scroll",function(c){N||y()||(!H&&zjs(document.body).hasClass("zui-scrollbar-usedefault")&&(H=!0),a(),0>=b.autoHideSpeed||!v||(0<b.autoHideDelay?X.delay(b.autoHideDelay):X()))})}else q.on("scroll",a);b.freeze?a():(S(),d.on("trigger:enablefreeze",function(b){F=b.getData()&&b.getData().effect;z||(z=!0,C=!1,a())}),d.on("trigger:disablefreeze",function(a){F=a.getData()&&a.getData().effect;S()}));d.trigger("ui:freezepanel:load")}},
K=function(c){zjs(c).trigger("trigger:refreshpanel")},R=function(){g.map(function(c){c.zEl.trigger("trigger:refreshpanel")})},Q={"meet-top":function(c,e,a,f){if("getAnchorPosition"==c)return l(e);if("getAnchorPositionWhenActivated"==c)return a.handlerFreezingElement?l(e):f.estimateOrgTop;if("checkActivate"==c)return f.scrollTop+f.viewTop>=f.orgAnchorPosition-a.marginTop},"scroll-over":function(c,e,a,f){if("getAnchorPosition"==c)return l(e)+e.height();if("getAnchorPositionWhenActivated"==c)return a.handlerFreezingElement?
l(e)+e.height():f.estimateOrgTop+e.height();if("checkActivate"==c)return f.scrollTop+f.viewTop>=f.orgAnchorPosition}},G=function(c,e){var a=zjs(e);if(!a.getData("zmoduleuifreezepaneloption")){for(var f=!1,d,b=a.parent(!0).item(0,!0);b&&b!=document.body;){d=zjs(b);if(d.getData("zmoduleuifreezepaneloption")){f=!0;break}b=d.parent(!0).item(0,!0)}return f?d.hasClass("zui-freezing")?l(a)+G(c,b):l(a):l(a)}if(!a.hasClass("zui-freezing"))return l(a);f=a.getData("zmoduleuifreezepanelbufferel",null);if("original"==
c)return f?l(f):l(a);a=l(a);f=f=y()?u.scrollPosition():t.scrollTop()+r;return f+a};zjs.extendMethod({makeFreezepanel:function(c){return this.eachElement(function(e){Z(e,c)})},freezepanelGetOriginalTop:function(){return G("original",this.item(0))},freezepanelGetAbsoluteTop:function(){return G("absolute",this.item(0))},freezepanelRefresh:function(){return this.eachElement(function(c){K(c)})},freezepanelDisableAutoShowHide:function(c){return this.eachElement(function(e){zjs(e).setData("zmoduleuifreezepaneldisableshowhide",
c)})},freezepanelAlwayShow:function(c){return this.eachElement(function(e){var a=zjs(e),f=a.getData("zmoduleuifreezepaneloption");a.setData("zmoduleuifreezepaneldisableshowhide",c);a.setData("zmoduleuifreezepanelalwayshow",c);f.freeze?K(e):c?a.trigger("trigger:enablefreeze",{effect:!0}):a.trigger("trigger:disablefreeze",{effect:!0})})},freezepanelDisableChangeHeightBuffer:function(c){return this.eachElement(function(e){zjs(e).setData("zmoduleuifreezepaneldisablechangeheightbufferkey",c)})}});zjs.hook({after_setInnerHTML:function(c){zjs(c).find(".zfreezepanel").makeFreezepanel()},
after_insertDOM:function(c){zjs(c).hasClass("zfreezepanel")&&zjs(c).makeFreezepanel();zjs(c).find(".zfreezepanel").makeFreezepanel()}});zjs.onready(function(){zjs(".zfreezepanel").makeFreezepanel()});"required"in zjs&&zjs.required("ui.freezepanel")});