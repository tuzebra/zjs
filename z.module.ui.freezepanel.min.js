zjs.require("ui",function(){zjs.extendCore({moduleUiFreezepanelOption:{marginTop:0,marginBottom:0,autoDisableWhenWidthLessThan:0,overflowParent:"auto",pendingScrollTime:0,handlerFreezingElement:!1,handlerFreezingMethod:"meet-top"}});var r,l,t=function(){return!l.hasClass("zui-scrollbar-usedefault")&&0<parseInt(l.getData("zmodulescrollbarid",0))},H=function(a,e){function d(){if(x){var d;d=m?t()?l.scrollPosition():r.scrollTop():h.getStyle("scrollTop");var a=v("checkActivate",w,b,{scrollTop:d,orgAnchorPosition:y});
if(B){if(m&&t()){var e=l.getData("zmodulescrollbaroption");e&&e.usecss&&(c.hasClass("zui-freezing")?c.item(0,!0).style.webkitTransform="translate3d(0, "+d+"px, 0)":c.item(0,!0).style.webkitTransform="none")}if(a==z){if(u&&c.hasClass("zui-freezing")){var f=u.height(),a=c.height();k=u.getAbsoluteTop();m||(k-=h.getAbsoluteTop());h?m?(e=d-k,e+a>f&&(e=f-a)):(e=d,e+a>f+k&&(e=f+k-a)):(a=k+f-b.marginBottom-a,e=d+b.marginTop>a?a-d:b.marginTop);c.top(e)}}else if(z=a){var f=c.width(),a=c.height(),n=0,p=0;try{n=
c.getStyle("margin-top"),p=c.getStyle("margin-bottom")}catch(I){}e=b.marginTop;h&&(e=m?d-k:e+d);c.addClass("zui-freezing").top(e);q.addClass("zui-freezing");c.width(f);q.setStyle({height:a,"margin-top":n,"margin-bottom":p}).show();(function(){q.height(c.height())}).delay(50);f==c.parent().width()&&(E=!0);0<b.pendingScrollTime&&(C=!0,function(){C=!1}.delay(b.pendingScrollTime))}else g()}else a!=z&&(z=a)}}function g(){c.removeClass("zui-freezing").top("auto").width("auto");q.removeClass("zui-freezing").hide()}
var c=zjs(a),b=c.getData("zmoduleuifreezepaneloption");if(b)c.setData("zmoduleuifreezepaneloption",zjs.extend(b,e));else{var b=zjs.clone(zjs.moduleUiFreezepanelOption),f=c.getAttr("data-option","");zjs.isString(f)&&""!=f.trim()&&(b=zjs.extend(b,f.jsonDecode()));"undefined"!=typeof e&&(b=zjs.extend(b,e));b.autoDisableWhenWidthLessThan=parseInt(b.autoDisableWhenWidthLessThan);0>b.autoDisableWhenWidthLessThan&&(b.autoDisableWhenWidthLessThan=0);b.handlerFreezingMethod in D||(b.handlerFreezingMethod=
"meet-top");for(var u=!1,h=!1,f=a,p=!1,F=!1,m=!0;f;){f=f.parentNode;if(f==document.body||f==document){f=!1;break}!p&&zjs(f).hasClass("zfreezepanelwrap")&&(p=!0,u=zjs(f),c.setData("zmoduleuifreezepanelparentwrap",u));if("auto"==b.overflowParent&&!F){var A=zjs(f).getStyle("overflow");if("auto"===A||"scroll"===A)if(h=zjs(f),h.addClass("zui-freezepanel-scroll-wrap"),c.setData("zmoduleuifreezepaneloverflowparentwrap",h).addClass("zui-freeze-absolute"),F=!0,A=h.getStyle("overflow-y"),"auto"===A||"scroll"===
A)m=!1}}c.addClass("zui-freezepanel");var v=D[b.handlerFreezingMethod],w=b.handlerFreezingElement?zjs(b.handlerFreezingElement):c;w.item(0,!0)===c.item(0,!0)&&"scroll-over"==b.handlerFreezingMethod&&(b.handlerFreezingMethod="meet-top",b.handlerFreezingElement=!1,v=D[b.handlerFreezingMethod]);c.setData("zmoduleuifreezepaneloption",b);r=r||zjs(window);l=l||zjs(document.body);var y=v("getAnchorPosition",w),k=0,n=0,x=!0,B=!0;u&&(k=u.getAbsoluteTop());h&&(n=h.getAbsoluteTop());m?t()&&(x=!1,l.on("scrollbar:ready",
function(){y=v("getAnchorPosition",w);x=!0})):(y-=n,k-=n);var q=zjs("<div>").insertBefore(c).hide();q.addClass("zui-freezepanel-height-buffer");c.setData("zmoduleuifreezepanelbufferel",q);var z=!1,E=!1,C=!1,G=function(){0<b.autoDisableWhenWidthLessThan&&(c.width()<=b.autoDisableWhenWidthLessThan?(z=B=!1,g()):(B=!0,d()));q.height(c.height());var a=q.getAbsoluteTop();h&&(n=h.getAbsoluteTop());m?t()||(y=0!=a&&B&&c.hasClass("zui-freezing")?v("getAnchorPositionWhenActivated",w,b,{estimateOrgTop:a}):v("getAnchorPosition",
w)):(y-=n,k-=n);d();E&&c.width(c.parent().width())};c.on("trigger:refreshpanel",G);r.on("resize",function(){G.delay(100)});t()&&(console.log("isBodyScrollbarActive"),l.on("scrollbar:scroll",function(){d()}));if(m){if(0<b.pendingScrollTime)r.on("mousewheel",function(a){C&&(a.stopPropagation(),a.preventDefault())});r.on("scroll",function(a){C||t()||(!x&&zjs(document.body).hasClass("zui-scrollbar-usedefault")&&(x=!0),d())})}else h.on("scroll",d);d();c.trigger("ui:freezepanel:load")}},D={"meet-top":function(a,
e,d,g){if("getAnchorPosition"==a)return e.getAbsoluteTop();if("getAnchorPositionWhenActivated"==a)return d.handlerFreezingElement?e.getAbsoluteTop():g.estimateOrgTop;if("checkActivate"==a)return g.scrollTop>g.orgAnchorPosition-d.marginTop},"scroll-over":function(a,e,d,g){if("getAnchorPosition"==a)return e.getAbsoluteTop()+e.height();if("getAnchorPositionWhenActivated"==a)return d.handlerFreezingElement?e.getAbsoluteTop()+e.height():g.estimateOrgTop+e.height();if("checkActivate"==a)return g.scrollTop>
g.orgAnchorPosition}},p=function(a,e){var d=zjs(e);if(!d.getData("zmoduleuifreezepaneloption")){for(var g=!1,c,b=d.parent(!0).item(0,!0);b&&b!=document.body;){c=zjs(b);if(c.getData("zmoduleuifreezepaneloption")){g=!0;break}b=c.parent(!0).item(0,!0)}return g?c.hasClass("zui-freezing")?d.getAbsoluteTop()+p(a,b):d.getAbsoluteTop():d.getAbsoluteTop()}if(!d.hasClass("zui-freezing"))return d.getAbsoluteTop();g=d.getData("zmoduleuifreezepanelbufferel");if("original"==a)return g?g.getAbsoluteTop():d.getAbsoluteTop();
d=d.getAbsoluteTop();g=g=t()?l.scrollPosition():r.scrollTop();return g+d};zjs.extendMethod({makeFreezepanel:function(a){return this.eachElement(function(e){H(e,a)})},freezepanelGetOriginalTop:function(){return p("original",this.item(0))},freezepanelGetAbsoluteTop:function(){return p("absolute",this.item(0))}});zjs.hook({after_setInnerHTML:function(a){zjs(a).find(".zfreezepanel").makeFreezepanel()},after_insertDOM:function(a){zjs(a).hasClass("zfreezepanel")&&zjs(a).makeFreezepanel();zjs(a).find(".zfreezepanel").makeFreezepanel()}});
zjs.onready(function(){zjs(".zfreezepanel").makeFreezepanel()});"required"in zjs&&zjs.required("ui.freezepanel")});