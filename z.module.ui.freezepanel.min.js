zjs.require("ui",function(){zjs.extendCore({moduleUiFreezepanelOption:{marginTop:0,marginBottom:0,autoDisableWhenWidthLessThan:0,overflowParent:"auto",pendingScrollTime:0,autoHideWhenReach:!1,useHeightBuffer:!0,handlerFreezingElement:!1,handlerFreezingMethod:"meet-top"}});var w,F,q,x=function(){return!q.hasClass("zui-scrollbar-usedefault")&&0<parseInt(q.getData("zmodulescrollbarid",0))},g=[],M=function(e){for(var c=0;c<g.length;c++)if(g[c].el===e)return c;return-1},J=function(e,c,a){a=a||null;var f=
M(e);0>f||(g[f].top=null!==a?a:zjs(e).top(),g[f].height=zjs(e).height(),g[f].freezing=c?1:0)},P=function(e){var c=0,a,f;for(a=0;a<g.length;a++){zjs(g[a].el).setStyle("z-index",g.length-a);if(g[a].el===e)break;g[a].freezing&&(f=g[a].top+g[a].height,c<f&&(c=f))}return c},Q=function(e,c){function a(){if(B){var a;a=r?x()?q.scrollPosition():w.scrollTop():m.getStyle("scrollTop");M(e);var c=P(e),l=y("checkActivate",z,b,{scrollTop:a,viewTop:c,orgAnchorPosition:C});if(G){if(r&&x()){var g=q.getData("zmodulescrollbaroption");
g&&g.usecss&&(d.hasClass("zui-freezing")?d.item(0,!0).style.webkitTransform="translate3d(0, "+a+"px, 0)":d.item(0,!0).style.webkitTransform="none")}if(l===D){if(d.hasClass("zui-freezing")){var g=u?u.height():F.height(),l=d.height(),h=v?v.getAbsoluteTop():F.height();p=u?u.getAbsoluteTop():0;r||(p-=m.getAbsoluteTop());var k=p+g;k>h&&(k=h);m?r?(h=a+c-p,h+l>g&&(h=g-l)):(h=a+c,h+l>g+p&&(h=g+p-l)):(h=k-b.marginBottom-l,h=a+c+b.marginTop>h?h-a:c+b.marginTop);v&&(h<-l&&(h=-l),c=!1,H<=a?(H=a,c=!1):c=!0,c&&
(h+=H-a,0<h&&(h=0,H=a+l)));d.top(h)}J(e,d.hasClass("zui-freezing"),h)}else{if(D=l){var g=d.width(),l=d.height(),t=k=0;K=1>=Math.abs(g-d.parent().width());try{k=d.getStyle("margin-top"),t=d.getStyle("margin-bottom")}catch(R){}h=b.marginTop+c;m&&(h=r?a+c-p:h+(a+c));d.addClass("zui-freezing").top(h);d.width(g);n=zjs("<div>");b.useHeightBuffer&&n.insertBefore(d);n.setStyle({height:l,"margin-top":k,"margin-bottom":t}).addClass("zui-freezepanel-height-buffer");d.setData("zmoduleuifreezepanelbufferel",n);
(function(){n&&n.height(d.height())}).delay(50);0<b.pendingScrollTime&&(I=!0,function(){I=!1}.delay(b.pendingScrollTime))}else f();J(e,d.hasClass("zui-freezing"))}}else J(e,0),l!=D&&(D=l)}}function f(){K=!1;d.removeClass("zui-freezing").top(null).width(null);n.remove();n=null;d.setData("zmoduleuifreezepanelbufferel",null)}var d=zjs(e),b=d.getData("zmoduleuifreezepaneloption");if(b)d.setData("zmoduleuifreezepaneloption",zjs.extend(b,c));else{var b=zjs.clone(zjs.moduleUiFreezepanelOption),k=d.getAttr("data-option",
"");zjs.isString(k)&&""!=k.trim()&&(b=zjs.extend(b,k.jsonDecode()));d.removeAttr("data-option");"undefined"!=typeof c&&(b=zjs.extend(b,c));b.autoDisableWhenWidthLessThan=parseInt(b.autoDisableWhenWidthLessThan);0>b.autoDisableWhenWidthLessThan&&(b.autoDisableWhenWidthLessThan=0);b.handlerFreezingMethod in L||(b.handlerFreezingMethod="meet-top");for(var u=!1,m=!1,k=e,A=!1,N=!1,r=!0;k;){k=k.parentNode;if(k==document.body||k==document){k=!1;break}!A&&zjs(k).hasClass("zfreezepanelwrap")&&(A=!0,u=zjs(k),
d.setData("zmoduleuifreezepanelparentwrap",u));if("auto"==b.overflowParent&&!N){var E=zjs(k).getStyle("overflow");if("auto"===E||"scroll"===E)if(m=zjs(k),m.addClass("zui-freezepanel-scroll-wrap"),d.setData("zmoduleuifreezepaneloverflowparentwrap",m).addClass("zui-freeze-absolute"),N=!0,E=m.getStyle("overflow-y"),"auto"===E||"scroll"===E)r=!1}}d.addClass("zui-freezepanel");var y=L[b.handlerFreezingMethod],z=b.handlerFreezingElement?zjs(b.handlerFreezingElement):d;z.item(0,!0)===d.item(0,!0)&&"scroll-over"==
b.handlerFreezingMethod&&(b.handlerFreezingMethod="meet-top",b.handlerFreezingElement=!1,y=L[b.handlerFreezingMethod]);var v=!1;zjs.isString(b.autoHideWhenReach)?(v=zjs(b.autoHideWhenReach),v=1>v.count()?b.autoHideWhenReach=!1:v.item(0)):zjs.isNumeric(b.autoHideWhenReach)&&(v={getAbsoluteTop:function(){return b.autoHideWhenReach}});d.setData("zmoduleuifreezepaneloption",b);g.push({el:e,top:d.getAbsoluteTop(),height:0,freezing:0,viewTop:0});g.sort(function(a,b){return parseInt(a.top,10)-parseInt(b.top,
10)});w=w||zjs(window);q=q||zjs(document.body);F=F||zjs(document);var C=y("getAnchorPosition",z),p=0,t=0,B=!0,G=!0;u&&(p=u.getAbsoluteTop());m&&(t=m.getAbsoluteTop());r?x()&&(B=!1,q.on("scrollbar:ready",function(){C=y("getAnchorPosition",z);B=!0})):(C-=t,p-=t);var n,D=!1,K=!1,I=!1,H=d.height(),O=function(){0<b.autoDisableWhenWidthLessThan&&(d.width()<=b.autoDisableWhenWidthLessThan?(D=G=!1,f()):(G=!0,a()));var c=0;n&&(n.height(d.height()),c=n.getAbsoluteTop());m&&(t=m.getAbsoluteTop());r?x()||(C=
0!=c&&G&&d.hasClass("zui-freezing")?y("getAnchorPositionWhenActivated",z,b,{estimateOrgTop:c}):y("getAnchorPosition",z)):(C-=t,p-=t);a();K&&d.width(d.parent().width())};d.on("trigger:refreshpanel",O);w.on("resize",function(){O.delay(100)});if(x())q.on("scrollbar:scroll",function(){a()});if(r){if(0<b.pendingScrollTime)w.on("mousewheel",function(a){I&&(a.stopPropagation(),a.preventDefault())});w.on("scroll",function(b){I||x()||(!B&&zjs(document.body).hasClass("zui-scrollbar-usedefault")&&(B=!0),a())})}else m.on("scroll",
a);a();d.trigger("ui:freezepanel:load")}},L={"meet-top":function(e,c,a,f){if("getAnchorPosition"==e)return c.getAbsoluteTop();if("getAnchorPositionWhenActivated"==e)return a.handlerFreezingElement?c.getAbsoluteTop():f.estimateOrgTop;if("checkActivate"==e)return f.scrollTop+f.viewTop>=f.orgAnchorPosition-a.marginTop},"scroll-over":function(e,c,a,f){if("getAnchorPosition"==e)return c.getAbsoluteTop()+c.height();if("getAnchorPositionWhenActivated"==e)return a.handlerFreezingElement?c.getAbsoluteTop()+
c.height():f.estimateOrgTop+c.height();if("checkActivate"==e)return f.scrollTop+f.viewTop>=f.orgAnchorPosition}},A=function(e,c){var a=zjs(c);if(!a.getData("zmoduleuifreezepaneloption")){for(var f=!1,d,b=a.parent(!0).item(0,!0);b&&b!=document.body;){d=zjs(b);if(d.getData("zmoduleuifreezepaneloption")){f=!0;break}b=d.parent(!0).item(0,!0)}return f?d.hasClass("zui-freezing")?a.getAbsoluteTop()+A(e,b):a.getAbsoluteTop():a.getAbsoluteTop()}if(!a.hasClass("zui-freezing"))return a.getAbsoluteTop();f=a.getData("zmoduleuifreezepanelbufferel",
null);if("original"==e)return f?f.getAbsoluteTop():a.getAbsoluteTop();a=a.getAbsoluteTop();f=f=x()?q.scrollPosition():w.scrollTop();return f+a};zjs.extendMethod({makeFreezepanel:function(e){return this.eachElement(function(c){Q(c,e)})},freezepanelGetOriginalTop:function(){return A("original",this.item(0))},freezepanelGetAbsoluteTop:function(){return A("absolute",this.item(0))}});zjs.hook({after_setInnerHTML:function(e){zjs(e).find(".zfreezepanel").makeFreezepanel()},after_insertDOM:function(e){zjs(e).hasClass("zfreezepanel")&&
zjs(e).makeFreezepanel();zjs(e).find(".zfreezepanel").makeFreezepanel()}});zjs.onready(function(){zjs(".zfreezepanel").makeFreezepanel()});"required"in zjs&&zjs.required("ui.freezepanel")});