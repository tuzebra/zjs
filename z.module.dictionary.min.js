(function(l,f){var e=function(a,d){this.datas=[];this.lastSearchIndexs=[];this.indexDictionary=[];this.indexId=[];this.indexWord=[];this.addIndex(a,d);this.dataSourceUrl="";this.defaultSearchProperty="text";this.lastRawquery="";return this};e.prototype.setDataSourceUrl=function(a){this.dataSourceUrl=a};e.prototype.addIndex=function(a,d){if("undefined"==typeof a||"function"==typeof a)return this;if(a.constructor===Array){for(var b=0;b<a.length;b++)this.addIndex(a[b],d);return this}if("object"==typeof a&&
"id.text"==d){for(var c in a)this.addIndex({id:c,text:a[c]},"text");return this}this.defaultSearchProperty=d=d||"text";b="";c={};"string"==typeof a&&(b=a);"object"==typeof a&&(b=a[d]||"",c=a);if(!("object"==typeof c&&"id"in c&&this.getItemById(c.id))){this.datas.push(f.extend(c,{text:b.toString()}));for(var h=this.datas.length-1,b=b.toString().removeVietnameseCharacter().toLowerCase(),e=b.split(" "),g="",b=0;b<e.length;b++){g=e[b];if("undefined"==typeof this.indexDictionary[g]||this.indexDictionary[g].constructor!==
Array)this.indexDictionary[g]=[],this.indexWord.push(g);this.indexDictionary[g].push(h)}"id"in c&&(this.indexId[c.id]=h);return this}};e.prototype.removeIndex=function(a,d){"string"!=typeof a&&(a="");"function"!=typeof d&&(d=function(){return!0});this.search(a);var b,c;for(b=0;b<this.lastSearchIndexs.length;b++)c=this.lastSearchIndexs[b],!0===d(this.datas[c])&&(this.datas[c]=null);return this};e.prototype.getItemById=function(a){return!a in this.indexId?!1:this.datas[this.indexId[a]]};e.prototype.search=
function(a){""!=this.dataSourceUrl&&this.getDataFromDataSource(a,!1);var d=[];a=a.removeVietnameseCharacter().toLowerCase().split(" ");var b,c,h,e,g,f;for(b=0;b<a.length;b++){h=a[b];g=[];f=[];e=[];for(c=0;c<this.indexWord.length;c++)0<=this.indexWord[c].indexOf(h)&&e.push(this.indexWord[c]);for(c=0;c<e.length;c++)for(h=0;h<this.indexDictionary[e[c]].length;h++)g[this.indexDictionary[e[c]][h].toString()]=!0;for(var k in g)(0==b||k in d)&&"function"!=typeof g[k]&&(f[k]=!0);d=f}this.lastSearchIndexs=
[];a=[];for(k in d)!0===d[k]&&k in this.datas&&null!=this.datas[k]&&(a.push(this.datas[k]),this.lastSearchIndexs.push(k));return a};e.prototype.getDataFromDataSource=function(a,d){var b=this;f.ajax({url:this.dataSourceUrl,data:{f:"text",q:a},type:"json",method:"get",cache:!1,onBegin:!1,onLoading:!1,onComplete:function(a){b.addIndex(a,b.defaultSearchProperty);f.isFunction(d)&&d(a)},onError:!1,debug:!1})};e.prototype.asyncGetItemById=function(a,d){var b=this.getItemById(a);if(b)f.isFunction(d)&&d(b);
else if(""!=this.dataSourceUrl){var c=this;f.ajax({url:this.dataSourceUrl,data:{f:"id",id:a},type:"json",method:"get",cache:!1,onBegin:!1,onLoading:!1,onComplete:function(b){c.addIndex(b,c.defaultSearchProperty);(b=c.getItemById(a))&&f.isFunction(d)&&d(b)},onError:!1,debug:!1})}};e.prototype.asyncSearch=function(a,d){this.lastRawquery=a;var b=this.search(a);f.isFunction(d)&&d(b);if(""!=this.dataSourceUrl){var c=this;this.getDataFromDataSource(a,function(){var b=c.search(a);f.isFunction(d)&&a==c.lastRawquery&&
d(b)})}};f.extendCore({dictionary:e});f.required("dictionary")})(window,zjs);
