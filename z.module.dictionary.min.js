(function(l,f){var e=function(a,d){this.datas=[];this.lastSearchIndexs=[];this.indexDictionary=[];this.indexId=[];this.indexWord=[];this.addIndex(a,d);this.cacheResponse=!0;this.usedCacheDataSource=!1;this.dataSourceDataStructure=this.dataSourceUrl="";this.defaultSearchProperty=d||"text";this.lastRawquery="";this.dataSourceUrlIsLoaded=!1;return this};e.prototype.setCacheResponse=function(a){this.cacheResponse=a};e.prototype.useCacheDataSource=function(a){this.usedCacheDataSource=a};e.prototype.setDataSourceUrl=
function(a){this.dataSourceUrl=a};e.prototype.setDataSourceDataStructure=function(a){this.dataSourceDataStructure=a};e.prototype.addIndex=function(a,d){if("undefined"==typeof a||"function"==typeof a)return this;if(a.constructor===Array){for(var b=0;b<a.length;b++)this.addIndex(a[b],d);return this}if("object"==typeof a&&"id.text"==d){for(var c in a)this.addIndex({id:c,text:a[c]},"text");return this}this.defaultSearchProperty=d=d||"text";b="";c={};"string"==typeof a&&(b=a);"object"==typeof a&&(b=a[d]||
"",c=a);if("object"==typeof c&&("id"in c||""===b||(c.id=b),this.getItemById(c.id)))return;this.datas.push(f.extend(c,{text:b.toString()}));for(var h=this.datas.length-1,b=b.toString().removeVietnameseCharacter().toLowerCase(),k=b.split(" "),g,b=0;b<k.length;b++){g=k[b];if("undefined"==typeof this.indexDictionary[g]||this.indexDictionary[g].constructor!==Array)this.indexDictionary[g]=[],this.indexWord.push(g);this.indexDictionary[g].push(h)}"id"in c&&(this.indexId[c.id]=h);return this};e.prototype.removeIndex=
function(a,d){"string"!=typeof a&&(a="");"function"!=typeof d&&(d=function(){return!0});this.search(a);var b;for(b=0;b<this.lastSearchIndexs.length;b++){var c=this.lastSearchIndexs[b];!0===d(this.datas[c])&&(this.datas[c]=null)}return this};e.prototype.getItemById=function(a){return!a in this.indexId?!1:this.datas[this.indexId[a]]};e.prototype.search=function(a){var d=[];a=a.removeVietnameseCharacter().toLowerCase().split(" ");var b,c;for(b=0;b<a.length;b++){var h=a[b];var k=[];var g=[];var f=[];
for(c=0;c<this.indexWord.length;c++)0<=this.indexWord[c].indexOf(h)&&f.push(this.indexWord[c]);for(c=0;c<f.length;c++)for(h=0;h<this.indexDictionary[f[c]].length;h++)k[this.indexDictionary[f[c]][h].toString()]=!0;for(var e in k)(0==b||e in d)&&"function"!=typeof k[e]&&(g[e]=!0);d=g}this.lastSearchIndexs=[];a=[];for(e in d)!0===d[e]&&e in this.datas&&null!=this.datas[e]&&(a.push(this.datas[e]),this.lastSearchIndexs.push(e));return a};e.prototype.getDataFromDataSource=function(a,d){var b=this;if(b.dataSourceUrlIsLoaded)f.isFunction(d)&&
d();else{b.usedCacheDataSource&&(b.dataSourceUrlIsLoaded=!0);var c=a||"";f.isString(c)&&(c=c.toLowerCase());f.ajax({url:this.dataSourceUrl,data:{f:"text",q:c},type:"json",method:"get",cache:this.cacheResponse,cacheResponse:this.cacheResponse,onBegin:!1,onLoading:!1,onComplete:function(a){if(""!=b.dataSourceDataStructure){var c=b.dataSourceDataStructure.split(".");if(1<c.length&&""==c[0])for(var e=1;e<c.length;e++)a=a[c[e]]}b.addIndex(a,b.defaultSearchProperty);f.isFunction(d)&&d(a)},onError:!1,debug:!1})}};
e.prototype.asyncGetItemById=function(a,d){var b=this.getItemById(a);if(b)f.isFunction(d)&&d(b);else if(""!=this.dataSourceUrl){var c=this;f.ajax({url:this.dataSourceUrl,data:{f:"id",id:a},type:"json",method:"get",cache:!1,onBegin:!1,onLoading:!1,onComplete:function(b){if(""!=c.dataSourceDataStructure){var e=c.dataSourceDataStructure.split(".");if(1<e.length&&""==e[0])for(var g=1;g<e.length;g++)b=b[e[g]]}c.addIndex(b,c.defaultSearchProperty);(b=c.getItemById(a))&&f.isFunction(d)&&d(b)},onError:!1,
debug:!1})}};e.prototype.asyncSearch=function(a,d){this.lastRawquery=a;var b=this.search(a);f.isFunction(d)&&d(b);if(""!=this.dataSourceUrl){var c=this;this.getDataFromDataSource(a,function(){var b=c.search(a);f.isFunction(d)&&a==c.lastRawquery&&d(b)})}};f.extendCore({dictionary:e});f.required("dictionary")})(window,zjs);