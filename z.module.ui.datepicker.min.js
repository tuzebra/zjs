zjs.require("ui, ui.button, ui.slider, moment",function(){var t=zjs("html").getAttr("lang","en").split("-"),t=t[0],w={en:{format:"MM-DD-YYYY",calendarTitleFormat:"MMMM, YYYY",timesliderLabel:{h:"hour",m:"minute",s:"second"},firstOfWeek:0,orbefore:"or before",orafter:"or after"},vi:{format:"DD-MM-YYYY",calendarTitleFormat:"MMMM, YYYY",timesliderLabel:{h:"gi\u1edd",m:"ph\u00fat",s:"gi\u00e2y"},firstOfWeek:1,orbefore:"ho\u1eb7c tr\u01b0\u1edbc",orafter:"ho\u1eb7c sau"}};zjs.extendCore({moduleUiDatepickerOption:{full:!1,
time:!1,hour:!0,hourmin:0,hourmax:23,hourstep:1,minute:!0,minutemin:0,minutemax:59,minutestep:1,second:!0,secondmin:0,secondmax:59,secondstep:1,button:!0,language:t,firstOfWeek:w[t].firstOfWeek,calendarTitleFormat:w[t].calendarTitleFormat,format:w[t].format,href:"",selectweek:!1,inputClass:"",disabledDate:!1,calendarChangeMonthYear:!0,calendarYearFieldUseInput:!1}});var I=function(q,l){var d=zjs(q),a=d.getData("zmoduleuidatepickeroption");if(a)d.setData("zmoduleuidatepickeroption",zjs.extend(a,l));
else{var a=zjs.clone(zjs.moduleUiDatepickerOption),b=d.getAttr("data-option","");zjs.isString(b)&&""!=b.trim()&&(a=zjs.extend(a,b.jsonDecode()));d.removeAttr("data-option");"undefined"!=typeof l&&(a=zjs.extend(a,l));b=d.getAttr("data-href","");""!=b&&(a.href=b);zjs.isString(a.disabledDate)&&(a.disabledDate=a.disabledDate.split(/\s*,\s*/));zjs.isArray(a.disabledDate)&&(a.disabledDate=function(){var c=a.disabledDate,d=[],e=!1,b=moment().format("YYYY-MM-DD"),f=moment().add(1,"day").format("YYYY-MM-DD"),
h=moment().add(-1,"day").format("YYYY-MM-DD");c.each(function(a){a=a.trim();a=a.replace("today",b).replace("tomorrow",f).replace("yesterday",h).replace("to","<<").replace("before","<").replace("after",">");var c="";0<=a.indexOf("<<")&&a.match(/(\d\d\d\d-\d\d?-\d\d?)\s*<<\s*(\d\d\d\d-\d\d?-\d\d?)/)&&(a=RegExp.$1+"<<",c=RegExp.$2);e=moment(a,"YYYY-MM-DD");if(e.isValid()){var p="=";0<=a.indexOf("<<")?p="<<":0<=a.indexOf("<")?p="<":0<=a.indexOf(">")&&(p=">");"<<"==p&&(e.add(-1,"day"),c=moment(c,"YYYY-MM-DD").add(1,
"day").format("YYYY-MM-DD"));d.push({comparison:p,date:e.format("YYYY-MM-DD"),date2:c})}});return 0>=d.length?!1:function(a){var c=!1,e="";d.each(function(d){"="==d.comparison?e="isSame":"<"==d.comparison?e="isBefore":">"==d.comparison?e="isAfter":"<<"==d.comparison&&(e="isBetween");if(moment(a,"YYYY-MM-DD")[e](d.date,d.date2))return c=!0,!1});return c}}());zjs.isFunction(a.disabledDate)||(a.disabledDate=!1);d.setData("zmoduleuidatepickeroption",a);var g=zjs('<div class="zui-datepicker"><div class="zui-datepicker-input-wrap"><input type="text" class="zui-contextual-button zui-datepicker-input" /></div><div class="zui-datepicker-button-wrap"><a class="zui-contextual-button zui-datepicker-button"></a></div><div class="zui-contextual-panel-wrap zui-datepicker-panel-wrap zui-hide"><div class="zui-datepicker-panel-inner"><div class="zui-datepicker-panel"></div><div class="zui-datepicker-month-change"></div><a class="zui-datepicker-nav zui-datepicker-nav-prev" data-count="-1"><i></i></a><a class="zui-datepicker-nav zui-datepicker-nav-next" data-count="1"><i></i></a><div class="zui-datepicker-time-panel"><div class="zui-datepicker-time-inner"><div class="timeunit hour"><label>hour</label><span></span><input /></div><div class="timeunit minute"><label>minute</label><span></span><input /></div><div class="timeunit second"><label>second</label><span></span><input /></div></div></div></div></div></div>').insertAfter(d);
d.setData("zmoduleuidatepickerwrapel",g);var r=d.getValue(""),b=""==r?moment():moment(r,"YYYY-MM-DD HH:mm:ss");a.hour||b.hour(0);a.minute||b.minute(0);a.second||b.second(0);var t=d.getAttr("placeholder","");b.locale(a.language);var B=g.find(".zui-datepicker-panel-wrap"),u=g.find(".zui-datepicker-panel"),f=g.find(".zui-datepicker-time-panel");a.full&&B.addClass("zui-full");if(a.time){B.on("click",function(a){a.preventDefault();a.stop()});if(a.hour){var v=f.find(".hour"),F=v.find("span");v.find("label").html(w[a.language].timesliderLabel.h);
v.find("input").setValue(b.hour()).makeUiSlider({min:a.hourmin,max:a.hourmax,step:a.hourstep,referer:F}).on("ui.slider.change",function(c){var x=d.getData("zmoduleuidatepickerselectdatetime").hour(c.data.value);g.find(".zui-button-label").html(x.format(a.format));"setvalue"!=c.data.via&&(c=x.format("YYYY-MM-DD HH:mm:ss"),d.setAttr("value",c).setValue(c),d.trigger("ui.datepicker.change",{value:c}))})}else f.find(".hour").remove();if(a.minute){var k=f.find(".minute"),F=k.find("span");k.find("label").html(w[a.language].timesliderLabel.m);
k.find("input").setValue(b.minute()).makeUiSlider({min:a.minutemin,max:a.minutemax,step:a.minutestep,referer:F}).on("ui.slider.change",function(c){var x=d.getData("zmoduleuidatepickerselectdatetime").minute(c.data.value);g.find(".zui-button-label").html(x.format(a.format));"setvalue"!=c.data.via&&(c=x.format("YYYY-MM-DD HH:mm:ss"),d.setAttr("value",c).setValue(c),d.trigger("ui.datepicker.change",{value:c}))})}else f.find(".minute").remove();if(a.second){var y=f.find(".second"),f=y.find("span");y.find("label").html(w[a.language].timesliderLabel.s);
y.find("input").setValue(b.second()).makeUiSlider({min:a.secondmin,max:a.secondmax,step:a.secondstep,referer:f}).on("ui.slider.change",function(c){var x=d.getData("zmoduleuidatepickerselectdatetime").second(c.data.value);g.find(".zui-button-label").html(x.format(a.format));"setvalue"!=c.data.via&&(c=x.format("YYYY-MM-DD HH:mm:ss"),d.setAttr("value",c).setValue(c),d.trigger("ui.datepicker.change",{value:c}))})}else f.find(".second").remove();a.hour&&b.hour(v.find("input").getValue());a.minute&&b.minute(k.find("input").getValue());
a.second&&b.second(y.find("input").getValue())}else f.remove();f=moment(b);d.setData("zmoduleuidatepickercalendardatetime",f);d.setData("zmoduleuidatepickerselectdatetime",moment(b));v=b.format(a.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");if(""!=r||""==t)a.disabledDate&&a.disabledDate(b.format("YYYY-MM-DD"))||(d.setAttr("value",v).setValue(v),d.trigger("ui.datepicker.change",{value:v}));var k=B.find(".zui-datepicker-month-change"),C=!1,A=!1;if(a.calendarChangeMonthYear){y=moment();y.locale(a.language);
var G=function(c){var d="",e=moment();e.locale(a.language);for(var b=0;12>b;b++)d+='<option value="'+b+'" '+(c==b?"selected":"")+" >"+e.month(b).format(a.full?"MMMM":"MMM")+"</option>";return d},f='<select class="zui-calendar-input-month">'+G(f.month()),f=f+"</select>";if(a.calendarYearFieldUseInput)f+='<input class="zui-calendar-input-year" value="'+y.format("YYYY")+'" />';else var H=function(c){for(var d="",e=c-40;e<=c+20;e++)d+='<option value="'+e+'" '+(e==c?"selected":"")+" >"+(e==c-40?e+" ("+
w[a.language].orbefore+")":e==c+20?e+" ("+w[a.language].orafter+")":e)+"</option>";return d},f=f+'<select class="zui-calendar-input-year">'+H(y.year()),f=f+"</select>";k.html(f);C=k.find(".zui-calendar-input-month");A=k.find(".zui-calendar-input-year");g.on("click",".zui-calendar-input-month, .zui-calendar-input-year",function(a){h&&h.hasClass("isfocus")&&(D=!0);a.preventDefault();a.stop()});k=function(){var c=moment();c.month(C.getValue().toInt()).year(A.getValue().toInt());if(c.isValid()){var b=
d.getData("zmoduleuidatepickercalendardatetime"),e=d.getData("zmoduleuidatepickerselectdatetime");b.month(c.month()).year(c.year());u.find(".zui-calendar-wrap").remove();u.append(E(b,e,a));d.trigger("ui.datepicker.changeMonth",{value:b.format(a.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD")})}};if(a.calendarYearFieldUseInput)A.on("keydown",function(a){0>[48,49,50,51,52,53,54,55,56,57,37,39,8,9,13].indexOf(a.keyCode())&&a.preventDefault()}).on("keyup",k);else A.on("change",k);C.on("change",k)}else k.remove();
g.find(".zui-datepicker-nav").click(function(c){h&&h.hasClass("isfocus")&&(D=!0);c.preventDefault();c.stop();c=d.getData("zmoduleuidatepickercalendardatetime");var b=d.getData("zmoduleuidatepickerselectdatetime");c.month(c.month()+this.attr("data-count").toInt());u.find(".zui-calendar-wrap").remove();u.append(E(c,b,a));d.trigger("ui.datepicker.changeMonth",{value:c.format(a.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD")})});var h=!1,z=!1;if(a.button)g.find(".zui-datepicker-input-wrap").remove(),z=g.find(".zui-datepicker-button"),
z.makeButton(),r=t,""==r&&(r=a.format),z.find(".zui-button-label").html(a.disabledDate&&a.disabledDate(b.format("YYYY-MM-DD"))?r:b.format(a.format)),z.on("click",function(a,d){a.preventDefault();a.stop();var e=z.hasClass("activenothover");zjs(".zui-contextual-button").removeClass("activenothover");zjs(".zui-contextual-panel-wrap").addClass("zui-hide");e||(z.addClass("activenothover"),B.removeClass("zui-hide"))});else{g.find(".zui-datepicker-button-wrap").remove();h=g.find(".zui-datepicker-input");
if(""!=r||""==t)a.disabledDate&&a.disabledDate(b.format("YYYY-MM-DD"))||h.setValue(b.format(a.format));r=t;""==r&&(r=a.format);h.setAttr("placeholder",r);h.addClass(a.inputClass);d.on("focus",function(){h.focus()});var D=!1;h.on("focus",function(a){a.preventDefault();D=!1;zjs(".zui-datepicker-input").removeClass("isfocus");zjs(".zui-contextual-button").removeClass("activenothover");zjs(".zui-contextual-panel-wrap").addClass("zui-hide");this.addClass("isfocus");d.addClass("activenothover");B.removeClass("zui-hide")});
h.on("click",function(a){a.stop()});var m="";h.on("keydown",function(c){"DD/MM/YYYY"==a.format&&0>[48,49,50,51,52,53,54,55,56,57,37,39,8,9,13,191].indexOf(c.keyCode())&&c.preventDefault()});h.on("keyup",function(c){c.preventDefault();(m=this.getValue(""))&&(m=m.trim());if(""!=m&&(c=moment(m,a.format),c.isValid())){var b=d.getData("zmoduleuidatepickercalendardatetime"),e=d.getData("zmoduleuidatepickerselectdatetime");b.year(c.year()).month(c.month()).date(c.date());e.year(c.year()).month(c.month()).date(c.date());
u.find(".zui-calendar-wrap").remove();u.append(E(b,e,a))}});h.on("blur",function(c){var b=this;(m=b.getValue(""))&&(m=m.trim());(function(){if(!D){if(""!=m){var c=moment(m,a.format);c.isValid()||(m="");""!=m&&a.disabledDate&&a.disabledDate(c.format("YYYY-MM-DD"))&&(m="")}if(""!=m){var f=d.getData("zmoduleuidatepickercalendardatetime"),g=d.getData("zmoduleuidatepickerselectdatetime");g.year(c.year()).month(c.month()).date(c.date());f.year(c.year()).month(c.month()).date(c.date());d.setData("zmoduleuidatepickerselectdatetime",
g);d.setData("zmoduleuidatepickercalendardatetime",f);u.find(".zui-calendar-wrap").remove();u.append(E(f,g,a));b.setValue(g.format(a.format));c=g.format(a.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");d.setAttr("value",c).setValue(c);d.trigger("ui.datepicker.change",{value:c})}else h.setValue(""),d.setAttr("value","").setValue(""),d.trigger("ui.datepicker.change",{value:""});d.trigger("ui.datepicker.blur",{});B.addClass("zui-hide");b.removeClass("isfocus")}}).delay(200)})}d.addClass("zui-uihide");u.on("click",
"[data-date]",function(c){h&&h.hasClass("isfocus")&&(D=!0,h.removeClass("isfocus"));c=zjs(this);var b=c.attr("data-date"),e=d.getData("zmoduleuidatepickerselectdatetime"),e=moment(e.format("["+b+"] HH:mm:ss"),"YYYY-MM-DD HH:mm:ss");e.locale(a.language);d.setData("zmoduleuidatepickerselectdatetime",e);u.find(".zui-selected-day").removeClass("zui-selected-day");c.addClass("zui-selected-day");z&&z.find(".zui-button-label").html(e.format(a.format));h&&h.setValue(e.format(a.format));b=d.getData("zmoduleuidatepickercalendardatetime");
b.year(e.year()).month(e.month()).date(e.date());d.setData("zmoduleuidatepickercalendardatetime",b);b=e.format(a.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");d.setAttr("value",b).setValue(b);d.trigger("ui.datepicker.change",{value:b});d.trigger("ui.datepicker.blur",{});c=c.getAttr("href","");""!=c&&(window.location.href=c)});var E=function(a,d,b){var f=zjs("<div>").addClass("zui-calendar-wrap");zjs('<div class="zui-row zui-month"></div>').html(a.format(b.calendarTitleFormat)).appendTo(f);C&&C.html(G(a.month()));
A&&(b.calendarYearFieldUseInput?A.setValue(a.year()):A.html(H(a.year())));var g=zjs('<div class="zui-row zui-weekday"></div>').appendTo(f),h=moment(a).startOf("week");1==b.firstOfWeek&&h.add(1,"day");for(var l=0;7>l;l++)zjs("<label></label>").html(h.format(b.full?"dddd":"dd")).appendTo(g),h.add(1,"day");g=moment(a).startOf("month");a=moment(a).endOf("month").startOf("day");var h=moment(),n=moment(g.format("YYYY-MM-DD")),p=zjs('<div class="zui-row"></div>');b.selectweek&&p.addClass("zui-week");for(var m=
0;n.unix()<=a.unix();){if(n.unix()==g.unix()){var k=g.day();1==b.firstOfWeek&&0==k&&(k=7);for(l=b.firstOfWeek;l<k;l++)b.selectweek&&l==b.firstOfWeek&&p.setAttr("data-date",n.format("YYYY-MM-DD")),zjs('<a class="zui-cell"></a>').html("&nbsp;").addClass("zui-empty-day").appendTo(p),m++}k=n.date();l=n.day();k=zjs('<a class="zui-cell"></a>').html(k).appendTo(p);b.selectweek?b.disabledDate&&b.disabledDate(n)?p.addClass("disabled"):p.setAttr("data-date",n.format("YYYY-MM-DD")):b.disabledDate&&b.disabledDate(n)?
k.addClass("disabled"):k.setAttr("data-date",n.format("YYYY-MM-DD"));""==b.href||b.selectweek||k.setAttr("href",b.href.format({date:n.format("YYYY-MM-DD"),datetime:n.format("YYYY-MM-DD HH:mm:ss")}));""!=b.href&&b.selectweek&&p.setAttr("href",b.href.format({date:n.format("YYYY-MM-DD"),datetime:n.format("YYYY-MM-DD HH:mm:ss")}));n.format("YYYY-MM-DD")==h.format("YYYY-MM-DD")&&(b.selectweek?k.parent().addClass("zui-current-day"):k.addClass("zui-current-day"));n.format("YYYY-MM-DD")==d.format("YYYY-MM-DD")&&
(b.selectweek?k.parent().addClass("zui-selected-day"):k.addClass("zui-selected-day"));m++;if(6==l&&0==b.firstOfWeek||0==l&&1==b.firstOfWeek||n.unix()==a.unix())f.append(p),p=zjs('<div class="zui-row"></div>'),b.selectweek&&p.addClass("zui-week"),m=0;n.add(1,"day")}return f};u.append(E(b,b,a));d.trigger("ui.datepicker.ready",{value:v})}};zjs(document).click(function(q){zjs(".zui-datepicker-button").removeClass("activenothover");zjs(".zui-datepicker-panel-wrap").addClass("zui-hide");zjs(".zui-datepicker-input").removeClass("isfocus")});
zjs.extendMethod({makeDatepicker:function(q){return this.each(function(l){I(l,q)})},datepickerSetValue:function(q){return this.each(function(l){l=zjs(l);var d=l.getData("zmoduleuidatepickerwrapel",!1);if(d){var a=l.getData("zmoduleuidatepickeroption"),b=moment(q,a.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");b.locale(a.language);l.setData("zmoduleuidatepickercalendardatetime",moment(b));l.setData("zmoduleuidatepickerselectdatetime",moment(b));d.find(".zui-button-label").html(b.format(a.format));var g=
d.find(".zui-datepicker-time-panel");g.find(".hour > input").sliderSetValue(b.hour());g.find(".minute > input").sliderSetValue(b.minute());g.find(".second > input").sliderSetValue(b.second());d=d.find(".zui-datepicker-panel");d.find(".zui-calendar-wrap").remove();d.append(drawCalendar(b,b,a));a=b.format(a.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");l.setAttr("value",a).setValue(a);l.trigger("ui.datepicker.change",{value:a,via:"api"})}})}});zjs.hook({after_setInnerHTML:function(q){zjs(q).find(".zdatepicker").makeDatepicker()},
after_insertDOM:function(q){zjs(q).hasClass("zdatepicker")&&zjs(q).makeDatepicker();zjs(q).find(".zdatepicker").makeDatepicker()}});zjs.onready(function(){zjs(".zdatepicker").makeDatepicker();zjs(".zdatetimepicker").makeDatepicker({time:!0})});"required"in zjs&&zjs.required("ui.datepicker")});