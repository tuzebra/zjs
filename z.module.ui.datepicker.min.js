zjs.require("ui, ui.button, moment",function(){var u=zjs("html").getAttr("lang","en").split("-");u=u[0];var y={en:{format:"MM-DD-YYYY",calendarTitleFormat:"MMMM, YYYY",timesliderLabel:{h:"hour",m:"minute",s:"second"},firstOfWeek:0,orbefore:"or before",orafter:"or after"},de:{format:"DD.MM.YYYY",calendarTitleFormat:"MMMM, YYYY",timesliderLabel:{h:"hour",m:"minute",s:"second"},firstOfWeek:0,orbefore:"or before",orafter:"or after"},vi:{format:"DD-MM-YYYY",calendarTitleFormat:"MMMM, YYYY",timesliderLabel:{h:"gi\u1edd",
m:"ph\u00fat",s:"gi\u00e2y"},firstOfWeek:1,orbefore:"ho\u1eb7c tr\u01b0\u1edbc",orafter:"ho\u1eb7c sau"}};zjs.extendCore({moduleUiDatepickerOption:{full:!1,time:!1,hour:!0,hourmin:0,hourmax:23,hourstep:1,minute:!0,minutemin:0,minutemax:59,minutestep:1,second:!0,secondmin:0,secondmax:59,secondstep:1,button:!0,strictInput:!1,labelPlaceholder:!1,language:u,firstOfWeek:y[u].firstOfWeek,calendarTitleFormat:y[u].calendarTitleFormat,format:y[u].format,href:"",selectweek:!1,inputClass:"",disabledDate:!1,
calendarChangeMonthYear:!0,calendarYearFieldUseInput:!1,panel:!0}});var M=function(t,p){var d=zjs(t),b=d.getData("zmoduleuidatepickeroption");if(b)d.setData("zmoduleuidatepickeroption",zjs.extend(b,p));else{b=zjs.clone(zjs.moduleUiDatepickerOption);var e=d.getAttr("data-option","");zjs.isString(e)&&""!=e.trim()&&(b=zjs.extend(b,e.jsonDecode()));d.removeAttr("data-option");"undefined"!=typeof p&&(b=zjs.extend(b,p));e=d.getAttr("data-href","");""!=e&&(b.href=e);zjs.isString(b.disabledDate)&&(b.disabledDate=
b.disabledDate.split(/\s*,\s*/));zjs.isArray(b.disabledDate)&&(b.disabledDate=function(){var c=b.disabledDate,d=[],a=!1,e=moment().format("YYYY-MM-DD"),g=moment().add(1,"day").format("YYYY-MM-DD"),f=moment().add(-1,"day").format("YYYY-MM-DD");zjs.foreach(c,function(b){b=b.trim();b=b.replace("today",e).replace("tomorrow",g).replace("yesterday",f).replace("to","<<").replace("before","<").replace("after",">");var c="";0<=b.indexOf("<<")&&b.match(/(\d\d\d\d-\d\d?-\d\d?)\s*<<\s*(\d\d\d\d-\d\d?-\d\d?)/)&&
(b=RegExp.$1+"<<",c=RegExp.$2);a=moment(b,"YYYY-MM-DD");if(a.isValid()){var h="=";0<=b.indexOf("<<")?h="<<":0<=b.indexOf("<")?h="<":0<=b.indexOf(">")&&(h=">");"<<"==h&&(a.add(-1,"day"),c=moment(c,"YYYY-MM-DD").add(1,"day").format("YYYY-MM-DD"));d.push({comparison:h,date:a.format("YYYY-MM-DD"),date2:c})}});return 0>=d.length?!1:function(a){var b=!1,c="";zjs.foreach(d,function(d){"="==d.comparison?c="isSame":"<"==d.comparison?c="isBefore":">"==d.comparison?c="isAfter":"<<"==d.comparison&&(c="isBetween");
if(moment(a,"YYYY-MM-DD")[c](d.date,d.date2))return b=!0,!1});return b}}());zjs.isFunction(b.disabledDate)||(b.disabledDate=!1);b.panel=!!b.panel;b.strictInput=!!b.strictInput;b.strictInput&&(b.button=!1);d.setData("zmoduleuidatepickeroption",b);var f=zjs('<div class="zui-datepicker"><div class="zui-datepicker-input-wrap"><input type="text" class="zui-contextual-button zui-datepicker-input" /></div><div class="zui-datepicker-button-wrap"><a class="zui-contextual-button zui-datepicker-button"></a></div><div class="zui-contextual-panel-wrap zui-datepicker-panel-wrap zui-hide"><div class="zui-datepicker-panel-inner"><div class="zui-datepicker-panel"></div><div class="zui-datepicker-month-change"></div><a class="zui-datepicker-nav zui-datepicker-nav-prev" data-count="-1"><i></i></a><a class="zui-datepicker-nav zui-datepicker-nav-next" data-count="1"><i></i></a><div class="zui-datepicker-time-panel"><div class="zui-datepicker-time-inner"><div class="timeunit hour"><label>hour</label><span></span><input /></div><div class="timeunit minute"><label>minute</label><span></span><input /></div><div class="timeunit second"><label>second</label><span></span><input /></div></div></div></div></div></div>').insertAfter(d);
d.setData("zmoduleuidatepickerwrapel",f);var q=d.getValue("");e=""==q?moment():moment(q,"YYYY-MM-DD HH:mm:ss");b.hour||e.hour(0);b.minute||e.minute(0);b.second||e.second(0);var u=d.getAttr("placeholder","");e.locale(b.language);var E=f.find(".zui-datepicker-panel-wrap"),v=f.find(".zui-datepicker-panel"),k=f.find(".zui-datepicker-time-panel");b.full&&E.addClass("zui-full");if(b.time)if("makeUiSlider"in k){E.on("click",function(b){b.preventDefault();b.stop()});if(b.hour){var x=k.find(".hour"),I=x.find("span");
x.find("label").setInnerHTML(y[b.language].timesliderLabel.h);x.find("input").setValue(e.hour()).makeUiSlider({min:b.hourmin,max:b.hourmax,step:b.hourstep,referer:I}).on("ui:slider:change",function(c){var h=d.getData("zmoduleuidatepickerselectdatetime").hour(c.getData().value);f.find(".zui-button-label").setInnerHTML(h.format(b.format));"setvalue"!=c.getData().via&&(c=h.format("YYYY-MM-DD HH:mm:ss"),d.setAttr("value",c).setValue(c),d.trigger("ui:datepicker:change",{value:c}))})}else k.find(".hour").remove();
if(b.minute){var n=k.find(".minute");I=n.find("span");n.find("label").setInnerHTML(y[b.language].timesliderLabel.m);n.find("input").setValue(e.minute()).makeUiSlider({min:b.minutemin,max:b.minutemax,step:b.minutestep,referer:I}).on("ui:slider:change",function(c){var h=d.getData("zmoduleuidatepickerselectdatetime").minute(c.getData().value);f.find(".zui-button-label").setInnerHTML(h.format(b.format));"setvalue"!=c.getData().via&&(c=h.format("YYYY-MM-DD HH:mm:ss"),d.setAttr("value",c).setValue(c),d.trigger("ui:datepicker:change",
{value:c}))})}else k.find(".minute").remove();if(b.second){var z=k.find(".second");k=z.find("span");z.find("label").setInnerHTML(y[b.language].timesliderLabel.s);z.find("input").setValue(e.second()).makeUiSlider({min:b.secondmin,max:b.secondmax,step:b.secondstep,referer:k}).on("ui:slider:change",function(c){var h=d.getData("zmoduleuidatepickerselectdatetime").second(c.getData().value);f.find(".zui-button-label").setInnerHTML(h.format(b.format));"setvalue"!=c.getData().via&&(c=h.format("YYYY-MM-DD HH:mm:ss"),
d.setAttr("value",c).setValue(c),d.trigger("ui:datepicker:change",{value:c}))})}else k.find(".second").remove();b.hour&&e.hour(x.find("input").getValue());b.minute&&e.minute(n.find("input").getValue());b.second&&e.second(z.find("input").getValue())}else k.remove();else k.remove();k=moment(e);d.setData("zmoduleuidatepickercalendardatetime",k);d.setData("zmoduleuidatepickerselectdatetime",moment(e));x=e.format(b.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");if(""!=q||""==u)b.disabledDate&&b.disabledDate(e.format("YYYY-MM-DD"))||
(d.setAttr("value",x).setValue(x),d.trigger("ui:datepicker:change",{value:x}));n=E.find(".zui-datepicker-month-change");var F=!1,C=!1;if(b.calendarChangeMonthYear){z=moment();z.locale(b.language);var K=function(c){var d="",a=moment();a.locale(b.language);for(var e=0;12>e;e++)d+='<option value="'+e+'" '+(c==e?"selected":"")+" >"+a.month(e).format(b.full?"MMMM":"MMM")+"</option>";return d};k='<select class="zui-calendar-input-month">'+K(k.month());k+="</select>";if(b.calendarYearFieldUseInput)k+='<input class="zui-calendar-input-year" value="'+
z.format("YYYY")+'" />';else{var L=function(c){for(var d="",a=c-40;a<=c+20;a++)d+='<option value="'+a+'" '+(a==c?"selected":"")+" >"+(a==c-40?a+" ("+y[b.language].orbefore+")":a==c+20?a+" ("+y[b.language].orafter+")":a)+"</option>";return d};k=k+'<select class="zui-calendar-input-year">'+L(z.year());k+="</select>"}n.setInnerHTML(k);F=n.find(".zui-calendar-input-month");C=n.find(".zui-calendar-input-year");f.on("click",".zui-calendar-input-month, .zui-calendar-input-year",function(b){g&&g.hasClass("isfocus")&&
(G=!0);b.preventDefault();b.stop()});n=function(){var c=moment();c.month(F.getValue().toInt()).year(C.getValue().toInt());if(c.isValid()){var h=d.getData("zmoduleuidatepickercalendardatetime"),a=d.getData("zmoduleuidatepickerselectdatetime");h.month(c.month()).year(c.year());v.find(".zui-calendar-wrap").remove();v.append(H(h,a,b));d.trigger("ui:datepicker:changeMonth",{value:h.format(b.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD")})}};if(b.calendarYearFieldUseInput)C.on("keydown",function(b){0>[48,49,
50,51,52,53,54,55,56,57,37,39,8,9,13].indexOf(b.getKeyCode())&&b.preventDefault()}).on("keyup",n);else C.on("change",n);F.on("change",n)}else n.remove();f.find(".zui-datepicker-nav").click(function(c){g&&g.hasClass("isfocus")&&(G=!0);var h=zjs(this);c.preventDefault();c.stop();c=d.getData("zmoduleuidatepickercalendardatetime");var a=d.getData("zmoduleuidatepickerselectdatetime");c.month(c.month()+h.getAttr("data-count").toInt());v.find(".zui-calendar-wrap").remove();v.append(H(c,a,b));d.trigger("ui:datepicker:changeMonth",
{value:c.format(b.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD")})});var g=!1,A=!1,B=n=!1,J=function(c,d){if(b.strictInput){c=c||null;d=d||0;var a=g.getValue().trim(),e=null===c||a.length>c.length,h="";"DD.MM.YYYY"===b.format&&(h='<span class="zdd">DD</span>.<span class="zmm">MM</span>.<span class="zyyyy">YYYY</span>');if(""===h)return"";B.html(h);var f=h=null,k=null,D=null;if("DD.MM.YYYY"===b.format){var w="."===a.substr(a.length-1);null===c||""===c||"."===c.substr(c.length-1)||191!==d&&39!==d||(a+=".",
w=e=!0,g.setValue(a));2===a.length&&w&&e&&(a="0"+a,g.setValue(a));if(2===a.length){var l=parseInt(a);!isNaN(l)&&32<=l&&(a="0"+a.substr(0,1)+"."+a.substr(1),g.setValue(a))}2===a.length&&!w&&e&&(w=!0,a+=".",g.setValue(a));3===a.length&&1>a.indexOf(".")&&(a=a.substr(0,2)+"."+a.substr(2),g.setValue(a));if(4===a.length&&2===a.indexOf(".")&&e&&!w){l=a.split(".");var m=parseInt(l[1]);!isNaN(m)&&2<=m&&(a=l[0]+".0"+l[1]+".",g.setValue(a),w=!0)}4===a.length&&1===a.indexOf(".")&&(l=a.split("."),m=parseInt(l[1]),
!isNaN(m)&&12<m&&(a=l[0]+"."+l[1].substr(0,1)+"."+l[1].substr(1),g.setValue(a)));5===a.length&&2===a.indexOf(".")&&e&&w&&(a=a.substr(0,2)+".0"+a.substr(3),g.setValue(a));5===a.length&&2===a.indexOf(".")&&e&&(l=a.split("."),m=parseInt(l[1]),isNaN(m)||(13<=m?a=l[0]+".0"+l[1].substr(0,1)+"."+l[1].substr(1):(a=l[0]+"."+l[1]+".",w=!0),g.setValue(a)));6===a.length&&2===a.indexOf(".")&&(l=a.split("."),m=parseInt(l[1]),!isNaN(m)&&100<=m&&(a=l[0]+"."+l[1].substr(0,2)+"."+l[1].substr(2),g.setValue(a)));6===
a.length&&2===a.indexOf(".")&&e&&!w&&(a=a.substr(0,5)+"."+a.substr(5),g.setValue(a));8===a.length&&2===a.indexOf(".")&&e&&!w&&(l=a.split("."),l[2]&&!isNaN(parseInt(l[2]))&&(9>=parseInt(l[2])?(a=a.substr(0,5)+".20"+a.substr(6),g.setValue(a)):30<=parseInt(l[2])&&(a=a.substr(0,5)+".19"+a.substr(6),g.setValue(a))));a=a.split(".");1<=a.length&&(D="dd",""!==a[0]&&(h=a[0]));2<=a.length&&(D="mm",""!==a[1]&&(f=a[1]));3<=a.length&&(D="yyyy",""!==a[2]&&(k=a[2]));2<=a.length&&""===a[0].trim()&&""===a[1].trim()&&
(D=null)}null!==h&&B.find(".zdd").html(h.toString()).addClass("int");null!==f&&B.find(".zmm").html(f.toString()).addClass("int");null!==k&&B.find(".zyyyy").html(k.toString()).addClass("int");B.find("span").removeClass("active");null!==D&&B.find(".z"+D).addClass("active");return""}};if(b.button)f.find(".zui-datepicker-input-wrap").remove(),A=f.find(".zui-datepicker-button"),A.makeButton(),q=u,""==q&&(q=b.format),A.find(".zui-button-label").setInnerHTML(b.disabledDate&&b.disabledDate(e.format("YYYY-MM-DD"))?
q:e.format(b.format)),A.on("click",function(b,d){b.preventDefault();b.stop();var a=A.hasClass("activenothover");zjs(".zui-contextual-button").removeClass("activenothover");zjs(".zui-contextual-panel-wrap").addClass("zui-hide");a||(A.addClass("activenothover"),E.removeClass("zui-hide"))});else{n=f.find(".zui-datepicker-input-wrap");n.on("click",function(){g.focus()});f.find(".zui-datepicker-button-wrap").remove();g=f.find(".zui-datepicker-input");if(""!=q||""==u)b.disabledDate&&b.disabledDate(e.format("YYYY-MM-DD"))||
g.setValue(e.format(b.format));q=u;""==q&&(q=b.format);b.labelPlaceholder&&""!==q?(zjs("<span>").addClass("placeholder").html(q).insertAfter(n),n.addClass("label-placeholder"),g.setAttr("placeholder","")):g.setAttr("placeholder",q);g.addClass(b.inputClass);b.strictInput&&(g.setAttr("maxlength",b.format.length),B=zjs("<div>").addClass("zui-datepicker-input-behide"),B.insertBefore(g),J());d.on("focus",function(){g.focus()});var G=!1;g.on("focus",function(c){c.preventDefault();J();G=!1;c=zjs(this);zjs(".zui-datepicker-input").removeClass("isfocus");
zjs(".zui-contextual-button").removeClass("activenothover");zjs(".zui-contextual-panel-wrap").addClass("zui-hide");c.addClass("isfocus");f.addClass("focus");d.addClass("activenothover");b.panel&&E.removeClass("zui-hide")});g.on("click",function(b){b.stop()});var r="";g.on("keydown",function(c){var d=this.getValue().trim(),a=c.getKeyCode();if("DD/MM/YYYY"==b.format||"DD.MM.YYYY"==b.format){var e=!1;0>[48,49,50,51,52,53,54,55,56,57,37,39,8,9,13,65,191,190].indexOf(a)&&(e=!0);191===a&&"DD/MM/YYYY"!==
b.format&&(e=!0);190===a&&"DD.MM.YYYY"!==b.format&&(e=!0);190===a&&""===d&&(e=!0);e||65!==a||c.metaKey()||(e=!0);b.strictInput&&function(){J(d,a)}.delay(1);e&&c.preventDefault()}});g.on("keyup",function(c){c.preventDefault();(r=zjs(this).getValue(""))&&(r=r.trim());if(""!=r&&(c=moment(r,b.format),c.isValid())){var e=d.getData("zmoduleuidatepickercalendardatetime"),a=d.getData("zmoduleuidatepickerselectdatetime");e.year(c.year()).month(c.month()).date(c.date());a.year(c.year()).month(c.month()).date(c.date());
v.find(".zui-calendar-wrap").remove();v.append(H(e,a,b))}});g.on("blur",function(c){var e=zjs(this);(r=e.getValue(""))&&(r=r.trim());(function(){if(!G){if(""!=r){var a=moment(r,b.format);a.isValid()||(r="");""!=r&&b.disabledDate&&b.disabledDate(a.format("YYYY-MM-DD"))&&(r="")}if(""!=r){var c=d.getData("zmoduleuidatepickercalendardatetime"),h=d.getData("zmoduleuidatepickerselectdatetime");h.year(a.year()).month(a.month()).date(a.date());c.year(a.year()).month(a.month()).date(a.date());d.setData("zmoduleuidatepickerselectdatetime",
h);d.setData("zmoduleuidatepickercalendardatetime",c);v.find(".zui-calendar-wrap").remove();v.append(H(c,h,b));e.setValue(h.format(b.format));f.addClass("has-value");a=h.format(b.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");d.setAttr("value",a).setValue(a);d.trigger("ui:datepicker:change",{value:a})}else f.removeClass("has-value"),g.setValue(""),d.setAttr("value","").setValue(""),d.trigger("ui:datepicker:change",{value:""});d.trigger("ui:datepicker:blur",{});E.addClass("zui-hide");e.removeClass("isfocus");
f.removeClass("focus")}}).delay(200)})}d.addClass("zui-uihide");v.on("click","[data-date]",function(c){g&&g.hasClass("isfocus")&&(G=!0,g.removeClass("isfocus"));c=zjs(this);var e=c.getAttr("data-date"),a=d.getData("zmoduleuidatepickerselectdatetime");a=moment(a.format("["+e+"] HH:mm:ss"),"YYYY-MM-DD HH:mm:ss");a.locale(b.language);d.setData("zmoduleuidatepickerselectdatetime",a);v.find(".zui-selected-day").removeClass("zui-selected-day");c.addClass("zui-selected-day");A&&A.find(".zui-button-label").setInnerHTML(a.format(b.format));
g&&g.setValue(a.format(b.format));e=d.getData("zmoduleuidatepickercalendardatetime");e.year(a.year()).month(a.month()).date(a.date());d.setData("zmoduleuidatepickercalendardatetime",e);e=a.format(b.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");d.setAttr("value",e).setValue(e);d.trigger("ui:datepicker:change",{value:e});d.trigger("ui:datepicker:blur",{});c=c.getAttr("href","");""!=c&&(window.location.href=c)});var H=function(b,d,a){var c=zjs("<div>").addClass("zui-calendar-wrap");zjs('<div class="zui-row zui-month"></div>').setInnerHTML(b.format(a.calendarTitleFormat)).appendTo(c);
F&&F.setInnerHTML(K(b.month()));C&&(a.calendarYearFieldUseInput?C.setValue(b.year()):C.setInnerHTML(L(b.year())));var e=zjs('<div class="zui-row zui-weekday"></div>').appendTo(c),g=moment(b).startOf("week");1==a.firstOfWeek&&g.add(1,"day");for(var h=0;7>h;h++)zjs("<label></label>").setInnerHTML(g.format(a.full?"dddd":"dd")).appendTo(e),g.add(1,"day");e=moment(b).startOf("month");b=moment(b).endOf("month").startOf("day");g=moment();var f=moment(e.format("YYYY-MM-DD")),k=zjs('<div class="zui-row"></div>');
a.selectweek&&k.addClass("zui-week");for(var l=0;f.unix()<=b.unix();){if(f.unix()==e.unix()){var m=e.day();1==a.firstOfWeek&&0==m&&(m=7);for(h=a.firstOfWeek;h<m;h++)a.selectweek&&h==a.firstOfWeek&&k.setAttr("data-date",f.format("YYYY-MM-DD")),zjs('<a class="zui-cell"></a>').setInnerHTML("&nbsp;").addClass("zui-empty-day").appendTo(k),l++}m=f.date();h=f.day();m=zjs('<a class="zui-cell"></a>').setInnerHTML(m).appendTo(k);a.selectweek?a.disabledDate&&a.disabledDate(f)?k.addClass("disabled"):k.setAttr("data-date",
f.format("YYYY-MM-DD")):a.disabledDate&&a.disabledDate(f)?m.addClass("disabled"):m.setAttr("data-date",f.format("YYYY-MM-DD"));""==a.href||a.selectweek||m.setAttr("href",a.href.format({date:f.format("YYYY-MM-DD"),datetime:f.format("YYYY-MM-DD HH:mm:ss")}));""!=a.href&&a.selectweek&&k.setAttr("href",a.href.format({date:f.format("YYYY-MM-DD"),datetime:f.format("YYYY-MM-DD HH:mm:ss")}));f.format("YYYY-MM-DD")==g.format("YYYY-MM-DD")&&(a.selectweek?m.parent().addClass("zui-current-day"):m.addClass("zui-current-day"));
f.format("YYYY-MM-DD")==d.format("YYYY-MM-DD")&&(a.selectweek?m.parent().addClass("zui-selected-day"):m.addClass("zui-selected-day"));l++;if(6==h&&0==a.firstOfWeek||0==h&&1==a.firstOfWeek||f.unix()==b.unix())c.append(k),k=zjs('<div class="zui-row"></div>'),a.selectweek&&k.addClass("zui-week"),l=0;f.add(1,"day")}return c};v.append(H(e,e,b));d.trigger("ui:datepicker:ready",{value:x})}};zjs(document).click(function(t){zjs(".zui-datepicker-button").removeClass("activenothover");zjs(".zui-datepicker-panel-wrap").addClass("zui-hide");
zjs(".zui-datepicker-input").removeClass("isfocus")});zjs.extendMethod({makeDatepicker:function(t){return this.eachElement(function(p){M(p,t)})},datepickerSetValue:function(t){return this.eachElement(function(p){p=zjs(p);var d=p.getData("zmoduleuidatepickerwrapel",!1);if(d){var b=p.getData("zmoduleuidatepickeroption"),e=moment(t,b.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");e.locale(b.language);p.setData("zmoduleuidatepickercalendardatetime",moment(e));p.setData("zmoduleuidatepickerselectdatetime",moment(e));
d.find(".zui-button-label").setInnerHTML(e.format(b.format));var f=d.find(".zui-datepicker-time-panel");f.find(".hour > input").sliderSetValue(e.hour());f.find(".minute > input").sliderSetValue(e.minute());f.find(".second > input").sliderSetValue(e.second());d=d.find(".zui-datepicker-panel");d.find(".zui-calendar-wrap").remove();d.append(drawCalendar(e,e,b));b=e.format(b.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");p.setAttr("value",b).setValue(b);p.trigger("ui:datepicker:change",{value:b,via:"api"})}})}});
zjs.hook({after_setInnerHTML:function(t){zjs(t).find(".zdatepicker").makeDatepicker()},after_insertDOM:function(t){zjs(t).hasClass("zdatepicker")&&zjs(t).makeDatepicker();zjs(t).find(".zdatepicker").makeDatepicker()}});zjs.onready(function(){zjs(".zdatepicker").makeDatepicker();zjs(".zdatetimepicker").makeDatepicker({time:!0})});"required"in zjs&&zjs.required("ui.datepicker")});