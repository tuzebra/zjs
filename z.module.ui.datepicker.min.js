zjs.require("ui, ui.button, ui.slider, moment",function(){var r=zjs("html").getAttr("lang","en").split("-"),r=r[0],v={en:{format:"MM-DD-YYYY",calendarTitleFormat:"MMMM, YYYY",timesliderLabel:{h:"hour",m:"minute",s:"second"},firstOfWeek:0,orbefore:"or before",orafter:"or after"},de:{format:"DD.MM.YYYY",calendarTitleFormat:"MMMM, YYYY",timesliderLabel:{h:"hour",m:"minute",s:"second"},firstOfWeek:0,orbefore:"or before",orafter:"or after"},vi:{format:"DD-MM-YYYY",calendarTitleFormat:"MMMM, YYYY",timesliderLabel:{h:"gi\u1edd",
m:"ph\u00fat",s:"gi\u00e2y"},firstOfWeek:1,orbefore:"ho\u1eb7c tr\u01b0\u1edbc",orafter:"ho\u1eb7c sau"}};zjs.extendCore({moduleUiDatepickerOption:{full:!1,time:!1,hour:!0,hourmin:0,hourmax:23,hourstep:1,minute:!0,minutemin:0,minutemax:59,minutestep:1,second:!0,secondmin:0,secondmax:59,secondstep:1,button:!0,language:r,firstOfWeek:v[r].firstOfWeek,calendarTitleFormat:v[r].calendarTitleFormat,format:v[r].format,href:"",selectweek:!1,inputClass:"",disabledDate:!1,calendarChangeMonthYear:!0,calendarYearFieldUseInput:!1}});
var G=function(p,m){var c=zjs(p),b=c.getData("zmoduleuidatepickeroption");if(b)c.setData("zmoduleuidatepickeroption",zjs.extend(b,m));else{var b=zjs.clone(zjs.moduleUiDatepickerOption),d=c.getAttr("data-option","");zjs.isString(d)&&""!=d.trim()&&(b=zjs.extend(b,d.jsonDecode()));c.removeAttr("data-option");"undefined"!=typeof m&&(b=zjs.extend(b,m));d=c.getAttr("data-href","");""!=d&&(b.href=d);zjs.isString(b.disabledDate)&&(b.disabledDate=b.disabledDate.split(/\s*,\s*/));zjs.isArray(b.disabledDate)&&
(b.disabledDate=function(){var a=b.disabledDate,c=[],e=!1,d=moment().format("YYYY-MM-DD"),h=moment().add(1,"day").format("YYYY-MM-DD"),g=moment().add(-1,"day").format("YYYY-MM-DD");zjs.foreach(a,function(a){a=a.trim();a=a.replace("today",d).replace("tomorrow",h).replace("yesterday",g).replace("to","<<").replace("before","<").replace("after",">");var b="";0<=a.indexOf("<<")&&a.match(/(\d\d\d\d-\d\d?-\d\d?)\s*<<\s*(\d\d\d\d-\d\d?-\d\d?)/)&&(a=RegExp.$1+"<<",b=RegExp.$2);e=moment(a,"YYYY-MM-DD");if(e.isValid()){var f=
"=";0<=a.indexOf("<<")?f="<<":0<=a.indexOf("<")?f="<":0<=a.indexOf(">")&&(f=">");"<<"==f&&(e.add(-1,"day"),b=moment(b,"YYYY-MM-DD").add(1,"day").format("YYYY-MM-DD"));c.push({comparison:f,date:e.format("YYYY-MM-DD"),date2:b})}});return 0>=c.length?!1:function(a){var b=!1,e="";zjs.foreach(c,function(c){"="==c.comparison?e="isSame":"<"==c.comparison?e="isBefore":">"==c.comparison?e="isAfter":"<<"==c.comparison&&(e="isBetween");if(moment(a,"YYYY-MM-DD")[e](c.date,c.date2))return b=!0,!1});return b}}());
zjs.isFunction(b.disabledDate)||(b.disabledDate=!1);c.setData("zmoduleuidatepickeroption",b);var k=zjs('<div class="zui-datepicker"><div class="zui-datepicker-input-wrap"><input type="text" class="zui-contextual-button zui-datepicker-input" /></div><div class="zui-datepicker-button-wrap"><a class="zui-contextual-button zui-datepicker-button"></a></div><div class="zui-contextual-panel-wrap zui-datepicker-panel-wrap zui-hide"><div class="zui-datepicker-panel-inner"><div class="zui-datepicker-panel"></div><div class="zui-datepicker-month-change"></div><a class="zui-datepicker-nav zui-datepicker-nav-prev" data-count="-1"><i></i></a><a class="zui-datepicker-nav zui-datepicker-nav-next" data-count="1"><i></i></a><div class="zui-datepicker-time-panel"><div class="zui-datepicker-time-inner"><div class="timeunit hour"><label>hour</label><span></span><input /></div><div class="timeunit minute"><label>minute</label><span></span><input /></div><div class="timeunit second"><label>second</label><span></span><input /></div></div></div></div></div></div>').insertAfter(c);
c.setData("zmoduleuidatepickerwrapel",k);var q=c.getValue("");d=""==q?moment():moment(q,"YYYY-MM-DD HH:mm:ss");b.hour||d.hour(0);b.minute||d.minute(0);b.second||d.second(0);var r=c.getAttr("placeholder","");d.locale(b.language);var z=k.find(".zui-datepicker-panel-wrap"),t=k.find(".zui-datepicker-panel"),g=k.find(".zui-datepicker-time-panel");b.full&&z.addClass("zui-full");if(b.time){z.on("click",function(a){a.preventDefault();a.stop()});if(b.hour){var w=g.find(".hour");var D=w.find("span");w.find("label").setInnerHTML(v[b.language].timesliderLabel.h);
w.find("input").setValue(d.hour()).makeUiSlider({min:b.hourmin,max:b.hourmax,step:b.hourstep,referer:D}).on("ui:slider:change",function(a){var f=c.getData("zmoduleuidatepickerselectdatetime").hour(a.getData().value);k.find(".zui-button-label").setInnerHTML(f.format(b.format));"setvalue"!=a.getData().via&&(a=f.format("YYYY-MM-DD HH:mm:ss"),c.setAttr("value",a).setValue(a),c.trigger("ui:datepicker:change",{value:a}))})}else g.find(".hour").remove();if(b.minute){var n=g.find(".minute");D=n.find("span");
n.find("label").setInnerHTML(v[b.language].timesliderLabel.m);n.find("input").setValue(d.minute()).makeUiSlider({min:b.minutemin,max:b.minutemax,step:b.minutestep,referer:D}).on("ui:slider:change",function(a){var f=c.getData("zmoduleuidatepickerselectdatetime").minute(a.getData().value);k.find(".zui-button-label").setInnerHTML(f.format(b.format));"setvalue"!=a.getData().via&&(a=f.format("YYYY-MM-DD HH:mm:ss"),c.setAttr("value",a).setValue(a),c.trigger("ui:datepicker:change",{value:a}))})}else g.find(".minute").remove();
if(b.second){var u=g.find(".second");g=u.find("span");u.find("label").setInnerHTML(v[b.language].timesliderLabel.s);u.find("input").setValue(d.second()).makeUiSlider({min:b.secondmin,max:b.secondmax,step:b.secondstep,referer:g}).on("ui:slider:change",function(a){var f=c.getData("zmoduleuidatepickerselectdatetime").second(a.getData().value);k.find(".zui-button-label").setInnerHTML(f.format(b.format));"setvalue"!=a.getData().via&&(a=f.format("YYYY-MM-DD HH:mm:ss"),c.setAttr("value",a).setValue(a),c.trigger("ui:datepicker:change",
{value:a}))})}else g.find(".second").remove();b.hour&&d.hour(w.find("input").getValue());b.minute&&d.minute(n.find("input").getValue());b.second&&d.second(u.find("input").getValue())}else g.remove();g=moment(d);c.setData("zmoduleuidatepickercalendardatetime",g);c.setData("zmoduleuidatepickerselectdatetime",moment(d));u=d.format(b.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");if(""!=q||""==r)b.disabledDate&&b.disabledDate(d.format("YYYY-MM-DD"))||(c.setAttr("value",u).setValue(u),c.trigger("ui:datepicker:change",
{value:u}));n=z.find(".zui-datepicker-month-change");var A=!1,y=!1;if(b.calendarChangeMonthYear){w=moment();w.locale(b.language);var E=function(a){var c="",e=moment();e.locale(b.language);for(var d=0;12>d;d++)c+='<option value="'+d+'" '+(a==d?"selected":"")+" >"+e.month(d).format(b.full?"MMMM":"MMM")+"</option>";return c};g='<select class="zui-calendar-input-month">'+E(g.month());g+="</select>";if(b.calendarYearFieldUseInput)g+='<input class="zui-calendar-input-year" value="'+w.format("YYYY")+'" />';
else{var F=function(a){for(var c="",e=a-40;e<=a+20;e++)c+='<option value="'+e+'" '+(e==a?"selected":"")+" >"+(e==a-40?e+" ("+v[b.language].orbefore+")":e==a+20?e+" ("+v[b.language].orafter+")":e)+"</option>";return c};g=g+'<select class="zui-calendar-input-year">'+F(w.year());g+="</select>"}n.setInnerHTML(g);A=n.find(".zui-calendar-input-month");y=n.find(".zui-calendar-input-year");k.on("click",".zui-calendar-input-month, .zui-calendar-input-year",function(a){h&&h.hasClass("isfocus")&&(B=!0);a.preventDefault();
a.stop()});n=function(){var a=moment();a.month(A.getValue().toInt()).year(y.getValue().toInt());if(a.isValid()){var d=c.getData("zmoduleuidatepickercalendardatetime"),e=c.getData("zmoduleuidatepickerselectdatetime");d.month(a.month()).year(a.year());t.find(".zui-calendar-wrap").remove();t.append(C(d,e,b));c.trigger("ui:datepicker:changeMonth",{value:d.format(b.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD")})}};if(b.calendarYearFieldUseInput)y.on("keydown",function(a){0>[48,49,50,51,52,53,54,55,56,57,37,
39,8,9,13].indexOf(a.getKeyCode())&&a.preventDefault()}).on("keyup",n);else y.on("change",n);A.on("change",n)}else n.remove();k.find(".zui-datepicker-nav").click(function(a){h&&h.hasClass("isfocus")&&(B=!0);var d=zjs(this);a.preventDefault();a.stop();a=c.getData("zmoduleuidatepickercalendardatetime");var e=c.getData("zmoduleuidatepickerselectdatetime");a.month(a.month()+d.getAttr("data-count").toInt());t.find(".zui-calendar-wrap").remove();t.append(C(a,e,b));c.trigger("ui:datepicker:changeMonth",
{value:a.format(b.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD")})});var h=!1,x=!1;if(b.button)k.find(".zui-datepicker-input-wrap").remove(),x=k.find(".zui-datepicker-button"),x.makeButton(),q=r,""==q&&(q=b.format),x.find(".zui-button-label").setInnerHTML(b.disabledDate&&b.disabledDate(d.format("YYYY-MM-DD"))?q:d.format(b.format)),x.on("click",function(a,b){a.preventDefault();a.stop();var e=x.hasClass("activenothover");zjs(".zui-contextual-button").removeClass("activenothover");zjs(".zui-contextual-panel-wrap").addClass("zui-hide");
e||(x.addClass("activenothover"),z.removeClass("zui-hide"))});else{k.find(".zui-datepicker-button-wrap").remove();h=k.find(".zui-datepicker-input");if(""!=q||""==r)b.disabledDate&&b.disabledDate(d.format("YYYY-MM-DD"))||h.setValue(d.format(b.format));q=r;""==q&&(q=b.format);h.setAttr("placeholder",q);h.addClass(b.inputClass);c.on("focus",function(){h.focus()});var B=!1;h.on("focus",function(a){a.preventDefault();B=!1;a=zjs(this);zjs(".zui-datepicker-input").removeClass("isfocus");zjs(".zui-contextual-button").removeClass("activenothover");
zjs(".zui-contextual-panel-wrap").addClass("zui-hide");a.addClass("isfocus");c.addClass("activenothover");z.removeClass("zui-hide")});h.on("click",function(a){a.stop()});var l="";h.on("keydown",function(a){"DD/MM/YYYY"==b.format&&0>[48,49,50,51,52,53,54,55,56,57,37,39,8,9,13,191].indexOf(a.getKeyCode())&&a.preventDefault()});h.on("keyup",function(a){a.preventDefault();(l=zjs(this).getValue(""))&&(l=l.trim());if(""!=l&&(a=moment(l,b.format),a.isValid())){var d=c.getData("zmoduleuidatepickercalendardatetime"),
e=c.getData("zmoduleuidatepickerselectdatetime");d.year(a.year()).month(a.month()).date(a.date());e.year(a.year()).month(a.month()).date(a.date());t.find(".zui-calendar-wrap").remove();t.append(C(d,e,b))}});h.on("blur",function(a){var d=zjs(this);(l=d.getValue(""))&&(l=l.trim());(function(){if(!B){if(""!=l){var a=moment(l,b.format);a.isValid()||(l="");""!=l&&b.disabledDate&&b.disabledDate(a.format("YYYY-MM-DD"))&&(l="")}if(""!=l){var f=c.getData("zmoduleuidatepickercalendardatetime"),g=c.getData("zmoduleuidatepickerselectdatetime");
g.year(a.year()).month(a.month()).date(a.date());f.year(a.year()).month(a.month()).date(a.date());c.setData("zmoduleuidatepickerselectdatetime",g);c.setData("zmoduleuidatepickercalendardatetime",f);t.find(".zui-calendar-wrap").remove();t.append(C(f,g,b));d.setValue(g.format(b.format));a=g.format(b.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");c.setAttr("value",a).setValue(a);c.trigger("ui:datepicker:change",{value:a})}else h.setValue(""),c.setAttr("value","").setValue(""),c.trigger("ui:datepicker:change",
{value:""});c.trigger("ui:datepicker:blur",{});z.addClass("zui-hide");d.removeClass("isfocus")}}).delay(200)})}c.addClass("zui-uihide");t.on("click","[data-date]",function(a){h&&h.hasClass("isfocus")&&(B=!0,h.removeClass("isfocus"));a=zjs(this);var d=a.getAttr("data-date"),e=c.getData("zmoduleuidatepickerselectdatetime"),e=moment(e.format("["+d+"] HH:mm:ss"),"YYYY-MM-DD HH:mm:ss");e.locale(b.language);c.setData("zmoduleuidatepickerselectdatetime",e);t.find(".zui-selected-day").removeClass("zui-selected-day");
a.addClass("zui-selected-day");x&&x.find(".zui-button-label").setInnerHTML(e.format(b.format));h&&h.setValue(e.format(b.format));d=c.getData("zmoduleuidatepickercalendardatetime");d.year(e.year()).month(e.month()).date(e.date());c.setData("zmoduleuidatepickercalendardatetime",d);d=e.format(b.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");c.setAttr("value",d).setValue(d);c.trigger("ui:datepicker:change",{value:d});c.trigger("ui:datepicker:blur",{});a=a.getAttr("href","");""!=a&&(window.location.href=a)});
var C=function(a,b,c){var d=zjs("<div>").addClass("zui-calendar-wrap");zjs('<div class="zui-row zui-month"></div>').setInnerHTML(a.format(c.calendarTitleFormat)).appendTo(d);A&&A.setInnerHTML(E(a.month()));y&&(c.calendarYearFieldUseInput?y.setValue(a.year()):y.setInnerHTML(F(a.year())));var e=zjs('<div class="zui-row zui-weekday"></div>').appendTo(d),g=moment(a).startOf("week");1==c.firstOfWeek&&g.add(1,"day");for(var h=0;7>h;h++)zjs("<label></label>").setInnerHTML(g.format(c.full?"dddd":"dd")).appendTo(e),
g.add(1,"day");e=moment(a).startOf("month");a=moment(a).endOf("month").startOf("day");var g=moment(),f=moment(e.format("YYYY-MM-DD")),k=zjs('<div class="zui-row"></div>');c.selectweek&&k.addClass("zui-week");for(var m=0;f.unix()<=a.unix();){if(f.unix()==e.unix()){var l=e.day();1==c.firstOfWeek&&0==l&&(l=7);for(h=c.firstOfWeek;h<l;h++)c.selectweek&&h==c.firstOfWeek&&k.setAttr("data-date",f.format("YYYY-MM-DD")),zjs('<a class="zui-cell"></a>').setInnerHTML("&nbsp;").addClass("zui-empty-day").appendTo(k),
m++}l=f.date();h=f.day();l=zjs('<a class="zui-cell"></a>').setInnerHTML(l).appendTo(k);c.selectweek?c.disabledDate&&c.disabledDate(f)?k.addClass("disabled"):k.setAttr("data-date",f.format("YYYY-MM-DD")):c.disabledDate&&c.disabledDate(f)?l.addClass("disabled"):l.setAttr("data-date",f.format("YYYY-MM-DD"));""==c.href||c.selectweek||l.setAttr("href",c.href.format({date:f.format("YYYY-MM-DD"),datetime:f.format("YYYY-MM-DD HH:mm:ss")}));""!=c.href&&c.selectweek&&k.setAttr("href",c.href.format({date:f.format("YYYY-MM-DD"),
datetime:f.format("YYYY-MM-DD HH:mm:ss")}));f.format("YYYY-MM-DD")==g.format("YYYY-MM-DD")&&(c.selectweek?l.parent().addClass("zui-current-day"):l.addClass("zui-current-day"));f.format("YYYY-MM-DD")==b.format("YYYY-MM-DD")&&(c.selectweek?l.parent().addClass("zui-selected-day"):l.addClass("zui-selected-day"));m++;if(6==h&&0==c.firstOfWeek||0==h&&1==c.firstOfWeek||f.unix()==a.unix())d.append(k),k=zjs('<div class="zui-row"></div>'),c.selectweek&&k.addClass("zui-week"),m=0;f.add(1,"day")}return d};t.append(C(d,
d,b));c.trigger("ui:datepicker:ready",{value:u})}};zjs(document).click(function(p){zjs(".zui-datepicker-button").removeClass("activenothover");zjs(".zui-datepicker-panel-wrap").addClass("zui-hide");zjs(".zui-datepicker-input").removeClass("isfocus")});zjs.extendMethod({makeDatepicker:function(p){return this.eachElement(function(m){G(m,p)})},datepickerSetValue:function(p){return this.eachElement(function(m){m=zjs(m);var c=m.getData("zmoduleuidatepickerwrapel",!1);if(c){var b=m.getData("zmoduleuidatepickeroption"),
d=moment(p,b.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");d.locale(b.language);m.setData("zmoduleuidatepickercalendardatetime",moment(d));m.setData("zmoduleuidatepickerselectdatetime",moment(d));c.find(".zui-button-label").setInnerHTML(d.format(b.format));var k=c.find(".zui-datepicker-time-panel");k.find(".hour > input").sliderSetValue(d.hour());k.find(".minute > input").sliderSetValue(d.minute());k.find(".second > input").sliderSetValue(d.second());c=c.find(".zui-datepicker-panel");c.find(".zui-calendar-wrap").remove();
c.append(drawCalendar(d,d,b));b=d.format(b.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");m.setAttr("value",b).setValue(b);m.trigger("ui:datepicker:change",{value:b,via:"api"})}})}});zjs.hook({after_setInnerHTML:function(p){zjs(p).find(".zdatepicker").makeDatepicker()},after_insertDOM:function(p){zjs(p).hasClass("zdatepicker")&&zjs(p).makeDatepicker();zjs(p).find(".zdatepicker").makeDatepicker()}});zjs.onready(function(){zjs(".zdatepicker").makeDatepicker();zjs(".zdatetimepicker").makeDatepicker({time:!0})});
"required"in zjs&&zjs.required("ui.datepicker")});