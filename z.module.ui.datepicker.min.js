zjs.require("ui, ui.button, moment",function(){"use strict";var e="zmoduleuidatepickeroption",a="zmoduleuidatepickerwrapel",t="zmoduleuidatepickercalendardatetime",r="zmoduleuidatepickerselectdatetime",s=zjs("html").getAttr("lang","en").split("-");s=s[0];var n={en:{format:"MM-DD-YYYY",calendarTitleFormat:"MMMM, YYYY",timesliderLabel:{h:"hour",m:"minute",s:"second"},firstOfWeek:0,orbefore:"or before",orafter:"or after"},de:{format:"DD.MM.YYYY",calendarTitleFormat:"MMMM, YYYY",timesliderLabel:{h:"hour",m:"minute",s:"second"},firstOfWeek:0,orbefore:"or before",orafter:"or after"},vi:{format:"DD-MM-YYYY",calendarTitleFormat:"MMMM, YYYY",timesliderLabel:{h:"giờ",m:"phút",s:"giây"},firstOfWeek:1,orbefore:"hoặc trước",orafter:"hoặc sau"}};zjs.extendCore({moduleUiDatepickerOption:{full:!1,time:!1,hour:!0,hourmin:0,hourmax:23,hourstep:1,minute:!0,minutemin:0,minutemax:59,minutestep:1,second:!0,secondmin:0,secondmax:59,secondstep:1,button:!0,strictInput:!1,labelPlaceholder:!1,language:s,firstOfWeek:n[s].firstOfWeek,calendarTitleFormat:n[s].calendarTitleFormat,format:n[s].format,href:"",selectweek:!1,inputClass:"",disabledDate:!1,calendarChangeMonthYear:!0,calendarYearFieldUseInput:!1,panel:!0}});var i="zui-datepicker",d="zui-datepicker-input-wrap",l="zui-datepicker-input",o="zui-datepicker-button-wrap",u="zui-datepicker-button",m="zui-contextual-button",f="zui-contextual-panel-wrap",c="zui-datepicker-panel-wrap",Y="zui-hide",p="zui-full",v="zui-datepicker-panel-inner",D="zui-datepicker-panel",h="zui-datepicker-nav",M="zui-datepicker-month-change",g="zui-datepicker-nav-prev",z="zui-datepicker-nav-next",k="zui-datepicker-time-panel",b="zui-datepicker-time-inner",y='<div class="'+i+'"><div class="'+d+'"><input type="text" class="'+m+" "+l+'" /></div><div class="'+o+'"><a class="'+m+" "+u+'"></a></div><div class="'+f+" "+c+" "+Y+'"><div class="'+v+'"><div class="'+D+'"></div><div class="'+M+'"></div><a class="'+h+" "+g+'" data-count="-1"><i></i></a><a class="'+h+" "+z+'" data-count="1"><i></i></a><div class="'+k+'"><div class="'+b+'"><div class="timeunit hour"><label>hour</label><span></span><input /></div><div class="timeunit minute"><label>minute</label><span></span><input /></div><div class="timeunit second"><label>second</label><span></span><input /></div></div></div></div></div></div>',C="zui-calendar-wrap",j="zui-row",V="zui-month",H="zui-weekday",x="zui-current-day",I="zui-selected-day",O="zui-empty-day",A='<div class="'+j+'"></div>',T='<div class="'+j+" "+V+'"></div>',w='<div class="'+j+" "+H+'"></div>',L='<a class="zui-cell"></a>',S="<label></label>",N="zui-button-label",F="activenothover",W="zui-uihide",U=function(s,i){var v=zjs(s),g=v.getData(e);if(g)return void v.setData(e,zjs.extend(g,i));g=zjs.clone(zjs.moduleUiDatepickerOption);var z=v.getAttr("data-option","");zjs.isString(z)&&""!=z.trim()&&(g=zjs.extend(g,z.jsonDecode())),v.removeAttr("data-option"),"undefined"!=typeof i&&(g=zjs.extend(g,i));var b=v.getAttr("data-href","");""!=b&&(g.href=b),zjs.isString(g.disabledDate)&&(g.disabledDate=g.disabledDate.split(/\s*,\s*/)),zjs.isArray(g.disabledDate)&&(g.disabledDate=function(){var e=g.disabledDate,a=[],t=!1,r=moment().format("YYYY-MM-DD"),s=moment().add(1,"day").format("YYYY-MM-DD"),n=moment().add(-1,"day").format("YYYY-MM-DD");return zjs.foreach(e,function(e){e=e.trim(),e=e.replace("today",r).replace("tomorrow",s).replace("yesterday",n).replace("to","<<").replace("before","<").replace("after",">");var i="";if(e.indexOf("<<")>=0&&e.match(/(\d\d\d\d-\d\d?-\d\d?)\s*<<\s*(\d\d\d\d-\d\d?-\d\d?)/)&&(e=RegExp.$1+"<<",i=RegExp.$2),t=moment(e,"YYYY-MM-DD"),t.isValid()){var d="=";e.indexOf("<<")>=0?d="<<":e.indexOf("<")>=0?d="<":e.indexOf(">")>=0&&(d=">"),"<<"==d&&(t.add(-1,"day"),i=moment(i,"YYYY-MM-DD").add(1,"day").format("YYYY-MM-DD")),a.push({comparison:d,date:t.format("YYYY-MM-DD"),date2:i})}}),!(a.length<=0)&&function(e){var t=!1,r="";return zjs.foreach(a,function(a){if("="==a.comparison?r="isSame":"<"==a.comparison?r="isBefore":">"==a.comparison?r="isAfter":"<<"==a.comparison&&(r="isBetween"),moment(e,"YYYY-MM-DD")[r](a.date,a.date2))return t=!0,!1}),t}}()),zjs.isFunction(g.disabledDate)||(g.disabledDate=!1),g.panel=!!g.panel,g.strictInput=!!g.strictInput,g.strictInput&&(g.button=!1),v.setData(e,g);var j=zjs(y).insertAfter(v);v.setData(a,j);var V=v.getValue(""),H=""==V?moment():moment(V,"YYYY-MM-DD HH:mm:ss");g.hour||H.hour(0),g.minute||H.minute(0),g.second||H.second(0);var U=v.getAttr("placeholder",""),B=U;H.locale(g.language);var E=j.find("."+c),q=j.find("."+D),K=j.find("."+k);if(g.full&&E.addClass(p),g.time)if("makeUiSlider"in K){if(E.on("click",function(e){e.preventDefault(),e.stop()}),g.hour){var P=K.find(".hour"),R=P.find("span");P.find("label").setInnerHTML(n[g.language].timesliderLabel.h),P.find("input").setValue(H.hour()).makeUiSlider({min:g.hourmin,max:g.hourmax,step:g.hourstep,referer:R}).on("ui:slider:change",function(e){var a=v.getData(r).hour(e.getData().value);if(j.find("."+N).setInnerHTML(a.format(g.format)),"setvalue"!=e.getData().via){var t=a.format("YYYY-MM-DD HH:mm:ss");v.setAttr("value",t).setValue(t),v.trigger("ui:datepicker:change",{value:t})}})}else K.find(".hour").remove();if(g.minute){var $=K.find(".minute"),_=$.find("span");$.find("label").setInnerHTML(n[g.language].timesliderLabel.m),$.find("input").setValue(H.minute()).makeUiSlider({min:g.minutemin,max:g.minutemax,step:g.minutestep,referer:_}).on("ui:slider:change",function(e){var a=v.getData(r).minute(e.getData().value);if(j.find("."+N).setInnerHTML(a.format(g.format)),"setvalue"!=e.getData().via){var t=a.format("YYYY-MM-DD HH:mm:ss");v.setAttr("value",t).setValue(t),v.trigger("ui:datepicker:change",{value:t})}})}else K.find(".minute").remove();if(g.second){var G=K.find(".second"),J=G.find("span");G.find("label").setInnerHTML(n[g.language].timesliderLabel.s),G.find("input").setValue(H.second()).makeUiSlider({min:g.secondmin,max:g.secondmax,step:g.secondstep,referer:J}).on("ui:slider:change",function(e){var a=v.getData(r).second(e.getData().value);if(j.find("."+N).setInnerHTML(a.format(g.format)),"setvalue"!=e.getData().via){var t=a.format("YYYY-MM-DD HH:mm:ss");v.setAttr("value",t).setValue(t),v.trigger("ui:datepicker:change",{value:t})}})}else K.find(".second").remove();g.hour&&H.hour(P.find("input").getValue()),g.minute&&H.minute($.find("input").getValue()),g.second&&H.second(G.find("input").getValue())}else K.remove();else K.remove();var Q=moment(H);v.setData(t,Q),v.setData(r,moment(H));var X=H.format(g.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");""==V&&""!=B||g.disabledDate&&g.disabledDate(H.format("YYYY-MM-DD"))||(v.setAttr("value",X).setValue(X),j.addClass("has-value"),v.trigger("ui:datepicker:change",{value:X}));var Z=E.find("."+M),ee=!1,ae=!1;if(g.calendarChangeMonthYear){var te=moment();te.locale(g.language);var re='<select class="zui-calendar-input-month">',se=function(e){var a="",t=moment();t.locale(g.language);for(var r=0;r<12;r++)a+='<option value="'+r+'" '+(e==r?"selected":"")+" >"+t.month(r).format(g.full?"MMMM":"MMM")+"</option>";return a};if(re+=se(Q.month()),re+="</select>",g.calendarYearFieldUseInput)re+='<input class="zui-calendar-input-year" value="'+te.format("YYYY")+'" />';else{var ne=function(e){for(var a="",t=e-40;t<=e+20;t++)a+='<option value="'+t+'" '+(t==e?"selected":"")+" >"+(t==e-40?t+" ("+n[g.language].orbefore+")":t==e+20?t+" ("+n[g.language].orafter+")":t)+"</option>";return a};re+='<select class="zui-calendar-input-year">',re+=ne(te.year()),re+="</select>"}Z.setInnerHTML(re),ee=Z.find(".zui-calendar-input-month"),ae=Z.find(".zui-calendar-input-year"),j.on("click",".zui-calendar-input-month, .zui-calendar-input-year",function(e){de&&de.hasClass("isfocus")&&(ce=!0),e.preventDefault(),e.stop()});var ie=function(){var e=moment();if(e.month(ee.getValue().toInt()).year(ae.getValue().toInt()),e.isValid()){var a=v.getData(t),s=v.getData(r);a.month(e.month()).year(e.year()),q.find("."+C).remove(),q.append(pe(a,s,g)),v.trigger("ui:datepicker:changeMonth",{value:a.format(g.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD")})}};g.calendarYearFieldUseInput?ae.on("keydown",function(e){if([48,49,50,51,52,53,54,55,56,57,37,39,8,9,13].indexOf(e.getKeyCode())<0)return void e.preventDefault()}).on("keyup",ie):ae.on("change",ie),ee.on("change",ie)}else Z.remove();j.find("."+h).click(function(e){de&&de.hasClass("isfocus")&&(ce=!0);var a=zjs(this);e.preventDefault(),e.stop();var s=v.getData(t),n=v.getData(r);s.month(s.month()+a.getAttr("data-count").toInt()),q.find("."+C).remove(),q.append(pe(s,n,g)),v.trigger("ui:datepicker:changeMonth",{value:s.format(g.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD")})});var de=!1,le=!1,oe=!1,ue=!1,me=function(e,a){if(g.strictInput){e=e||null,a=a||0;var t=de.getValue().trim(),r=null===e||t.length>e.length,s="";if("DD.MM.YYYY"===g.format&&(s='<span class="zdd">DD</span>.<span class="zmm">MM</span>.<span class="zyyyy">YYYY</span>'),""===s)return"";ue.html(s);var n=null,i=null,d=null,l=null;if("DD.MM.YYYY"===g.format){var o=t.replace(/\.(\.)+/g,".").split(".").splice(0,3).join(".");o.length!==t.length&&(t=o,de.setValue(t));var u="."===t.substr(t.length-1),m=t.split(".").length>=3;if(null===e||""===e||m||"."===e.substr(e.length-1)||191!==a&&39!==a||(t+=".",u=r=!0,de.setValue(t)),1===t.length&&r&&parseInt(t)>=4&&(t="0"+t+".",u=!0,de.setValue(t)),2===t.length&&u&&r&&(t="0"+t,de.setValue(t)),2===t.length){var f=parseInt(t);!isNaN(f)&&f>=32&&(t="0"+t[0]+".0"+t[1]+".",u=!0,de.setValue(t))}if(2===t.length&&!u&&r&&(u=!0,t+=".",de.setValue(t)),3===t.length&&t.indexOf(".")<1&&(t=t.substr(0,2)+"."+t.substr(2),de.setValue(t)),4===t.length&&2===t.indexOf(".")&&r&&!u){var c=t.split("."),Y=parseInt(c[1]);!isNaN(Y)&&Y>=2&&(t=c[0]+".0"+c[1]+".",de.setValue(t),u=!0)}if(4===t.length&&1===t.indexOf(".")){var c=t.split("."),Y=parseInt(c[1]);!isNaN(Y)&&Y>12&&(t=c[0]+"."+c[1].substr(0,1)+"."+c[1].substr(1),de.setValue(t))}if(5===t.length&&2===t.indexOf(".")&&r&&u&&(t=t.substr(0,2)+".0"+t.substr(3),de.setValue(t)),5===t.length&&2===t.indexOf(".")&&r){var c=t.split("."),Y=parseInt(c[1]);isNaN(Y)||(Y>=13?t=c[0]+".0"+c[1].substr(0,1)+"."+c[1].substr(1):(t=c[0]+"."+c[1]+".",u=!0),de.setValue(t))}if(6===t.length&&2===t.indexOf(".")){var c=t.split("."),Y=parseInt(c[1]);!isNaN(Y)&&Y>=100&&(t=c[0]+"."+c[1].substr(0,2)+"."+c[1].substr(2),de.setValue(t))}if(6===t.length&&2===t.indexOf(".")&&r&&!u&&(t=t.substr(0,5)+"."+t.substr(5),de.setValue(t)),8===t.length&&2===t.indexOf(".")&&r&&!u){var c=t.split(".");c[2]&&!isNaN(parseInt(c[2]))&&(parseInt(c[2])<=9?(t=t.substr(0,5)+".20"+t.substr(6),de.setValue(t)):parseInt(c[2])>=30&&(t=t.substr(0,5)+".19"+t.substr(6),de.setValue(t)))}var p=t.split(".");p.length>=1&&(l="dd",""!==p[0]&&(n=p[0])),p.length>=2&&(l="mm",""!==p[1]&&(i=p[1])),p.length>=3&&(l="yyyy",""!==p[2]&&(d=p[2])),p.length>=2&&""===p[0].trim()&&""===p[1].trim()&&(l=null)}return null!==n&&ue.find(".zdd").html(n.toString()).addClass("int"),null!==i&&ue.find(".zmm").html(i.toString()).addClass("int"),null!==d&&ue.find(".zyyyy").html(d.toString()).addClass("int"),ue.find("span").removeClass("active"),null!==l&&ue.find(".z"+l).addClass("active"),""}};if(g.button){j.find("."+d).remove(),le=j.find("."+u),le.makeButton();var fe=B;""==fe&&(fe=g.format),le.find("."+N).setInnerHTML(g.disabledDate&&g.disabledDate(H.format("YYYY-MM-DD"))?fe:H.format(g.format)),le.on("click",function(e,a){e.preventDefault(),e.stop();var t=le.hasClass(F);zjs("."+m).removeClass(F),zjs("."+f).addClass(Y),t||(le.addClass(F),E.removeClass(Y))})}else{oe=j.find("."+d),oe.on("click",function(){de.focus()}),j.find("."+o).remove(),de=j.find("."+l),""==V&&""!=B||g.disabledDate&&g.disabledDate(H.format("YYYY-MM-DD"))||de.setValue(H.format(g.format));var fe=B;""==fe&&(fe=g.format),g.labelPlaceholder&&""!==fe?(zjs("<span>").addClass("placeholder").html(fe).insertAfter(oe),oe.addClass("label-placeholder"),de.setAttr("placeholder","")):de.setAttr("placeholder",fe),de.addClass(g.inputClass),de.setAttr("autocomplete","off"),g.strictInput&&(de.setAttr("maxlength",g.format.length),ue=zjs("<div>").addClass("zui-datepicker-input-behide"),ue.insertBefore(de),me()),v.on("focus",function(){de.focus()});var ce=!1;de.on("focus",function(e){e.preventDefault(),me(),ce=!1;var a=zjs(this);zjs("."+l).removeClass("isfocus"),zjs("."+m).removeClass(F),zjs("."+f).addClass(Y),a.addClass("isfocus"),j.addClass("focus"),v.addClass(F),g.panel&&E.removeClass(Y),v.trigger("ui:datepicker:focus",{})}),de.on("click",function(e){e.stop()});var Ye="";de.on("keydown",function(e){var a=this.getValue().trim(),t=e.getKeyCode();if("DD/MM/YYYY"==g.format||"DD.MM.YYYY"==g.format){var r=!1;return[48,49,50,51,52,53,54,55,56,57,37,39,8,9,13,65,191,190].indexOf(t)<0&&(r=!0),191===t&&"DD/MM/YYYY"!==g.format&&(r=!0),190===t&&"DD.MM.YYYY"!==g.format&&(r=!0),190===t&&""===a&&(r=!0),190===t&&"."===a[a.length-1]&&(r=!0),r||65!==t||e.metaKey()||(r=!0),g.strictInput&&function(){me(a,t)}.delay(40),r?void e.preventDefault():void 0}}),de.on("keyup",function(e){e.preventDefault();var a=zjs(this);if(Ye=a.getValue(""),Ye&&(Ye=Ye.trim()),""!=Ye){var s=moment(Ye,g.format);if(s.isValid()){var n=v.getData(t),i=v.getData(r);n.year(s.year()).month(s.month()).date(s.date()),i.year(s.year()).month(s.month()).date(s.date()),q.find("."+C).remove(),q.append(pe(n,i,g))}}}),de.on("blur",function(e){var a=zjs(this);Ye=a.getValue(""),Ye&&(Ye=Ye.trim()),function(){if(!ce){if(""!=Ye){var e=moment(Ye,g.format);e.isValid()||(Ye=""),""!=Ye&&g.disabledDate&&g.disabledDate(e.format("YYYY-MM-DD"))&&(Ye="")}if(""!=Ye){var s=v.getData(t),n=v.getData(r);n.year(e.year()).month(e.month()).date(e.date()),s.year(e.year()).month(e.month()).date(e.date()),v.setData(r,n),v.setData(t,s),q.find("."+C).remove(),q.append(pe(s,n,g)),a.setValue(n.format(g.format)),j.addClass("has-value");var i=n.format(g.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");v.setAttr("value",i).setValue(i),v.trigger("ui:datepicker:change",{value:i})}else j.removeClass("has-value"),de.setValue(""),v.setAttr("value","").setValue(""),v.trigger("ui:datepicker:change",{value:""});v.trigger("ui:datepicker:blur",{}),E.addClass(Y),a.removeClass("isfocus"),j.removeClass("focus")}}.delay(200)})}v.addClass(W),q.on("click","[data-date]",function(e){de&&de.hasClass("isfocus")&&(ce=!0,de.removeClass("isfocus"));var a=zjs(this),s=a.getAttr("data-date"),n=v.getData(r);n=moment(n.format("["+s+"] HH:mm:ss"),"YYYY-MM-DD HH:mm:ss"),n.locale(g.language),v.setData(r,n),q.find("."+I).removeClass(I),a.addClass(I),le&&le.find("."+N).setInnerHTML(n.format(g.format)),de&&de.setValue(n.format(g.format));var i=v.getData(t);i.year(n.year()).month(n.month()).date(n.date()),v.setData(t,i),s=n.format(g.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD"),v.setAttr("value",s).setValue(s),v.trigger("ui:datepicker:change",{value:s}),v.trigger("ui:datepicker:blur",{});var d=a.getAttr("href","");""!=d&&(window.location.href=d)});var pe=function(e,a,t){var r=zjs("<div>").addClass(C);zjs(T).setInnerHTML(e.format(t.calendarTitleFormat)).appendTo(r),ee&&ee.setInnerHTML(se(e.month())),ae&&(t.calendarYearFieldUseInput?ae.setValue(e.year()):ae.setInnerHTML(ne(e.year())));var s=zjs(w).appendTo(r),n=moment(e).startOf("week");1==t.firstOfWeek&&n.add(1,"day");for(var i=0;i<7;i++)zjs(S).setInnerHTML(n.format(t.full?"dddd":"dd")).appendTo(s),n.add(1,"day");var d=moment(e).startOf("month"),l=moment(e).endOf("month").startOf("day"),o=moment(),u=moment(d.format("YYYY-MM-DD")),m=zjs(A);t.selectweek&&m.addClass("zui-week");for(var f=0;u.unix()<=l.unix();){if(u.unix()==d.unix()){var c=d.day();for(1==t.firstOfWeek&&0==c&&(c=7),i=t.firstOfWeek;i<c;i++)t.selectweek&&i==t.firstOfWeek&&m.setAttr("data-date",u.format("YYYY-MM-DD")),zjs(L).setInnerHTML("&nbsp;").addClass(O).appendTo(m),f++}var Y=u.date(),p=u.day(),v=zjs(L).setInnerHTML(Y).appendTo(m);t.selectweek?t.disabledDate&&t.disabledDate(u)?m.addClass("disabled"):m.setAttr("data-date",u.format("YYYY-MM-DD")):t.disabledDate&&t.disabledDate(u)?v.addClass("disabled"):v.setAttr("data-date",u.format("YYYY-MM-DD")),""==t.href||t.selectweek||v.setAttr("href",t.href.format({date:u.format("YYYY-MM-DD"),datetime:u.format("YYYY-MM-DD HH:mm:ss")})),""!=t.href&&t.selectweek&&m.setAttr("href",t.href.format({date:u.format("YYYY-MM-DD"),datetime:u.format("YYYY-MM-DD HH:mm:ss")})),u.format("YYYY-MM-DD")==o.format("YYYY-MM-DD")&&(t.selectweek?v.parent().addClass(x):v.addClass(x)),u.format("YYYY-MM-DD")==a.format("YYYY-MM-DD")&&(t.selectweek?v.parent().addClass(I):v.addClass(I)),f++,(6==p&&0==t.firstOfWeek||0==p&&1==t.firstOfWeek||u.unix()==l.unix())&&(r.append(m),m=zjs(A),t.selectweek&&m.addClass("zui-week"),f=0),u.add(1,"day")}return r};q.append(pe(H,H,g)),v.trigger("ui:datepicker:ready",{value:X})};zjs(document).click(function(e){zjs("."+u).removeClass(F),zjs("."+c).addClass(Y),zjs("."+l).removeClass("isfocus")});var B=function(s,n){var i=zjs(s),d=i.getData(a,!1);if(d){var l=i.getData(e),o=moment(n,l.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");o.locale(l.language),i.setData(t,moment(o)),i.setData(r,moment(o)),d.find("."+N).setInnerHTML(o.format(l.format));var u=d.find("."+k);u.find(".hour > input").sliderSetValue(o.hour()),u.find(".minute > input").sliderSetValue(o.minute()),u.find(".second > input").sliderSetValue(o.second());var m=d.find("."+D);m.find("."+C).remove(),m.append(drawCalendar(o,o,l));var f=o.format(l.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");i.setAttr("value",f).setValue(f),i.trigger("ui:datepicker:change",{value:f,via:"api"})}};zjs.extendMethod({makeDatepicker:function(e){return this.eachElement(function(a){U(a,e)})},datepickerSetValue:function(e){return this.eachElement(function(a){B(a,e)})}}),zjs.hook({after_setInnerHTML:function(e){zjs(e).find(".zdatepicker").makeDatepicker()},after_insertDOM:function(e){zjs(e).hasClass("zdatepicker")&&zjs(e).makeDatepicker(),zjs(e).find(".zdatepicker").makeDatepicker()}}),zjs.onready(function(){zjs(".zdatepicker").makeDatepicker(),zjs(".zdatetimepicker").makeDatepicker({time:!0})}),"required"in zjs&&zjs.required("ui.datepicker")});