zjs.require("ui, ui.button, moment",function(){"use strict";var e="zmoduleuidatepickeroption",a="zmoduleuidatepickerwrapel",t="zmoduleuidatepickercalendardatetime",s="zmoduleuidatepickerselectdatetime",r=zjs("html").getAttr("lang","en").split("-");r=r[0];var n={en:{format:"MM-DD-YYYY",calendarTitleFormat:"MMMM, YYYY",timesliderLabel:{h:"hour",m:"minute",s:"second"},firstOfWeek:0,orbefore:"or before",orafter:"or after"},de:{format:"DD.MM.YYYY",calendarTitleFormat:"MMMM, YYYY",timesliderLabel:{h:"hour",m:"minute",s:"second"},firstOfWeek:0,orbefore:"or before",orafter:"or after"},vi:{format:"DD-MM-YYYY",calendarTitleFormat:"MMMM, YYYY",timesliderLabel:{h:"giờ",m:"phút",s:"giây"},firstOfWeek:1,orbefore:"hoặc trước",orafter:"hoặc sau"}};zjs.extendCore({moduleUiDatepickerOption:{full:!1,time:!1,hour:!0,hourmin:0,hourmax:23,hourstep:1,minute:!0,minutemin:0,minutemax:59,minutestep:1,second:!0,secondmin:0,secondmax:59,secondstep:1,button:!0,strictInput:!1,labelPlaceholder:!1,language:r,firstOfWeek:n[r].firstOfWeek,calendarTitleFormat:n[r].calendarTitleFormat,format:n[r].format,href:"",selectweek:!1,inputClass:"",disabledDate:!1,calendarChangeMonthYear:!0,calendarYearFieldUseInput:!1,panel:!0}});var i="zui-datepicker",d="zui-datepicker-input-wrap",l="zui-datepicker-input",o="zui-datepicker-button-wrap",u="zui-datepicker-button",m="zui-contextual-button",f="zui-contextual-panel-wrap",c="zui-datepicker-panel-wrap",Y="zui-hide",p="zui-full",v="zui-datepicker-panel-inner",D="zui-datepicker-panel",h="zui-datepicker-nav",M="zui-datepicker-month-change",g="zui-datepicker-nav-prev",z="zui-datepicker-nav-next",k="zui-datepicker-time-panel",b="zui-datepicker-time-inner",y='<div class="'+i+'"><div class="'+d+'"><input type="text" class="'+m+" "+l+'" /></div><div class="'+o+'"><a class="'+m+" "+u+'"></a></div><div class="'+f+" "+c+" "+Y+'"><div class="'+v+'"><div class="'+D+'"></div><div class="'+M+'"></div><a class="'+h+" "+g+'" data-count="-1"><i></i></a><a class="'+h+" "+z+'" data-count="1"><i></i></a><div class="'+k+'"><div class="'+b+'"><div class="timeunit hour"><label>hour</label><span></span><input /></div><div class="timeunit minute"><label>minute</label><span></span><input /></div><div class="timeunit second"><label>second</label><span></span><input /></div></div></div></div></div></div>',C="zui-calendar-wrap",j="zui-row",V="zui-month",H="zui-weekday",x="zui-current-day",I="zui-selected-day",O="zui-empty-day",A='<div class="'+j+'"></div>',T='<div class="'+j+" "+V+'"></div>',w='<div class="'+j+" "+H+'"></div>',L='<a class="zui-cell"></a>',S="<label></label>",N="zui-button-label",F="activenothover",W="zui-uihide",U=function(r,i){var v=zjs(r),g=v.getData(e);if(g)v.setData(e,zjs.extend(g,i));else{g=zjs.clone(zjs.moduleUiDatepickerOption);var z=v.getAttr("data-option","");zjs.isString(z)&&""!=z.trim()&&(g=zjs.extend(g,z.jsonDecode())),v.removeAttr("data-option"),void 0!==i&&(g=zjs.extend(g,i));var b,j,V,H,U,B,E=v.getAttr("data-href","");""!=E&&(g.href=E),zjs.isString(g.disabledDate)&&(g.disabledDate=g.disabledDate.split(/\s*,\s*/)),zjs.isArray(g.disabledDate)&&(g.disabledDate=(b=g.disabledDate,j=[],V=!1,H=moment().format("YYYY-MM-DD"),U=moment().add(1,"day").format("YYYY-MM-DD"),B=moment().add(-1,"day").format("YYYY-MM-DD"),zjs.foreach(b,function(e){e=e.trim(),e=e.replace("today",H).replace("tomorrow",U).replace("yesterday",B).replace("to","<<").replace("before","<").replace("after",">");var a="";if(e.indexOf("<<")>=0&&e.match(/(\d\d\d\d-\d\d?-\d\d?)\s*<<\s*(\d\d\d\d-\d\d?-\d\d?)/)&&(e=RegExp.$1+"<<",a=RegExp.$2),V=moment(e,"YYYY-MM-DD"),V.isValid()){var t="=";e.indexOf("<<")>=0?t="<<":e.indexOf("<")>=0?t="<":e.indexOf(">")>=0&&(t=">"),"<<"==t&&(V.add(-1,"day"),a=moment(a,"YYYY-MM-DD").add(1,"day").format("YYYY-MM-DD")),j.push({comparison:t,date:V.format("YYYY-MM-DD"),date2:a})}}),!(j.length<=0)&&function(e){var a=!1,t="";return zjs.foreach(j,function(s){if("="==s.comparison?t="isSame":"<"==s.comparison?t="isBefore":">"==s.comparison?t="isAfter":"<<"==s.comparison&&(t="isBetween"),moment(e,"YYYY-MM-DD")[t](s.date,s.date2))return a=!0,!1}),a})),zjs.isFunction(g.disabledDate)||(g.disabledDate=!1),g.panel=!!g.panel,g.strictInput=!!g.strictInput,g.strictInput&&(g.button=!1),v.setData(e,g);var q=zjs(y).insertAfter(v);v.setData(a,q);var K=v.getValue(""),P=""==K?moment():moment(K,"YYYY-MM-DD HH:mm:ss");g.hour||P.hour(0),g.minute||P.minute(0),g.second||P.second(0);var R=v.getAttr("placeholder",""),$=R;P.locale(g.language);var _=q.find("."+c),G=q.find("."+D),J=q.find("."+k);if(g.full&&_.addClass(p),g.time)if("makeUiSlider"in J){if(_.on("click",function(e){e.preventDefault(),e.stop()}),g.hour){var Q=J.find(".hour"),X=Q.find("span");Q.find("label").setInnerHTML(n[g.language].timesliderLabel.h),Q.find("input").setValue(P.hour()).makeUiSlider({min:g.hourmin,max:g.hourmax,step:g.hourstep,referer:X}).on("ui:slider:change",function(e){var a=v.getData(s).hour(e.getData().value);if(q.find("."+N).setInnerHTML(a.format(g.format)),"setvalue"!=e.getData().via){var t=a.format("YYYY-MM-DD HH:mm:ss");v.setAttr("value",t).setValue(t),v.trigger("ui:datepicker:change",{value:t})}})}else J.find(".hour").remove();if(g.minute){var Z=J.find(".minute"),ee=Z.find("span");Z.find("label").setInnerHTML(n[g.language].timesliderLabel.m),Z.find("input").setValue(P.minute()).makeUiSlider({min:g.minutemin,max:g.minutemax,step:g.minutestep,referer:ee}).on("ui:slider:change",function(e){var a=v.getData(s).minute(e.getData().value);if(q.find("."+N).setInnerHTML(a.format(g.format)),"setvalue"!=e.getData().via){var t=a.format("YYYY-MM-DD HH:mm:ss");v.setAttr("value",t).setValue(t),v.trigger("ui:datepicker:change",{value:t})}})}else J.find(".minute").remove();if(g.second){var ae=J.find(".second"),te=ae.find("span");ae.find("label").setInnerHTML(n[g.language].timesliderLabel.s),ae.find("input").setValue(P.second()).makeUiSlider({min:g.secondmin,max:g.secondmax,step:g.secondstep,referer:te}).on("ui:slider:change",function(e){var a=v.getData(s).second(e.getData().value);if(q.find("."+N).setInnerHTML(a.format(g.format)),"setvalue"!=e.getData().via){var t=a.format("YYYY-MM-DD HH:mm:ss");v.setAttr("value",t).setValue(t),v.trigger("ui:datepicker:change",{value:t})}})}else J.find(".second").remove();g.hour&&P.hour(Q.find("input").getValue()),g.minute&&P.minute(Z.find("input").getValue()),g.second&&P.second(ae.find("input").getValue())}else J.remove();else J.remove();var se=moment(P);v.setData(t,se),v.setData(s,moment(P));var re=P.format(g.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");""==K&&""!=$||g.disabledDate&&g.disabledDate(P.format("YYYY-MM-DD"))||(v.setAttr("value",re).setValue(re),q.addClass("has-value"),v.trigger("ui:datepicker:change",{value:re}));var ne=_.find("."+M),ie=!1,de=!1;if(g.calendarChangeMonthYear){var le=moment();le.locale(g.language);var oe='<select class="zui-calendar-input-month">',ue=function(e){var a="",t=moment();t.locale(g.language);for(var s=0;s<12;s++)a+='<option value="'+s+'" '+(e==s?"selected":"")+" >"+t.month(s).format(g.full?"MMMM":"MMM")+"</option>";return a};if(oe+=ue(se.month()),oe+="</select>",g.calendarYearFieldUseInput)oe+='<input class="zui-calendar-input-year" value="'+le.format("YYYY")+'" />';else{var me=function(e){for(var a="",t=e-40;t<=e+20;t++)a+='<option value="'+t+'" '+(t==e?"selected":"")+" >"+(t==e-40?t+" ("+n[g.language].orbefore+")":t==e+20?t+" ("+n[g.language].orafter+")":t)+"</option>";return a};oe+='<select class="zui-calendar-input-year">',oe+=me(le.year()),oe+="</select>"}ne.setInnerHTML(oe),ie=ne.find(".zui-calendar-input-month"),de=ne.find(".zui-calendar-input-year"),q.on("click",".zui-calendar-input-month, .zui-calendar-input-year",function(e){ce&&ce.hasClass("isfocus")&&(Me=!0),e.preventDefault(),e.stop()});var fe=function(){var e=moment();if(e.month(ie.getValue().toInt()).year(de.getValue().toInt()),e.isValid()){var a=v.getData(t),r=v.getData(s);a.month(e.month()).year(e.year()),G.find("."+C).remove(),G.append(ze(a,r,g)),v.trigger("ui:datepicker:changeMonth",{value:a.format(g.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD")})}};g.calendarYearFieldUseInput?de.on("keydown",function(e){[48,49,50,51,52,53,54,55,56,57,37,39,8,9,13].indexOf(e.getKeyCode())<0&&e.preventDefault()}).on("keyup",fe):de.on("change",fe),ie.on("change",fe)}else ne.remove();q.find("."+h).click(function(e){ce&&ce.hasClass("isfocus")&&(Me=!0);var a=zjs(this);e.preventDefault(),e.stop();var r=v.getData(t),n=v.getData(s);r.month(r.month()+a.getAttr("data-count").toInt()),G.find("."+C).remove(),G.append(ze(r,n,g)),v.trigger("ui:datepicker:changeMonth",{value:r.format(g.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD")})});var ce=!1,Ye=!1,pe=!1,ve=!1,De=function(e,a){if(g.strictInput){e=e||null,a=a||0;var t=ce.getValue().trim(),s=null===e||t.length>e.length,r="";if("DD.MM.YYYY"===g.format&&(r='<span class="zdd">DD</span>.<span class="zmm">MM</span>.<span class="zyyyy">YYYY</span>'),""===r)return"";ve.html(r);var n=null,i=null,d=null,l=null;if("DD.MM.YYYY"===g.format){var o=t.replace(/\.(\.)+/g,".").split(".").splice(0,3).join(".");o.length!==t.length&&(t=o,ce.setValue(t));var u="."===t.substr(t.length-1),m=t.split(".").length>=3;if(null===e||""===e||m||"."===e.substr(e.length-1)||191!==a&&111!==a&&190!==a&&110!==a&&39!==a||(t+=".",u=s=!0,ce.setValue(t)),1===t.length&&s&&parseInt(t)>=4&&(t="0"+t+".",u=!0,ce.setValue(t)),2===t.length&&u&&s&&(t="0"+t,ce.setValue(t)),2===t.length){var f=parseInt(t);!isNaN(f)&&f>=32&&(t="0"+t[0]+".0"+t[1]+".",u=!0,ce.setValue(t))}if(2===t.length&&!u&&s&&(u=!0,t+=".",ce.setValue(t)),3===t.length&&t.indexOf(".")<1&&(t=t.substr(0,2)+"."+t.substr(2),ce.setValue(t)),4===t.length&&2===t.indexOf(".")&&s&&!u){var c=t.split("."),Y=parseInt(c[1]);!isNaN(Y)&&Y>=2&&(t=c[0]+".0"+c[1]+".",ce.setValue(t),u=!0)}if(4===t.length&&1===t.indexOf(".")){c=t.split("."),Y=parseInt(c[1]);!isNaN(Y)&&Y>12&&(t=c[0]+"."+c[1].substr(0,1)+"."+c[1].substr(1),ce.setValue(t))}if(5===t.length&&2===t.indexOf(".")&&s&&u&&(t=t.substr(0,2)+".0"+t.substr(3),ce.setValue(t)),5===t.length&&2===t.indexOf(".")&&s){c=t.split("."),Y=parseInt(c[1]);isNaN(Y)||(Y>=13?t=c[0]+".0"+c[1].substr(0,1)+"."+c[1].substr(1):(t=c[0]+"."+c[1]+".",u=!0),ce.setValue(t))}if(6===t.length&&2===t.indexOf(".")){c=t.split("."),Y=parseInt(c[1]);!isNaN(Y)&&Y>=100&&(t=c[0]+"."+c[1].substr(0,2)+"."+c[1].substr(2),ce.setValue(t))}if(6===t.length&&2===t.indexOf(".")&&s&&!u&&(t=t.substr(0,5)+"."+t.substr(5),ce.setValue(t)),8===t.length&&2===t.indexOf(".")&&s&&!u){c=t.split(".");c[2]&&!isNaN(parseInt(c[2]))&&(parseInt(c[2])<=9?(t=t.substr(0,5)+".20"+t.substr(6),ce.setValue(t)):parseInt(c[2])>=30&&(t=t.substr(0,5)+".19"+t.substr(6),ce.setValue(t)))}var p=t.split(".");p.length>=1&&(l="dd",""!==p[0]&&(n=p[0])),p.length>=2&&(l="mm",""!==p[1]&&(i=p[1])),p.length>=3&&(l="yyyy",""!==p[2]&&(d=p[2])),p.length>=2&&""===p[0].trim()&&""===p[1].trim()&&(l=null)}return null!==n&&ve.find(".zdd").html(n.toString()).addClass("int"),null!==i&&ve.find(".zmm").html(i.toString()).addClass("int"),null!==d&&ve.find(".zyyyy").html(d.toString()).addClass("int"),ve.find("span").removeClass("active"),null!==l&&ve.find(".z"+l).addClass("active"),""}};if(g.button){q.find("."+d).remove(),Ye=q.find("."+u),Ye.makeButton();he=$;""==he&&(he=g.format),Ye.find("."+N).setInnerHTML(g.disabledDate&&g.disabledDate(P.format("YYYY-MM-DD"))?he:P.format(g.format)),Ye.on("click",function(e,a){e.preventDefault(),e.stop();var t=Ye.hasClass(F);zjs("."+m).removeClass(F),zjs("."+f).addClass(Y),t||(Ye.addClass(F),_.removeClass(Y))})}else{pe=q.find("."+d),pe.on("click",function(){ce.focus()}),q.find("."+o).remove(),ce=q.find("."+l),""==K&&""!=$||g.disabledDate&&g.disabledDate(P.format("YYYY-MM-DD"))||ce.setValue(P.format(g.format));var he=$;""==he&&(he=g.format),g.labelPlaceholder&&""!==he?(zjs("<span>").addClass("placeholder").html(he).insertAfter(pe),pe.addClass("label-placeholder"),ce.setAttr("placeholder","")):ce.setAttr("placeholder",he),ce.addClass(g.inputClass),ce.setAttr("autocomplete","off"),g.strictInput&&(ce.setAttr("maxlength",g.format.length),ve=zjs("<div>").addClass("zui-datepicker-input-behide"),ve.insertBefore(ce),De()),v.on("focus",function(){ce.focus()});var Me=!1;ce.on("focus",function(e){e.preventDefault(),De(),Me=!1;var a=zjs(this);zjs("."+l).removeClass("isfocus"),zjs("."+m).removeClass(F),zjs("."+f).addClass(Y),a.addClass("isfocus"),q.addClass("focus"),v.addClass(F),g.panel&&_.removeClass(Y),v.trigger("ui:datepicker:focus",{})}),ce.on("click",function(e){e.stop()});var ge="";ce.on("keydown",function(e){var a=this.getValue().trim(),t=e.getKeyCode();if("DD/MM/YYYY"==g.format||"DD.MM.YYYY"==g.format){var s=!1;[48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105,37,39,8,9,13,65,191,190].indexOf(t)<0&&(s=!0),191!==t&&111!==t||"DD/MM/YYYY"===g.format||(s=!0),190!==t&&110!==t||"DD.MM.YYYY"===g.format||(s=!0),190!==t&&110!==t||""!==a||(s=!0),190!==t&&110!==t||"."!==a[a.length-1]||(s=!0),s||65!==t||e.metaKey()||(s=!0),g.strictInput&&function(){De(a,t)}.delay(40),s&&e.preventDefault()}}),ce.on("keyup",function(e){e.preventDefault();var a=zjs(this);if(ge=a.getValue(""),ge&&(ge=ge.trim()),""!=ge){var r=moment(ge,g.format);if(r.isValid()){var n=v.getData(t),i=v.getData(s);n.year(r.year()).month(r.month()).date(r.date()),i.year(r.year()).month(r.month()).date(r.date()),G.find("."+C).remove(),G.append(ze(n,i,g))}}}),ce.on("blur",function(e){var a=zjs(this);ge=a.getValue(""),ge&&(ge=ge.trim()),function(){if(!Me){if(""!=ge){var e=moment(ge,g.format);e.isValid()||(ge=""),""!=ge&&g.disabledDate&&g.disabledDate(e.format("YYYY-MM-DD"))&&(ge="")}if(""!=ge){var r=v.getData(t),n=v.getData(s);n.year(e.year()).month(e.month()).date(e.date()),r.year(e.year()).month(e.month()).date(e.date()),v.setData(s,n),v.setData(t,r),G.find("."+C).remove(),G.append(ze(r,n,g)),a.setValue(n.format(g.format)),q.addClass("has-value");var i=n.format(g.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");v.setAttr("value",i).setValue(i),v.trigger("ui:datepicker:change",{value:i})}else q.removeClass("has-value"),ce.setValue(""),v.setAttr("value","").setValue(""),v.trigger("ui:datepicker:change",{value:""});v.trigger("ui:datepicker:blur",{}),_.addClass(Y),a.removeClass("isfocus"),q.removeClass("focus")}}.delay(200)})}v.addClass(W),G.on("click","[data-date]",function(e){ce&&ce.hasClass("isfocus")&&(Me=!0,ce.removeClass("isfocus"));var a=zjs(this),r=a.getAttr("data-date"),n=v.getData(s);n=moment(n.format("["+r+"] HH:mm:ss"),"YYYY-MM-DD HH:mm:ss"),n.locale(g.language),v.setData(s,n),G.find("."+I).removeClass(I),a.addClass(I),Ye&&Ye.find("."+N).setInnerHTML(n.format(g.format)),ce&&ce.setValue(n.format(g.format));var i=v.getData(t);i.year(n.year()).month(n.month()).date(n.date()),v.setData(t,i),r=n.format(g.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD"),v.setAttr("value",r).setValue(r),v.trigger("ui:datepicker:change",{value:r}),v.trigger("ui:datepicker:blur",{});var d=a.getAttr("href","");""!=d&&(window.location.href=d)});var ze=function(e,a,t){var s=zjs("<div>").addClass(C);zjs(T).setInnerHTML(e.format(t.calendarTitleFormat)).appendTo(s),ie&&ie.setInnerHTML(ue(e.month())),de&&(t.calendarYearFieldUseInput?de.setValue(e.year()):de.setInnerHTML(me(e.year())));var r=zjs(w).appendTo(s),n=moment(e).startOf("week");1==t.firstOfWeek&&n.add(1,"day");for(var i=0;i<7;i++)zjs(S).setInnerHTML(n.format(t.full?"dddd":"dd")).appendTo(r),n.add(1,"day");var d=moment(e).startOf("month"),l=moment(e).endOf("month").startOf("day"),o=moment(),u=moment(d.format("YYYY-MM-DD")),m=zjs(A);t.selectweek&&m.addClass("zui-week");for(;u.unix()<=l.unix();){if(u.unix()==d.unix()){var f=d.day();for(1==t.firstOfWeek&&0==f&&(f=7),i=t.firstOfWeek;i<f;i++)t.selectweek&&i==t.firstOfWeek&&m.setAttr("data-date",u.format("YYYY-MM-DD")),zjs(L).setInnerHTML("&nbsp;").addClass(O).appendTo(m),0}var c=u.date(),Y=u.day(),p=zjs(L).setInnerHTML(c).appendTo(m);t.selectweek?t.disabledDate&&t.disabledDate(u)?m.addClass("disabled"):m.setAttr("data-date",u.format("YYYY-MM-DD")):t.disabledDate&&t.disabledDate(u)?p.addClass("disabled"):p.setAttr("data-date",u.format("YYYY-MM-DD")),""==t.href||t.selectweek||p.setAttr("href",t.href.format({date:u.format("YYYY-MM-DD"),datetime:u.format("YYYY-MM-DD HH:mm:ss")})),""!=t.href&&t.selectweek&&m.setAttr("href",t.href.format({date:u.format("YYYY-MM-DD"),datetime:u.format("YYYY-MM-DD HH:mm:ss")})),u.format("YYYY-MM-DD")==o.format("YYYY-MM-DD")&&(t.selectweek?p.parent().addClass(x):p.addClass(x)),u.format("YYYY-MM-DD")==a.format("YYYY-MM-DD")&&(t.selectweek?p.parent().addClass(I):p.addClass(I)),0,(6==Y&&0==t.firstOfWeek||0==Y&&1==t.firstOfWeek||u.unix()==l.unix())&&(s.append(m),m=zjs(A),t.selectweek&&m.addClass("zui-week"),0),u.add(1,"day")}return s};G.append(ze(P,P,g)),v.trigger("ui:datepicker:ready",{value:re})}};zjs(document).click(function(e){zjs("."+u).removeClass(F),zjs("."+c).addClass(Y),zjs("."+l).removeClass("isfocus")});var B=function(r,n){var i=zjs(r),d=i.getData(a,!1);if(d){var l=i.getData(e),o=moment(n,l.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");o.locale(l.language),i.setData(t,moment(o)),i.setData(s,moment(o)),d.find("."+N).setInnerHTML(o.format(l.format));var u=d.find("."+k);u.find(".hour > input").sliderSetValue(o.hour()),u.find(".minute > input").sliderSetValue(o.minute()),u.find(".second > input").sliderSetValue(o.second());var m=d.find("."+D);m.find("."+C).remove(),m.append(drawCalendar(o,o,l));var f=o.format(l.time?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD");i.setAttr("value",f).setValue(f),i.trigger("ui:datepicker:change",{value:f,via:"api"})}};zjs.extendMethod({makeDatepicker:function(e){return this.eachElement(function(a){U(a,e)})},datepickerSetValue:function(e){return this.eachElement(function(a){B(a,e)})}}),zjs.hook({after_setInnerHTML:function(e){zjs(e).find(".zdatepicker").makeDatepicker()},after_insertDOM:function(e){zjs(e).hasClass("zdatepicker")&&zjs(e).makeDatepicker(),zjs(e).find(".zdatepicker").makeDatepicker()}}),zjs.onready(function(){zjs(".zdatepicker").makeDatepicker(),zjs(".zdatetimepicker").makeDatepicker({time:!0})}),"required"in zjs&&zjs.required("ui.datepicker")});