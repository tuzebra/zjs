zjs.require("ui, transition",function(){var l=!1,q=!1;zjs.extendCore({moduleParallaxOption:{property:"margin",horizontal:!1,sectionclass:"zparallax-section",elementclass:"zparallax-element",keyframes:!1,indicator:!1,indicatorTemplate:'<a class="indicator">.</a>',autoscaleusecss:!1,scrolltime:800,transition:2,timewaittofocus:200,debug:!1}});var D=function(e,b){var a=zjs(e),d=a.getData("zmoduleparallaxoption");if(d)a.setData("zmoduleparallaxoption",zjs.extend(d,b));else{d=zjs.clone(zjs.moduleParallaxOption);
var c=a.getData("inlineoption","");""==c&&(c=a.getAttr("data-option",""));zjs.isString(c)&&""!=c.trim()&&(d=zjs.extend(d,c.jsonDecode()),a.setData("inlineoption",c));a.removeAttr("data-option");"undefined"!=typeof b&&(d=zjs.extend(d,b));a.setData("zmoduleparallaxoption",d);a.addClass("zparallax");a.addClass(d.horizontal?"zparallax-horizontal":"zparallax-vertical");d.autoscaleusecss&&a.addClass("zparallax-autoscale");var g=!1;d.indicator&&(a.append('<div class="zparallax-indicator-wrapper"><div class="zparallax-indicator-container"></div></div>'),
g=a.find(".zparallax-indicator-container"));var h=[];zSectionEls=a.find("."+d.sectionclass);zSectionEls.eachElement(function(a,b){var f=zjs(a);d.autoscaleusecss&&f.top(100*b+"%");f.setData("zmoduleparallaxautoscale",f.getAttr("data-autoscale"));f.removeAttr("data-autoscale");var c=f.getAttr("data-name","");""==c&&(c="section"+(b+1),f.setAttr("data-name",c));h.push(c);d.indicator&&(f=d.indicatorTemplate,zjs.isFunction(f)&&(f=f(b,c)),f=f.format({index:b,name:c}),zjs(f).addClass("zparallax-indicator").setAttr("data-name",
c).appendTo(g).click(function(a,d){var f=zjs(d).getAttr("data-name","");k(e,f)}))});a.setData("zmoduleparallaxlistsectionname",h);var y=a.find(".zparallax-navigation[data-name]").click(function(){var a=this.getAttr("data-name");k(e,a)});zElementEls=a.find("."+d.elementclass);var z=0,A=0,m=0,p="",B="",r="";zElementEls.eachElement(function(a){a=zjs(a);var b=0,c=0;"margin"==d.property&&(b=a.getStyle("margin-top",0),c=a.getStyle("margin-left",0));a.setData("originalPropertyTop",b).setData("originalPropertyLeft",
c);b=a.getAttr("data-ratio-vertical",0).toFloat();c=a.getAttr("data-ratio-horizontal",0).toFloat();a.setData("ratioVertical",b).setData("ratioHorizontal",c).removeAttr("data-ratio-vertical").removeAttr("data-ratio-horizontal");b=a.getAttr("data-keyframes","");c=!1;zjs.isString(b)&&""!=b.trim()&&(c=b.jsonDecode());a.removeAttr("data-keyframes");zjs.isObject(c)&&"setKeyframes"in a&&a.setKeyframes("zmoduleparallaxautokeyframe",c);b=a.getAttr("data-keyframes-name","");""!=b&&zjs.isObject(d.keyframes)&&
b in d.keyframes&&a.setKeyframes("zmoduleparallaxautokeyframe",d.keyframes[b])});var n=!1,t=function(a){y.removeClass("active");y.filter('[data-name="'+a+'"]').addClass("active")},w=function(){!q&&l&&l.stop({force:!0});q=!1;n||(m=d.horizontal?a.scrollLeft():a.scrollTop());if(!n&&(n=a.getData("zmodulescrollbaroption"))||n)m=a.scrollPosition();a.setData("zmoduleparallaxcurrentscroll",m);zElementEls.eachElement(function(a){a=zjs(a);var b=a.getData("originalPropertyTop").toFloat(),c=a.getData("originalPropertyLeft").toFloat(),
e=a.getData("ratioVertical"),g=a.getData("ratioHorizontal"),f=a.findUp("."+d.sectionclass),h=f.count()?parseFloat(f.getAttr("data-gap-start-at",0),10):0,k=0;f.count()&&(k=d.horizontal?f.left():f.top());var l=(m-k-h)*e;h=(m-k-h)*g;b-=l;c-=h;"margin"==d.property&&(e&&a.setStyle("margin-top",b),g&&a.setStyle("margin-left",c));a.isExistsKeyframes("zmoduleparallaxautokeyframe")&&(e=f.count()?parseFloat(f.getAttr("data-keyframe-start-at",0),10):0,a.setStyleByKeyframes("zmoduleparallaxautokeyframe",m-e));
a.trigger("parallax.scroll",{currentScroll:m,gapVertical:l,gapHorizontal:h})});var b=u(e);p=a.getData("zmoduleparallaxcurrentsection","");b!=p&&(d.indicator&&(g.find(".zparallax-indicator.active").removeClass("active"),g.find('.zparallax-indicator[data-name="'+b+'"]').addClass("active")),zjs.isMobileDevice()||t(b),a.setData("zmoduleparallaxcurrentsection",b),a.trigger("parallax.changesection",{currentSection:b,prevSection:p}));B=a.getData("zmoduleparallaxfocussection");b!=B&&.9<v(e,b)&&function(){a.getData("zmoduleparallaxcurrentsection")==
b&&a.getData("zmoduleparallaxfocussection")!=b&&(a.setData("zmoduleparallaxfocussection",b),a.trigger("parallax.changefocussection",{focusSection:b}))}.delay(d.timewaittofocus);var c=C(e);r=a.getData("zmoduleparallaxlastfullscreensection","");var x=a.find("."+d.sectionclass+'[data-name="'+c+'"]').item(0);c!=r&&(a.setData("zmoduleparallaxlastfullscreensection",c),a.trigger("parallax.risingsection",{prevSection:h[h.indexOf(c)-1],nextSection:c,percent:1}),a.trigger("parallax.changefullscreensection",
{lastFullScreenSection:c,prevFullScreenSection:r}));var k=h.indexOf(c);k<h.length-1&&a.trigger("parallax.risingsection",{prevSection:c,nextSection:h[k+1],percent:(m-x.top())/x.height()})};c=function(){z=zjs(window).width();A=zjs(window).height();var b=0;zSectionEls.eachElement(function(a){a=zjs(a);var c=a.getData("zmoduleparallaxautoscale");d.autoscaleusecss||"0"==c||0==c||"false"==c||a.width(z).height(A);b+=a.width()});d.horizontal&&(a.width(b),a.getData("zmodulescrollbaroption")&&a.refreshScroll());
w();t(p)};c();a.on("scrollbar.scroll",w);zjs(window).on("scroll",w);zjs(window).on("resize",c);n&&a.refreshScroll();""!=document.location.hash&&function(){k(e,document.location.hash.replace("#",""))}.delay(1E3);a.on("parallax:scroll:stop",function(){t(this.parallaxGetCurrentSection())})}},k=function(e,b){b=b||"";var a=zjs(e),d=a.getData("zmoduleparallaxoption");if(!d)return!1;var c=a.find("."+d.sectionclass+'[data-name="'+b+'"]').item(0);if(1>c.count())return!1;c=c.top();if(a.getData("zmodulescrollbaroption"))return a.scrollTo(c),
!0;if(0<d.scrolltime)return l?l.stop({force:!0}):l=zjs.timer({onProcess:function(a){q=!0;window.scrollTo(d.horizontal?a:0,d.horizontal?0:a)},onStop:function(){a.trigger("parallax:scroll:stop")}}),l.set({from:d.horizontal?zjs(window).scrollLeft():zjs(window).scrollTop(),to:c,time:d.scrolltime,transition:d.transition}).run(),!0;window.scrollTo(d.horizontal?c:0,d.horizontal?0:c)},v=function(e,b){b=b||"";var a=zjs(e),d=a.getData("zmoduleparallaxoption");if(!d)return 0;var c=a.find("."+d.sectionclass+
'[data-name="'+b+'"]').item(0);if(1>c.count())return 0;d=c.top();c=c.height();a=a.getData("zmoduleparallaxcurrentscroll");var g=zjs(window).height();if(0>=g)return 0;d=a>=d?(c-a+d)/g:(a+g-d)/g;0>d&&(d=0);return d},u=function(e){var b=zjs(e).getData("zmoduleparallaxlistsectionname",!1);if(!b||!zjs.isArray(b))return"";for(var a="",d=0,c=0;c<b.length;c++){var g=v(e,b[c]);g>d&&(a=b[c],d=g)}return a},C=function(e){e=zjs(e);var b=e.getData("zmoduleparallaxlistsectionname",!1);if(!b||!zjs.isArray(b))return"";
for(var a=e.getData("zmoduleparallaxoption"),d=e.getData("zmoduleparallaxcurrentscroll",0),c="",g,h=0;h<b.length-1;h++)g=e.find("."+a.sectionclass+'[data-name="'+b[h]+'"]').item(0),1>g.count()||d>=g.top()&&(c=b[h]);return c};zjs.extendMethod({makeParallax:function(e){return this.eachElement(function(b){D(b,e)})},parallaxScrollToSection:function(e){return this.eachElement(function(b){k(b,e)})},parallaxScrollToNextSection:function(){return this.eachElement(function(e){var b=zjs(e).getData("zmoduleparallaxlistsectionname",
!1);if(b||zjs.isArray(b)){var a=u(e);a&&(b=b[b.indexOf(a)+1])&&k(e,b)}})},parallaxGetRatioVisible:function(e){return v(this.item(0,!0),e)},parallaxGetCurrentSection:function(){return u(this.item(0,!0))},parallaxGetLastFullScreenSection:function(){return C(this.item(0,!0))}});zjs.hook({after_setInnerHTML:function(e){zjs(e).find(".zparallax").makeParallax()},after_insertDOM:function(e){zjs(e).hasClass("zparallax")&&zjs(e).makeParallax();zjs(e).find(".zparallax").makeParallax()}});zjs.onready(function(){zjs(".zparallax").makeParallax()});
"required"in zjs&&zjs.required("parallax")});