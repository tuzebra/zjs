(function(e){window.block="block";window.none="none";var v=e.supportTransition&&e.supportTransform,w=function(a,b,e,c){return 100==e?b:a},x=function(a,b,k,c){var d={},f;for(f in b){var g=null;f in a?g=a[f]:f in c&&(g=c[f]);if(null!==g){var h=b[f];e.isString(h)&&(0===h.indexOf("+=")?h=g+h.replace("+=","").toFloat():0===h.indexOf("-=")&&(h=g-h.replace("-=","").toFloat()));d[f]=0===k?g:100===k?h:g+(h-g)/100*k}}return d},p=function(a,b){return"string"==b?a+"":parseFloat(a,10)},t=function(){this.allowrepeat=
!0};t.prototype.preventDefault=function(){this.allowrepeat=!1};var y=RegExp("cubic-bezier\\(([^,]+),([^,]+),([^,]+),([^\\)]+)\\)","gi"),u=function(a){return(a=y.exec(a))?[parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]),parseFloat(a[4])]:!1},l=function(a){this.option=e.extend({element:!1,from:0,to:100,time:1E3,transition:2,onStart:function(a,e){},onProcess:function(a,e,c){},onStop:function(a,e){},onFinish:function(a,e){}},a);this.eventNameHash={webkit:"webkitTransitionEnd",moz:"transitionend",o:"OTransitionEnd",
ms:"msTransitionEnd"}[e.browser.cssprefix.replace(/-/g,"")];this.listener=this.tranendRuned=!1};l.prototype._settranstyle=function(a){if("none"!=a){a="cubic-bezier(0, 0, 1, 1)";switch(this.option.transition){case 1:case "sinoidal":a="cubic-bezier(0,0,.58,1)";break;case 2:case "quadratic":a="cubic-bezier(0,1,.53,1)";break;case 3:case "cubic":a="cubic-bezier(.34,.95,.84,1.39)";break;case 4:case "elastic":a="cubic-bezier(.71,1.61,.5,.82)"}if(e.isString(this.option.transition)){var b=u(this.option.transition);
b&&e.isArray(b)&&4==b.length&&(a="cubic-bezier("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")")}a="all "+this.option.time+"ms "+a}this.option.element.style[e.stylePropertyNames.transition.name]=a;return this};l.prototype.set=function(a){e.extend(this.option,a);return this};l.prototype.unset=function(){return this};l.prototype.run=function(){var a=this;a._settranstyle("none");a.option.onStart.apply(a);a.option.onProcess(a.option.from,a.option.from,a.option.to);(function(){a._settranstyle();a.option.onProcess(a.option.to,
a.option.from,a.option.to)}).delay(15);a.tranendRuned=!1;a.listener=function(b){a.tranendRuned||(a.tranendRuned=!0,this.removeEventListener(a.eventNameHash,arguments.callee,!1),a._settranstyle("none"),a.option.onFinish(a.option.from,a.option.to))};a.option.element.addEventListener(a.eventNameHash,a.listener);return a};l.prototype.stop=function(){this.option.onStop(this.option.from,this.option.to);return this};l.prototype.unbind=function(){this.listener&&this.option.element.removeEventListener(this.eventNameHash,
this.listener);this.listener=!1;return this};var z=function(a,b,e,c,d,f){function g(a,d){var c;var b=a;for(c=0;8>c;c++){var e=((h*b+k)*b+m)*b-a;if((0<=e?e:0-e)<d)return b;var f=(3*h*b+2*k)*b+m;if(1E-6>(0<=f?f:0-f))break;b-=e/f}f=0;c=1;b=a;if(b<f)return f;if(b>c)return c;for(;f<c;){e=((h*b+k)*b+m)*b;var g=e-a;if((0<=g?g:0-g)<d)break;a>e?f=b:c=b;b=.5*(c-f)+f}return b}var h=0,k=0,m=0,l=0,n=0,q=0,m=3*b,k=3*(c-b)-m,h=1-m-k,q=3*e,n=3*(d-e)-q,l=1-q-n;return function(a,b){var c=g(a,b);return((l*c+n)*c+q)*
c}(a,1/(200*f))};e.extendCore({moduleTransition:!0});e.extendMethod({setTransition:function(a){var b={from:{},to:{},keyframes:!1,time:1E3,repeat:!1,reverse:!1,delay:0,delayrepeat:0,delayreverse:0,timingfunction:2,autoplay:!0,fillmode:"backwards",usecss:!0,onStart:function(a){},onFinish:function(a){},onFinishreverse:function(a){}};return this.each(function(k){var c=e(k),d=c.getData("zjsmoduletransitionoption"),f=c.getData("zjsmoduletransitiontimer");if(d||f)c.setData("zjsmoduletransitionoption",e.extend(d,
a));else{var d=e.clone(b),g=c.getData("zjsmoduletransitioninlinedataoption","");""==g&&(g=c.getAttr("data-option",""),c.setData("zjsmoduletransitioninlinedataoption",g));e.isString(g)&&""!=g.trim()&&(d=e.extend(d,g.jsonDecode()));c.removeAttr("data-option");"undefined"!=typeof a&&(d=e.extend(d,a));0==d.fillmode&&(d.fillmode="none");d.keyframes&&e.isObject(d.keyframes)&&(d.usecss=!1);var g=e.objectKeys(b),h;for(h in d)g.include(h)||(d.to[h]=d[h]);g=e.objectKeys(d.from).concat(e.objectKeys(d.to)).unique();
if(g.include("scrollLeft")||g.include("scrollTop"))d.usecss=!1,(k===document.body||k===window?e(window):c).on("mousewheel",function(){c.stopTransition()});c.setData("zjsmoduletransitionoption",d);d.repeat||d.reverse||c.setAttr("data-ztransallowreverse",!0);c.setData("ztransp",0);var r=new t,m=0,p=function(){var a=c.getData("zjsmoduletransitiontimer");a&&(d.reverse&&0==m?("function"==typeof d.onFinishreverse&&(d.onFinishreverse(),d=c.getData("zjsmoduletransitionoption")),m=1,function(){var a=c.getData("zjsmoduletransitiontimer");
a&&a.set({from:100,to:0}).run()}.delay(d.delayreverse)):(d.reverse&&1==m&&(m=0,a.set({from:0,to:100})),"function"==typeof d.onFinish&&(r.allowrepeat=!0,d.onFinish(r),d=c.getData("zjsmoduletransitionoption")),c.trigger("transition.finish",d),d.repeat&&r.allowrepeat&&function(){var a=c.getData("zjsmoduletransitiontimer");a&&a.run()}.delay(d.delayrepeat)))},n,f=function(a){if(d.usecss&&v)return c.data("zjsmoduletransitioncalculatefn",w),new l(a);if("transition"in a&&e.isString(a.transition)){var b=u(a.transition);
b&&e.isArray(b)&&4==b.length&&(a.transition=function(){var c=parseFloat(b[0]),d=parseFloat(b[1]),e=parseFloat(b[2]),f=parseFloat(b[3]),g=a.time;return function(a){return z(a,c,d,e,f,g)}}())}d.keyframes?c.setKeyframes("_zjsmoduletransition",d.keyframes):c.data("zjsmoduletransitioncalculatefn",x);return e.timer(a)}({element:c.item(0,!0),from:0,to:100,time:d.time,transition:d.timingfunction,onStart:function(a,b){if(0==m&&"function"==typeof d.onStart)d.onStart();d=c.getData("zjsmoduletransitionoption");
f instanceof l||(n=c.getStyle(e.objectKeys(d.from).concat(e.objectKeys(d.to)).unique()))},onProcess:function(a,b,e){c.isExistsKeyframes("_zjsmoduletransition")?c.setStyleByKeyframes("_zjsmoduletransition",a):(b=c.data("zjsmoduletransitioncalculatefn").call(this,d.from,d.to,a,n),c.setStyle(b).setData("ztransp",a))},onStop:function(a,b){c.setData("ztransp",-1)},onFinish:function(a,b){c.isExistsKeyframes("_zjsmoduletransition")?c.setStyleByKeyframes("_zjsmoduletransition",b):c.setStyle(c.data("zjsmoduletransitioncalculatefn").call(this,
d.from,d.to,b,n)).setData("ztransp",-1);p()}});c.setData("zjsmoduletransitiontimer",f);c.setStyle(d.from);d.autoplay&&function(){f.run()}.delay(d.delay)}})},unsetTransition:function(){return this.each(function(a){a=e(a);var b=a.getData("zjsmoduletransitiontimer");b&&(b instanceof l&&b.unbind(),b.stop(),b.unset(),a.delData("zjsmoduletransitiontimer"),a.delData("zjsmoduletransitionoption"),a.setAttr("data-ztransid",-1))})},playTransition:function(a){if(3==arguments.length){var b=arguments[2];e.isNumeric(b)&&
(b={time:b});b.to={};b.to[arguments[0]]=arguments[1];return this.playTransition(b)}if(2==arguments.length){b=arguments[0];if(e.isString(b))return b={},b[arguments[0]]=arguments[1],this.playTransition({to:b});b=arguments[1];e.isNumeric(b)&&(b={time:b});b.to=arguments[0];return this.playTransition(b)}return this.each(function(b){var c=e(b);if("undefined"!=typeof a)c.unsetTransition(),c.setTransition(e.extend(a,{autoplay:!0}));else if(b=c.getData("zjsmoduletransitiontimer"))b.stop(),c.getAttr("data-ztransallowreverse",
!1)&&(c=c.getData("ztransp",0).toInt(),-1==c&&(c=0),b.set({from:c,to:100})),b instanceof l&&b.unbind(),b.run()})},stopTransition:function(){return this.each(function(a){(a=e(a).getData("zjsmoduletransitiontimer"))&&a.stop()})},reverseTransition:function(){return this.each(function(a){var b=e(a);(a=b.getData("zjsmoduletransitiontimer"))&&b.getAttr("data-ztransallowreverse",!1)&&(a instanceof l?a.stop().set({from:100,to:0}).run():(b=b.getData("ztransp",0).toInt(),-1==b&&(b=100),a.stop().set({from:b,
to:0}).run()))})},setKeyframes:function(a,b){return this.each(function(k){k=e(k);var c=!1;e.isObject(b)&&(c=b);e.isString(b)&&""!=b.trim()&&(c=b.jsonDecode());if(e.isObject(c)){var d={},f;for(f in c)for(var g in c[f]){var h="string";"content"==g?h="string":e.isNumeric(c[f][g])?h="numeric":e.isString(c[f][g])&&e.isNumeric(c[f][g].toFloat())&&(h="px",0<=c[f][g].indexOf("%")&&(h="%"),0<=c[f][g].indexOf("deg")&&(h="deg"));d[g]={unit:h,points:[0],values:[]}}for(f in d)for(g in h="0"in c&&f in c["0"]?c["0"][f]:
k.getStyle(f),d[f].values.push(p(h,d[f].unit)),c)0==g||"0"==g||!f in c[g]||"undefined"==typeof c[g][f]||(d[f].points.push(parseFloat(g,10)),d[f].values.push(p(c[g][f],d[f].unit)));k.setData("zjsmoduletransitionkeyframeprefix"+a,d)}})},setStyleByKeyframes:function(a,b){return this.each(function(k){k=e(k);var c=k.getData("fabricObj",!1);if("false"!=k.getAttr("data-allow-keyframes","true")){var d=k.getData("zjsmoduletransitionkeyframeprefix"+a,!1);if(d&&e.isObject(d))for(var f in d){for(var g=0;g<d[f].points.length&&
!(b<=d[f].points[g]);g++);0==g&&(g=1);var h=d[f].values[g-1];g<d[f].points.length&&"string"!=d[f].unit&&(h+=(b-d[f].points[g-1])/(d[f].points[g]-d[f].points[g-1])*(d[f].values[g]-d[f].values[g-1]));"%"==d[f].unit&&(h+="%");"backgroundImage"!=f&&"content"!=f||!e.isString(h)||(h=h.format({zjsInteger:k.getStyle("zjs-integer"),zjsString:k.getStyle("zjs-string")}));c&&window.applyStyleToFabric?window.applyStyleToFabric(c,f,h):k.setStyle(f,h)}}})},getStyleTransition:function(a){var b=this.item(0).getData("fabricObj",
!1);return b&&window.getStyleFromFabric?window.getStyleFromFabric(b,a):this.getStyle(a)},isExistsKeyframes:function(a){return 0!=this.item(0).getData("zjsmoduletransitionkeyframeprefix"+a,!1)}});e(function(){e(".ztransition").setTransition()});"required"in e&&e.required("transition")})(zjs);