(function(g){window.block="block";window.none="none";var w=g.supportTransition&&g.supportTransform,x=function(a,b,e,d){return 100==e?b:a},y=function(a,b,e,d){var c={},f;for(f in b){var h=null,k;f in a?h=a[f]:f in d&&(h=d[f]);null!==h&&(k=b[f],g.isString(k)&&(0===k.indexOf("+=")?k=h+k.replace("+=","").toFloat():0===k.indexOf("-=")&&(k=h-k.replace("-=","").toFloat())),c[f]=0===e?h:100===e?k:h+(k-h)/100*e)}return c},t=function(a,b){return"string"==b?a+"":parseFloat(a,10)},u=function(){this.allowrepeat=
!0};u.prototype.preventDefault=function(){this.allowrepeat=!1};var z=RegExp("cubic-bezier\\(([^,]+),([^,]+),([^,]+),([^\\)]+)\\)","gi"),v=function(a){return(a=z.exec(a))?[parseFloat(a[1]),parseFloat(a[2]),parseFloat(a[3]),parseFloat(a[4])]:!1},l=function(a){this.option=g.extend({element:!1,from:0,to:100,time:1E3,transition:2,onStart:function(a,e){},onProcess:function(a,e,d){},onStop:function(a,e){},onFinish:function(a,e){}},a);this.eventNameHash={webkit:"webkitTransitionEnd",moz:"transitionend",o:"OTransitionEnd",
ms:"msTransitionEnd"}[g.browser.cssprefix.replace(/-/g,"")];this.listener=this.tranendRuned=!1};l.prototype._settranstyle=function(a){if("none"!=a){a="cubic-bezier(0, 0, 1, 1)";switch(this.option.transition){case 1:case "sinoidal":a="cubic-bezier(0,0,.58,1)";break;case 2:case "quadratic":a="cubic-bezier(0,1,.53,1)";break;case 3:case "cubic":a="cubic-bezier(.34,.95,.84,1.39)";break;case 4:case "elastic":a="cubic-bezier(.71,1.61,.5,.82)"}if(g.isString(this.option.transition)){var b=v(this.option.transition);
b&&g.isArray(b)&&4==b.length&&(a="cubic-bezier("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")")}a="all "+this.option.time+"ms "+a}this.option.element.style[g.stylePropertyNames.transition.name]=a;return this};l.prototype.set=function(a){g.extend(this.option,a);return this};l.prototype.unset=function(){return this};l.prototype.run=function(){var a=this;a._settranstyle("none");a.option.onStart.apply(a);a.option.onProcess(a.option.from,a.option.from,a.option.to);(function(){a._settranstyle();a.option.onProcess(a.option.to,
a.option.from,a.option.to)}).delay(15);a.tranendRuned=!1;a.listener=function(b){a.tranendRuned||(a.tranendRuned=!0,this.removeEventListener(a.eventNameHash,arguments.callee,!1),a._settranstyle("none"),a.option.onFinish(a.option.from,a.option.to))};a.option.element.addEventListener(a.eventNameHash,a.listener);return a};l.prototype.stop=function(){this.option.onStop(this.option.from,this.option.to);return this};l.prototype.unbind=function(){this.listener&&this.option.element.removeEventListener(this.eventNameHash,
this.listener);this.listener=!1;return this};var A=function(a,b,e,d,c,f){function g(a,c){var d,b,e,f;e=a;for(b=0;8>b;b++){f=((k*e+l)*e+m)*e-a;if((0<=f?f:0-f)<c)return e;d=(3*k*e+2*l)*e+m;if(1E-6>(0<=d?d:0-d))break;e-=f/d}d=0;b=1;e=a;if(e<d)return d;if(e>b)return b;for(;d<b;){f=((k*e+l)*e+m)*e;var h=f-a;if((0<=h?h:0-h)<c)break;a>f?d=e:b=e;e=.5*(b-d)+d}return e}var k=0,l=0,m=0,n=0,r=0,q=0,m=3*b,l=3*(d-b)-m,k=1-m-l,q=3*e,r=3*(c-e)-q,n=1-q-r;return function(a,d){var c=g(a,d);return((n*c+r)*c+q)*c}(a,
1/(200*f))};g.extendCore({moduleTransition:!0});g.extendMethod({setTransition:function(a){var b={from:{},to:{},keyframes:!1,time:1E3,repeat:!1,reverse:!1,delay:0,delayrepeat:0,delayreverse:0,timingfunction:2,autoplay:!0,fillmode:"backwards",usecss:!0,onStart:function(a){},onFinish:function(a){},onFinishreverse:function(a){}};return this.each(function(e){var d=g(e),c=d.getData("zjsmoduletransitionoption"),f=d.getData("zjsmoduletransitiontimer");if(c||f)d.setData("zjsmoduletransitionoption",g.extend(c,
a));else{c=g.clone(b);e=d.getData("zjsmoduletransitioninlinedataoption","");""==e&&(e=d.getAttr("data-option",""),d.setData("zjsmoduletransitioninlinedataoption",e));g.isString(e)&&""!=e.trim()&&(c=g.extend(c,e.jsonDecode()));d.removeAttr("data-option");"undefined"!=typeof a&&(c=g.extend(c,a));0==c.fillmode&&(c.fillmode="none");c.keyframes&&g.isObject(c.keyframes)&&(c.usecss=!1);e=g.objectKeys(b);for(var h in c)e.include(h)||(c.to[h]=c[h]);e=g.objectKeys(c.from).concat(g.objectKeys(c.to)).unique();
if(e.include("scrollLeft")||e.include("scrollTop"))c.usecss=!1;d.setData("zjsmoduletransitionoption",c);c.repeat||c.reverse||d.setAttr("data-ztransallowreverse",!0);d.setData("ztransp",0);var k=new u,p=0,m=function(){var a=d.getData("zjsmoduletransitiontimer");a&&(c.reverse&&0==p?("function"==typeof c.onFinishreverse&&(c.onFinishreverse(),c=d.getData("zjsmoduletransitionoption")),p=1,function(){var a=d.getData("zjsmoduletransitiontimer");a&&a.set({from:100,to:0}).run()}.delay(c.delayreverse)):(c.reverse&&
1==p&&(p=0,a.set({from:0,to:100})),"function"==typeof c.onFinish&&(k.allowrepeat=!0,c.onFinish(k),c=d.getData("zjsmoduletransitionoption")),d.trigger("transition.finish",c),c.repeat&&k.allowrepeat&&function(){var a=d.getData("zjsmoduletransitiontimer");a&&a.run()}.delay(c.delayrepeat)))},n,f=function(a){if(c.usecss&&w)return d.data("zjsmoduletransitioncalculatefn",x),new l(a);if("transition"in a&&g.isString(a.transition)){var b=v(a.transition);b&&g.isArray(b)&&4==b.length&&(a.transition=function(){var d=
parseFloat(b[0]),c=parseFloat(b[1]),e=parseFloat(b[2]),f=parseFloat(b[3]),g=a.time;return function(a){return A(a,d,c,e,f,g)}}())}c.keyframes?d.setKeyframes("_zjsmoduletransition",c.keyframes):d.data("zjsmoduletransitioncalculatefn",y);return g.timer(a)}({element:d.item(0,!0),from:0,to:100,time:c.time,transition:c.timingfunction,onStart:function(a,b){if(0==p&&"function"==typeof c.onStart)c.onStart();c=d.getData("zjsmoduletransitionoption");f instanceof l||(n=d.getStyle(g.objectKeys(c.from).concat(g.objectKeys(c.to)).unique()))},
onProcess:function(a,b,e){d.isExistsKeyframes("_zjsmoduletransition")?d.setStyleByKeyframes("_zjsmoduletransition",a):(b=d.data("zjsmoduletransitioncalculatefn").call(this,c.from,c.to,a,n),d.setStyle(b).setData("ztransp",a))},onStop:function(a,c){d.setData("ztransp",-1)},onFinish:function(a,b){d.isExistsKeyframes("_zjsmoduletransition")?d.setStyleByKeyframes("_zjsmoduletransition",b):d.setStyle(d.data("zjsmoduletransitioncalculatefn").call(this,c.from,c.to,b,n)).setData("ztransp",-1);m()}});d.setData("zjsmoduletransitiontimer",
f);d.setStyle(c.from);c.autoplay&&function(){f.run()}.delay(c.delay)}})},unsetTransition:function(){return this.each(function(a){a=g(a);var b=a.getData("zjsmoduletransitiontimer");b&&(b instanceof l&&b.unbind(),b.stop(),b.unset(),a.delData("zjsmoduletransitiontimer"),a.delData("zjsmoduletransitionoption"),a.setAttr("data-ztransid",-1))})},playTransition:function(a){if(3==arguments.length){var b=arguments[2];g.isNumeric(b)&&(b={time:b});b.to={};b.to[arguments[0]]=arguments[1];return this.playTransition(b)}if(2==
arguments.length){b=arguments[0];if(g.isString(b))return b={},b[arguments[0]]=arguments[1],this.playTransition({to:b});b=arguments[1];g.isNumeric(b)&&(b={time:b});b.to=arguments[0];return this.playTransition(b)}return this.each(function(b){var d=g(b);if("undefined"!=typeof a)d.unsetTransition(),d.setTransition(g.extend(a,{autoplay:!0}));else if(b=d.getData("zjsmoduletransitiontimer"))b.stop(),d.getAttr("data-ztransallowreverse",!1)&&(d=d.getData("ztransp",0).toInt(),-1==d&&(d=0),b.set({from:d,to:100})),
b instanceof l&&b.unbind(),b.run()})},stopTransition:function(){return this.each(function(a){(a=g(a).getData("zjsmoduletransitiontimer"))&&a.stop()})},reverseTransition:function(){return this.each(function(a){var b=g(a);(a=b.getData("zjsmoduletransitiontimer"))&&b.getAttr("data-ztransallowreverse",!1)&&(a instanceof l?a.stop().set({from:100,to:0}).run():(b=b.getData("ztransp",0).toInt(),-1==b&&(b=100),a.stop().set({from:b,to:0}).run()))})},setKeyframes:function(a,b){return this.each(function(e){e=
g(e);var d=!1;g.isObject(b)&&(d=b);g.isString(b)&&""!=b.trim()&&(d=b.jsonDecode());if(g.isObject(d)){var c={},f;for(f in d)for(var h in d[f]){var k="string";"content"==h?k="string":g.isNumeric(d[f][h])?k="numeric":g.isString(d[f][h])&&g.isNumeric(d[f][h].toFloat())&&(k="px",0<=d[f][h].indexOf("%")&&(k="%"),0<=d[f][h].indexOf("deg")&&(k="deg"));c[h]={unit:k,points:[0],values:[]}}for(f in c)for(h in k="0"in d&&f in d["0"]?d["0"][f]:e.getStyle(f),c[f].values.push(t(k,c[f].unit)),d)0==h||"0"==h||!f in
d[h]||"undefined"==typeof d[h][f]||(c[f].points.push(parseFloat(h,10)),c[f].values.push(t(d[h][f],c[f].unit)));e.setData("zjsmoduletransitionkeyframeprefix"+a,c)}})},setStyleByKeyframes:function(a,b){return this.each(function(e){e=g(e);var d=e.getData("fabricObj",!1);if("false"!=e.getAttr("data-allow-keyframes","true")){var c=e.getData("zjsmoduletransitionkeyframeprefix"+a,!1);if(c&&g.isObject(c))for(var f in c){for(var h=0;h<c[f].points.length&&!(b<=c[f].points[h]);h++);0==h&&(h=1);var k=c[f].values[h-
1];h<c[f].points.length&&"string"!=c[f].unit&&(k+=(b-c[f].points[h-1])/(c[f].points[h]-c[f].points[h-1])*(c[f].values[h]-c[f].values[h-1]));"%"==c[f].unit&&(k+="%");"backgroundImage"!=f&&"content"!=f||!g.isString(k)||(k=k.format({zjsInteger:e.getStyle("zjs-integer"),zjsString:e.getStyle("zjs-string")}));d&&window.applyStyleToFabric?window.applyStyleToFabric(d,f,k):e.setStyle(f,k)}}})},getStyleTransition:function(a){var b=this.item(0).getData("fabricObj",!1);return b&&window.getStyleFromFabric?window.getStyleFromFabric(b,
a):this.getStyle(a)},isExistsKeyframes:function(a){return 0!=this.item(0).getData("zjsmoduletransitionkeyframeprefix"+a,!1)}});g(function(){g(".ztransition").setTransition()});"required"in g&&g.required("transition")})(zjs);