(function(t){var e="zjsmoduletransitionoption",n="zjsmoduletransitiontimer",i="zjsmoduletransitioninlinedataoption",r="zjsmoduletransitioncalculatefn",o="zjsmoduletransitionkeyframeprefix",a="_zjsmoduletransition";window.block="block",window.none="none";var s=t.supportTransition&&t.supportTransform,u=function(t,e,n,i){return 100==n?e:t},c=function(e,n,i,r){var o={};for(var a in n){var s=null,u=null;if(a in e?s=e[a]:a in r&&(s=r[a]),null!==s)u=n[a],t.isString(u)&&(0===u.indexOf("+=")?u=s+u.replace("+=","").toFloat():0===u.indexOf("-=")&&(u=s-u.replace("-=","").toFloat())),o[a]=0===i?s:100===i?u:s+(u-s)/100*i}return o},f=function(t,e){return"string"==e?t+"":parseFloat(t,10)},l=function(){this.allowrepeat=!0};l.prototype.preventDefault=function(){this.allowrepeat=!1};var p=new RegExp("cubic-bezier\\(([^,]+),([^,]+),([^,]+),([^\\)]+)\\)","gi"),d=function(t){var e=p.exec(t);return!!e&&[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])]},m=function(e){this.option=t.extend({element:!1,from:0,to:100,time:1e3,transition:2,onStart:function(t,e){},onProcess:function(t,e,n){},onStop:function(t,e){},onFinish:function(t,e){}},e);var n=t.browser.cssprefix.replace(/-/g,""),i={webkit:"webkitTransitionEnd",moz:"transitionend",o:"OTransitionEnd",ms:"msTransitionEnd"};this.eventNameHash=i[n],this.tranendRuned=!1,this.listener=!1};m.prototype._settranstyle=function(e){if("none"!=e){var n="cubic-bezier(0, 0, 1, 1)";switch(this.option.transition){case 1:case"sinoidal":n="cubic-bezier(0,0,.58,1)";break;case 2:case"quadratic":n="cubic-bezier(0,1,.53,1)";break;case 3:case"cubic":n="cubic-bezier(.34,.95,.84,1.39)";break;case 4:case"elastic":n="cubic-bezier(.71,1.61,.5,.82)"}if(t.isString(this.option.transition)){var i=d(this.option.transition);i&&t.isArray(i)&&4==i.length&&(n="cubic-bezier("+i[0]+", "+i[1]+", "+i[2]+", "+i[3]+")")}e="all "+this.option.time+"ms "+n}return this.option.element.style[t.stylePropertyNames.transition.name]=e,this},m.prototype.set=function(e){return t.extend(this.option,e),this},m.prototype.unset=function(){return this},m.prototype.run=function(){var t=this;return t._settranstyle("none"),t.option.onStart.apply(t),t.option.onProcess(t.option.from,t.option.from,t.option.to),function(){t._settranstyle(),t.option.onProcess(t.option.to,t.option.from,t.option.to)}.delay(15),t.tranendRuned=!1,t.listener=function(e){t.tranendRuned||(t.tranendRuned=!0,this.removeEventListener(t.eventNameHash,arguments.callee,!1),t._settranstyle("none"),t.option.onFinish(t.option.from,t.option.to))},t.option.element.addEventListener(t.eventNameHash,t.listener),t},m.prototype.stop=function(){return this.option.onStop(this.option.from,this.option.to),this},m.prototype.unbind=function(){return this.listener&&this.option.element.removeEventListener(this.eventNameHash,this.listener),this.listener=!1,this};var v=function(t,e,n,i,r,o){function a(t){return((p*t+d)*t+m)*t}function s(t){return((v*t+y)*t+h)*t}function u(t){return(3*p*t+2*d)*t+m}function c(t){return 1/(200*t)}function f(t,e){return s(l(t,e))}function l(t,e){function n(t){return t>=0?t:0-t}var i,r,o,s,c,f;for(o=t,f=0;f<8;f++){if(s=a(o)-t,n(s)<e)return o;if(c=u(o),n(c)<1e-6)break;o-=s/c}if(i=0,r=1,o=t,o<i)return i;if(o>r)return r;for(;i<r;){if(s=a(o),n(s-t)<e)return o;t>s?i=o:r=o,o=.5*(r-i)+i}return o}var p=0,d=0,m=0,v=0,y=0,h=0;return m=3*e,d=3*(i-e)-m,p=1-m-d,h=3*n,y=3*(r-n)-h,v=1-h-y,f(t,c(o))};t.extendCore({moduleTransition:!0}),t.extendMethod({setTransition:function(o){var f={from:{},to:{},keyframes:!1,time:1e3,repeat:!1,reverse:!1,delay:0,delayrepeat:0,delayreverse:0,timingfunction:2,autoplay:!0,fillmode:"backwards",usecss:!0,onStart:function(t){},onFinish:function(t){},onFinishreverse:function(t){}};return this.each(function(p){var y=t(p),h=y.getData(e),g=y.getData(n);if(h||g)y.setData(e,t.extend(h,o));else{h=t.clone(f);var b=y.getData(i,"");""==b&&(b=y.getAttr("data-option",""),y.setData(i,b)),t.isString(b)&&""!=b.trim()&&(h=t.extend(h,b.jsonDecode())),y.removeAttr("data-option"),void 0!==o&&(h=t.extend(h,o)),0==h.fillmode&&(h.fillmode="none"),h.keyframes&&t.isObject(h.keyframes)&&(h.usecss=!1);var S=t.objectKeys(f);for(var w in h)S.include(w)||(h.to[w]=h[w]);S=t.objectKeys(h.from).concat(t.objectKeys(h.to)).unique(),(S.include("scrollLeft")||S.include("scrollTop"))&&(h.usecss=!1,(p===document.body||p===window?t(window):y).on("mousewheel",function(){y.stopTransition()},{passive:!0})),y.setData(e,h),h.repeat||h.reverse||y.setAttr("data-ztransallowreverse",!0),y.setData("ztransp",0);var D,z=new l,F=0,j=function(){var t=y.getData(n);if(t){if(h.reverse&&0==F)return"function"==typeof h.onFinishreverse&&(h.onFinishreverse(),h=y.getData(e)),F=1,void function(){var t=y.getData(n);t&&t.set({from:100,to:0}).run()}.delay(h.delayreverse);h.reverse&&1==F&&(F=0,t.set({from:0,to:100})),"function"==typeof h.onFinish&&(z.allowrepeat=!0,h.onFinish(z),h=y.getData(e)),y.trigger("transition.finish",h),h.repeat&&z.allowrepeat&&function(){var t=y.getData(n);t&&t.run()}.delay(h.delayrepeat)}},T=function(e){if(h.usecss&&s)return y.data(r,u),new m(e);if("transition"in e&&t.isString(e.transition)){var n=d(e.transition);n&&t.isArray(n)&&4==n.length&&(e.transition=(i=parseFloat(n[0]),o=parseFloat(n[1]),f=parseFloat(n[2]),l=parseFloat(n[3]),p=e.time,function(t){return v(t,i,o,f,l,p)}))}var i,o,f,l,p;return h.keyframes?y.setKeyframes(a,h.keyframes):y.data(r,c),t.timer(e)};g=T({element:y.item(0,!0),from:0,to:100,time:h.time,transition:h.timingfunction,onStart:function(n,i){0==F&&"function"==typeof h.onStart&&h.onStart(),h=y.getData(e),g instanceof m||(D=y.getStyle(t.objectKeys(h.from).concat(t.objectKeys(h.to)).unique()))},onProcess:function(t,e,n){if(y.isExistsKeyframes(a))y.setStyleByKeyframes(a,t);else{var i=y.data(r).call(this,h.from,h.to,t,D);y.setStyle(i).setData("ztransp",t)}},onStop:function(t,e){y.setData("ztransp",-1)},onFinish:function(t,e){y.isExistsKeyframes(a)?y.setStyleByKeyframes(a,e):y.setStyle(y.data(r).call(this,h.from,h.to,e,D)).setData("ztransp",-1),j()}}),y.setData(n,g),y.setStyle(h.from),h.autoplay&&function(){g.run()}.delay(h.delay)}})},unsetTransition:function(){return this.each(function(i){var r=t(i),o=r.getData(n);o&&(o instanceof m&&o.unbind(),o.stop(),o.unset(),r.delData(n),r.delData(e),r.setAttr("data-ztransid",-1))})},playTransition:function(e){if(3==arguments.length){var i=arguments[2];return t.isNumeric(i)&&(i={time:i}),i.to={},i.to[arguments[0]]=arguments[1],this.playTransition(i)}if(2==arguments.length){var r=arguments[0];if(t.isString(r))return r={},r[arguments[0]]=arguments[1],this.playTransition({to:r});i=arguments[1];return t.isNumeric(i)&&(i={time:i}),i.to=arguments[0],this.playTransition(i)}return this.each(function(i){var r=t(i);if(void 0!==e)return r.unsetTransition(),void r.setTransition(t.extend(e,{autoplay:!0}));var o=r.getData(n);if(o){if(o.stop(),r.getAttr("data-ztransallowreverse",!1)){var a=r.getData("ztransp",0).toInt();-1==a&&(a=0),o.set({from:a,to:100})}o instanceof m&&o.unbind(),o.run()}})},stopTransition:function(){return this.each(function(e){var i=t(e),r=i.getData(n);r&&r.stop()})},reverseTransition:function(){return this.each(function(e){var i=t(e),r=i.getData(n);if(r&&i.getAttr("data-ztransallowreverse",!1))if(r instanceof m)r.stop().set({from:100,to:0}).run();else{var o=i.getData("ztransp",0).toInt();-1==o&&(o=100),r.stop().set({from:o,to:0}).run()}})},setKeyframes:function(e,n){return this.each(function(i){var r=t(i),a=!1;if(t.isObject(n)&&(a=n),t.isString(n)&&""!=n.trim()&&(a=n.jsonDecode()),t.isObject(a)){var s={};for(var u in a)for(var c in a[u]){var l="string";"content"==c?l="string":t.isNumeric(a[u][c])?l="numeric":t.isString(a[u][c])&&t.isNumeric(a[u][c].toFloat())&&(l="px",a[u][c].indexOf("%")>=0&&(l="%"),a[u][c].indexOf("deg")>=0&&(l="deg")),s[c]={unit:l,points:[0],values:[]}}for(u in s){var p=null;for(c in p="0"in a&&u in a[0]?a[0][u]:r.getStyle(u),s[u].values.push(f(p,s[u].unit)),a)0!=c&&"0"!=c&&(!u in a[c]||void 0===a[c][u]||(s[u].points.push(parseFloat(c,10)),s[u].values.push(f(a[c][u],s[u].unit))))}r.setData(o+e,s)}})},setStyleByKeyframes:function(e,n){return this.each(function(i){var r=t(i),a=r.getData("fabricObj",!1);if("false"!=r.getAttr("data-allow-keyframes","true")){var s=r.getData(o+e,!1);if(s&&t.isObject(s))for(var u in s){for(var c=0;c<s[u].points.length&&!(n<=s[u].points[c]);c++);0==c&&(c=1);var f=s[u].values[c-1];if(c<s[u].points.length&&"string"!=s[u].unit){var l=n-s[u].points[c-1],p=l/(s[u].points[c]-s[u].points[c-1]);f+=(s[u].values[c]-s[u].values[c-1])*p}"%"==s[u].unit&&(f+="%"),"backgroundImage"!=u&&"content"!=u||!t.isString(f)||(f=f.format({zjsInteger:r.getStyle("zjs-integer"),zjsString:r.getStyle("zjs-string")})),a&&window.applyStyleToFabric?window.applyStyleToFabric(a,u,f):r.setStyle(u,f)}}})},getStyleTransition:function(t){var e=this.item(0),n=e.getData("fabricObj",!1);return n&&window.getStyleFromFabric?window.getStyleFromFabric(n,t):this.getStyle(t)},isExistsKeyframes:function(t){return 0!=this.item(0).getData(o+t,!1)}}),t(function(){t(".ztransition").setTransition()}),"required"in t&&t.required("transition")})(zjs);