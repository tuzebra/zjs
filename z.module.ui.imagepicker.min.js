zjs.require("ui.button.file",function(){zjs.extendCore({moduleUiImagepickerOption:{imageUrl:"",autouploadUrl:"",renderMethod:"background",maxFileSize:10485760,allowFileExt:"",notallowFileExt:"php,exe,asp",uploadingText:"",dropText:""}});var k=function(e,f){var b=zjs(e),a=b.getData("zjsmoduleimagepickeroption");if(a)b.setData("zjsmoduleimagepickeroption",zjs.extend(a,f));else{var a=zjs.clone(zjs.moduleUiImagepickerOption),d=b.getAttr("data-option","");zjs.isString(d)&&""!=d.trim()&&(a=zjs.extend(a,
d.jsonDecode()));b.removeAttr("data-option");"undefined"!=typeof f&&(a=zjs.extend(a,f));""==a.dropText&&(a.dropText="Drop here to upload");b.setData("zjsmoduleimagepickeroption",a);var c=zjs('<div class="zui-imagepicker-wrap inputtext"><div class="zui-imagepicker-image-wrap"></div><div class="zui-imagepicker-button-wrap"><a class="red btndelete">Delete</a><a class="btnupload">Upload</a></div></div>');b.setData("zjsmoduleimagepickerwrapel",c);c.insertAfter(b);"img"!=a.renderMethod&&"image"!=a.renderMethod||
c.addClass("render-by-img");"hidden"!=b.getAttr("type","")&&b.setAttr("type","hidden");var d=c.find(".btndelete"),h=c.find(".btnupload");c.find(".zui-autosuggestion-inputwrap");c.find(".zui-autosuggestion-placeholder");c.find(".zui-autosuggestion-input");c.find(".zui-autosuggestion-panel-wrap");c.find(".zui-autosuggestion-panel-scroll");c.find(".zui-autosuggestion-panel-content");d.makeButton();h.makeButtonFile({multiple:!1,autouploadUrl:a.autouploadUrl,maxFileSize:a.maxFileSize,allowFileExt:a.allowFileExt,
notallowFileExt:a.notallowFileExt,uploadingText:a.uploadingText,dropText:a.dropText});h.on("ui.button.file.wrongfileext",function(a){b.trigger("ui.imagepicker.wrongfileext",a.data)}).on("ui.button.file.maxfilesize",function(a){b.trigger("ui.imagepicker.maxfilesize",a.data)}).on("ui.button.file.upload.complete",function(a,e){if(a.data.response.success){var d=!1;"files"in a.data.response?d=a.data.response.files:"images"in a.data.response?d=a.data.response.images:"items"in a.data.response&&(d=a.data.response.items);
zjs.isArray(d)&&(d.each(function(a){g(a.url);b.setValue(a.id);c.addClass("hadimage")}),"moduleFormValidationOption"in zjs&&zjs.isObject(zjs.moduleFormValidationOption)&&this.findUp("form").formValidationCheck())}});d.click(function(){g("");b.setValue(0);c.removeClass("hadimage")});var g=function(b){""==b?c.find(".zui-imagepicker-image-wrap").html(""):"background"==a.renderMethod?c.find(".zui-imagepicker-image-wrap").html('<div class="zui-imagepicker-image" style="background-image:url('+b+');"></div>'):
"image"!=a.renderMethod&&"img"!=a.renderMethod||c.find(".zui-imagepicker-image-wrap").html('<img class="zui-imagepicker-image" src="'+b+'" />')};""!=a.imageUrl&&(g(a.imageUrl),c.addClass("hadimage"))}};zjs.extendMethod({makeImagepicker:function(e){return this.each(function(f){k(f,e)})}});zjs.hook({after_setInnerHTML:function(e){zjs(e).find(".zimagepicker").makeImagepicker()},after_insertDOM:function(e){zjs(e).hasClass("zimagepicker")&&zjs(e).makeImagepicker();zjs(e).find("zimagepicker").makeImagepicker()}});
zjs(function(){zjs(".zimagepicker").makeImagepicker()});"required"in zjs&&zjs.required("ui.imagepicker")});