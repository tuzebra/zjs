zjs.require("ui",function(){zjs.extendCore({moduleUiHovercardOption:{timeBeforeShow:0,timeBeforeHide:200,attribute:"title",horizontal:"left",vertical:"top",autoFixPosition:!0,autoFixArrowPosition:!0,hideWhenHoverCard:!1,customCssClass:"",left:"auto",right:"auto",top:"auto",bottom:"auto",appendToBody:!1,ajaxContent:!1,ajaxContentDataStructure:"",ajaxLoadingHtml:'<div class="loading-icon"></div>',customContentElement:!1}});var v=[],x=function(a,c){var b=zjs(a),d=b.getData("zmoduleuihovercardoption");
if(d)b.setData("zmoduleuihovercardoption",zjs.extend(d,c));else{var d=zjs.clone(zjs.moduleUiHovercardOption),f=b.getAttr("data-option","");zjs.isString(f)&&""!=f.trim()&&(d=zjs.extend(d,f.jsonDecode()));b.removeAttr("data-option");"undefined"!=typeof c&&(d=zjs.extend(d,c));b.setData("zmoduleuihovercardoption",d);b.addClass("zui-hovercard");var e=!1;if(zjs.isString(d.customContentElement))f=zjs(d.customContentElement),e=!0;else{f=zjs('<div class="zui-hovercard-panel-wrap zui-uiuninithide"><div class="zui-hovercard-panel-arrow"></div><div class="zui-hovercard-panel"><div class="zui-hovercard-panel-inner"></div></div></div>');
if(d.appendToBody){var g=zjs(document.body).getStyle("position");""!=g&&"static"!=g||zjs(document.body).setStyle("position","relative");f.appendTo(top.document.body).setStyle("z-index",10)}else f.insertAfter(b);""!=d.customCssClass&&f.addClass(d.customCssClass)}f.addClass("js-hovercard-panel").setData("zmoduleuihovercardel",b);b.setData("zmoduleuihovercardwrapel",f);g=b.findUp(".js-hovercard-panel");0<g.count()&&b.setData("zmoduleuihovercardparentwrapel",g);var m=!1;b.longHover(function(){window.clearTimeout(m);
m=!1;w(a)},function(b){m=window.setTimeout(function(){p(a,d.hideWhenHoverCard?!1:b)},d.timeBeforeHide)},d.timeBeforeShow);if(!d.hideWhenHoverCard)f.on("mouseover",function(b){window.clearTimeout(m);m=!1}).on("mouseout",function(b){m=window.setTimeout(function(){p(a,b)},d.timeBeforeHide)});if(e)b.setData("zmoduleuihovercardcustomwrapel",!0);else{e=f.find(".zui-hovercard-panel-inner");if(g=b.getAttr(d.attribute,""))"title"==d.attribute&&(f.addClass("zui-tooltip"),b.removeAttr("title")),e.setInnerHTML(g);
e.setData("zmoduleuihovercardel",b);f.addClass("zui-uihide").removeClass("zui-uiuninithide")}}},w=function(a){var c=zjs(a),b=c.getData("zmoduleuihovercardoption"),d=c.getData("zmoduleuihovercardwrapel"),f=c.getData("zmoduleuihovercardcustomwrapel");if(d){if(!f)try{var e=c.getStyle("position","");""!=e&&"static"!=e||c.is("tr")||c.addClass("zui-hovercard-fix")}catch(t){}d.removeClass("zui-uihide").addClass("active");u(a);if(e=c.getData("zmoduleuihovercardparentwrapel")){var g=e.getData("zmoduleuihovercardwrapelbelongcount",
0).toInt()+1;e.setData("zmoduleuihovercardwrapelbelongcount",g)}if(!f&&b.ajaxContent&&!c.getData("zmoduleuihovercardajaxloaded")){d.addClass("ajax-loading");var m=d.find(".zui-hovercard-panel-inner");m.setInnerHTML(b.ajaxLoadingHtml);u(a);var n=function(b){c.setData("zmoduleuihovercardajaxloaded",!0);m.setInnerHTML(b);d.removeClass("ajax-loading");u(a)},q="aj"+b.ajaxContent.hashCode();if("undefined"!==typeof v[q])n(v[q]);else{var k=""!=b.ajaxContentDataStructure?"json":"html";zjs.ajax({url:b.ajaxContent,
dataType:k,success:function(a){var c=a;"json"===k&&zjs.isObject(a)&&(c=zjs.getValueByKey(a,b.ajaxContentDataStructure));c&&(v[q]=c,n(c))}})}}}},p=function(a,c){var b=zjs(a),d=b.getData("zmoduleuihovercardwrapel"),f=b.getData("zmoduleuihovercardcustomwrapel");if(d){var e=d.getData("zmoduleuihovercardwrapelbelongcount",0).toInt();if(!(0<e)){if(c){e=d.item(0,!0);try{for(var g=c.getToTarget();g;){if(g==e)return;if(g==document)break;g=g.parentNode}}catch(m){}}f?d.removeClass("active"):(b.removeClass("zui-hovercard-fix"),
d.addClass("zui-uihide").removeClass("active").removeClass("zui-left").removeClass("zui-right").removeClass("zui-top").removeClass("zui-bottom").top("auto").bottom("auto").left("auto").top("auto"));if(b=b.getData("zmoduleuihovercardparentwrapel"))e=b.getData("zmoduleuihovercardwrapelbelongcount",0).toInt()-1,0>e&&(e=0),b.setData("zmoduleuihovercardwrapelbelongcount",e),p(b.getData("zmoduleuihovercardel"),c)}}},u=function(a){var c=zjs(a),b=c.getData("zmoduleuihovercardwrapel"),d=c.getData("zmoduleuihovercardcustomwrapel");
if(b&&!d){var f=b.find(".zui-hovercard-panel-arrow");b.find(".zui-hovercard-panel-inner");d||b.removeClass("zui-left").removeClass("zui-right").removeClass("zui-top").removeClass("zui-bottom").top("auto").bottom("auto").left("auto").top("auto");var e=c.left(),g=c.right(),d=c.top(),m=c.bottom(),n=c.width(),q=c.height(),k=b.width(),t=b.height(),h=c.getData("zmoduleuihovercardoption"),l=h.horizontal,r=h.vertical;if(h.appendToBody){for(var e=c.getAbsoluteLeft(),g=c.getAbsoluteRight(),d=c.getAbsoluteTop(),
m=c.getAbsoluteBottom(),c="",p=!1;a&&a!=document.body;){try{if(c=zjs(a).getStyle("position"),"fixed"==c){p=!0;break}}catch(y){}a=a.parentNode}1==h.autoFixPosition&&(a=zjs(window),"top"==r&&zjs(document.body).height()-m-q-t<(p?0:document.body.scrollTop)&&(r="bottom"),"bottom"==r&&(c=a.height(),d+q+t>(p?0:document.body.scrollTop)+c&&(r="top")),"right"==l&&zjs(document.body).width()-g-n-k<document.body.scrollLeft&&(l="left"),"left"==l&&(t=a.width(),e+n+k>document.body.scrollLeft+t&&(l="right")))}else 1==
h.autoFixPosition&&("center"==l&&k/2>n/2+e&&(l="left"),"center"==l&&k/2>n/2+g&&(l="right"),"left"==l&&k>n+g&&(l="right"),"right"==l&&k>n+e&&(l="left"));"center"==l?(b.addClass("zui-left"),b.left(e-k/2+n/2),f.left(k/2).right("auto")):"left"==l?(b.addClass("zui-left"),b.left("auto"==h.left?e:parseInt(h.left)),h.autoFixArrowPosition&&(e="auto"==h.left?n/2:n/2+e-h.left,e>k/2&&(e=k/2),f.left(e).right("auto"))):"right"==l&&(b.addClass("zui-right"),b.right("auto"==h.right?g:parseInt(h.right)),h.autoFixArrowPosition&&
(e="auto"==h.right?n/2:n/2+g-h.right,e>k/2&&(e=k/2),f.right(e).left("auto")));"top"==r?(b.addClass("zui-top"),b.bottom("auto"==h.bottom?m+q:h.bottom)):"bottom"==r&&(b.addClass("zui-bottom"),b.top("auto"==h.top?d+q:h.top));p?b.addClass("zui-fixed"):b.removeClass("zui-fixed")}};zjs.extendMethod({makeHovercard:function(a){return this.eachElement(function(c){x(c,a)})},hovercardShow:function(a){return this.eachElement(function(a){w(a)})},hovercardHide:function(a){return this.eachElement(function(a){p(a,
!1)})},hovercardPanel:function(){var a=[];this.eachElement(function(c){(c=zjs(c).getData("zmoduleuihovercardwrapel"))&&a.push(c.item(0,!0))});return zjs(a)}});zjs.hook({after_setInnerHTML:function(a){a=zjs(a);a.find(".zhovercard").makeHovercard();a.find(".zhovercardcenter").makeHovercard({horizontal:"center"});a.find(".zhovercardleft").makeHovercard({horizontal:"left"});a.find(".zhovercardright").makeHovercard({horizontal:"right"});a.hasClass("zui-hovercard-panel-inner")&&u(a.getData("zmoduleuihovercardel"))},
after_insertDOM:function(a){zjs(a).hasClass("zhovercard")&&zjs(a).makeHovercard();zjs(a).hasClass("zhovercardcenter")&&zjs(a).makeHovercard({horizontal:"center"});zjs(a).hasClass("zhovercardleft")&&zjs(a).makeHovercard({horizontal:"left"});zjs(a).hasClass("zhovercardright")&&zjs(a).makeHovercard({horizontal:"right"});zjs(a).find(".zhovercard").makeHovercard();zjs(a).find(".zhovercardcenter").makeHovercard({horizontal:"center"});zjs(a).find(".zhovercardleft").makeHovercard({horizontal:"left"});zjs(a).find(".zhovercardright").makeHovercard({horizontal:"right"})}});
zjs.onready(function(){zjs(".zhovercard").makeHovercard();zjs(".zhovercardcenter").makeHovercard({horizontal:"center"});zjs(".zhovercardleft").makeHovercard({horizontal:"left"});zjs(".zhovercardright").makeHovercard({horizontal:"right"})});"required"in zjs&&zjs.required("ui.hovercard")});