zjs.require("ui",function(){"use strict";var t="zmoduleuihovercardoption",e="zmoduleuihovercardwrapel",o="zmoduleuihovercardel",a="zmoduleuihovercardajaxloaded",r="zmoduleuihovercardcustomwrapel",i="zmoduleuihovercardparentwrapel",n="zmoduleuihovercardwrapelbelongcount";zjs.extendCore({moduleUiHovercardOption:{timeBeforeShow:0,timeBeforeHide:200,attribute:"title",horizontal:"left",vertical:"top",autoFixPosition:!0,autoFixArrowPosition:!0,hideWhenHoverCard:!1,customCssClass:"",left:"auto",right:"auto",top:"auto",bottom:"auto",appendToBody:!1,ajaxContent:!1,ajaxContentDataStructure:"",ajaxLoadingHtml:'<div class="loading-icon"></div>',cacheAjax:!0,customContentElement:!1}});var s="zui-hovercard",d="zui-hovercard-fix",l="active",c="zui-uihide",u="zui-uiuninithide",v="js-hovercard-panel",h="zui-hovercard-panel-wrap",f="zui-fixed",m="zui-tooltip",z="zui-hovercard-panel-arrow",g="zui-hovercard-panel",j="zui-hovercard-panel-inner",p="ajax-loading",C="zui-left",b="zui-right",D="zui-top",H="zui-bottom",y='<div class="'+h+" "+u+'"><div class="'+z+'"></div><div class="'+g+'"><div class="'+j+'"></div></div></div>',x=[],w=function(a,n){var d=zjs(a),l=d.getData(t);if(l)d.setData(t,zjs.extend(l,n));else{l=zjs.clone(zjs.moduleUiHovercardOption);var h=d.getAttr("data-option","");zjs.isString(h)&&""!=h.trim()&&(l=zjs.extend(l,h.jsonDecode())),d.removeAttr("data-option"),void 0!==n&&(l=zjs.extend(l,n)),d.setData(t,l),d.addClass(s);var f,z=!1;if(zjs.isString(l.customContentElement))f=zjs(l.customContentElement),z=!0;else{if(f=zjs(y),l.appendToBody){var g=zjs(document.body).getStyle("position");""!=g&&"static"!=g||zjs(document.body).setStyle("position","relative"),f.appendTo(top.document.body).setStyle("z-index",10)}else f.insertAfter(d);""!=l.customCssClass&&f.addClass(l.customCssClass)}f.addClass(v).setData(o,d),d.setData(e,f);var p=d.findUp("."+v);p.count()>0&&d.setData(i,p);var C=!1;if(d.longHover(function(){window.clearTimeout(C),C=!1,k(a)},function(t){C=window.setTimeout(function(){T(a,!l.hideWhenHoverCard&&t)},l.timeBeforeHide)},l.timeBeforeShow),l.hideWhenHoverCard||f.on("mouseover",function(t){window.clearTimeout(C),C=!1}).on("mouseout",function(t){C=window.setTimeout(function(){T(a,t)},l.timeBeforeHide)}),z)d.setData(r,!0);else{var b=f.find("."+j),D=d.getAttr(l.attribute,"");D&&("title"==l.attribute&&(f.addClass(m),d.removeAttr("title")),b.setInnerHTML(D)),b.setData(o,d),f.addClass(c).removeClass(u)}}},k=function(o){var s=zjs(o),u=s.getData(t),v=s.getData(e),h=s.getData(r);if(v){if(!h)try{var f=s.getStyle("position","");""!=f&&"static"!=f||s.is("tr")||s.addClass(d)}catch(t){}v.removeClass(c).addClass(l),S(o),function(){S(o)}.delay(200);var m=s.getData(i);if(m){var z=m.getData(n,0).toInt()+1;m.setData(n,z)}if(!h&&u.ajaxContent&&!s.getData(a)){v.addClass(p);var g=v.find("."+j);g.setInnerHTML(u.ajaxLoadingHtml),S(o);var C=function(t){s.setData(a,!0),g.setInnerHTML(t),v.removeClass(p),S(o)},b="aj"+u.ajaxContent.hashCode();if(u.cacheAjax&&void 0!==x[b])return void C(x[b]);var D=""!=u.ajaxContentDataStructure?"json":"html";zjs.ajax({url:u.ajaxContent,dataType:D,success:function(t){var e=t;"json"===D&&zjs.isObject(t)&&(e=zjs.getValueByKey(t,u.ajaxContentDataStructure)),e&&(u.cacheAjax&&(x[b]=e),C(e))}})}}},T=function(t,a){var s=zjs(t),u=s.getData(e),v=s.getData(r);if(u){var h=u.getData(n,0).toInt();if(!(h>0)){if(a){var f=u.item(0,!0);try{for(var m=a.getToTarget();m;){if(m==f)return;if(m==document)break;m=m.parentNode}}catch(t){}}v?u.removeClass(l):(s.removeClass(d),u.addClass(c).removeClass(l).removeClass(C).removeClass(b).removeClass(D).removeClass(H).top("auto").bottom("auto").left("auto").top("auto"));var z=s.getData(i);z&&(h=z.getData(n,0).toInt()-1,h<0&&(h=0),z.setData(n,h),T(z.getData(o),a))}}},S=function(o){var a=zjs(o),i=a.getData(e),n=a.getData(r);if(i&&!n){var s=i.find("."+z);i.find("."+j);n||i.removeClass(C).removeClass(b).removeClass(D).removeClass(H).top("auto").bottom("auto").left("auto").top("auto");var d=a.left(),l=a.right(),c=a.top(),u=a.bottom(),v=a.width(),h=a.height(),m=i.width(),g=i.height(),p=a.getData(t),y=p.horizontal,x=p.vertical;if(p.appendToBody){var w=a.item(0,!0).getBoundingClientRect(),k=document.body.getBoundingClientRect();w&&k&&(c=w.top-k.top,d=w.left-k.left,l=k.width+k.left-w.left-w.width,u=k.height+k.top-w.top-w.height);for(var T=o,S="",B=!1;T&&T!=document.body;){try{if(S=zjs(T).getStyle("position"),"fixed"==S){B=!0;break}}catch(t){}T=T.parentNode}if(1==p.autoFixPosition){var L=zjs(window);if("top"==x){var A=zjs(document.body).height();A-u-h-g<(B?0:document.body.scrollTop||document.documentElement.scrollTop)&&(x="bottom")}if("bottom"==x){var E=L.height();c+h+g>(B?0:document.body.scrollTop||document.documentElement.scrollTop)+E&&(x="top")}if("left"==y){var I=L.width();d+v+m>document.body.scrollLeft+I&&(y="right")}if("right"==y){var P=zjs(document.body).width();P-l-v-m<document.body.scrollLeft&&(y="left")}}}else 1==p.autoFixPosition&&("center"==y&&m/2>v/2+d&&(y="left"),"center"==y&&m/2>v/2+l&&(y="right"),"left"==y&&m>v+l&&(y="right"),"right"==y&&m>v+d&&(y="left"));if("center"==y){var F=d-m/2+v/2,M=m/2;if(p.appendToBody){I=L.width();var O=F;F+m+10>document.body.scrollLeft+I&&(O=document.body.scrollLeft+I-m-10),F-10<document.body.scrollLeft&&(O=document.body.scrollLeft+10),F!==O&&(M-=O-F,F=O)}i.addClass(C),i.left(F),s.left(M).right("auto")}else if("left"==y){if(i.addClass(C),i.left("auto"==p.left?d:parseInt(p.left)),p.autoFixArrowPosition){M="auto"==p.left?v/2:v/2+d-p.left;M>m/2&&(M=m/2),s.left(M).right("auto")}}else if("right"==y&&(i.addClass(b),i.right("auto"==p.right?l:parseInt(p.right)),p.autoFixArrowPosition)){var q="auto"==p.right?v/2:v/2+l-p.right;q>m/2&&(q=m/2),s.right(q).left("auto")}"top"==x?(i.addClass(D),i.bottom("auto"==p.bottom?u+h:p.bottom)):"bottom"==x&&(i.addClass(H),i.top("auto"==p.top?c+h:p.top)),B?i.addClass(f):i.removeClass(f)}};zjs.extendMethod({makeHovercard:function(t){return this.eachElement(function(e){w(e,t)})},hovercardShow:function(t){return this.eachElement(function(t){k(t)})},hovercardHide:function(t){return this.eachElement(function(t){T(t,!1)})},hovercardPanel:function(){var t=[];return this.eachElement(function(o){var a=zjs(o).getData(e);a&&t.push(a.item(0,!0))}),zjs(t)}}),zjs.hook({after_setInnerHTML:function(t){var e=zjs(t);e.find(".zhovercard").makeHovercard(),e.find(".zhovercardcenter").makeHovercard({horizontal:"center"}),e.find(".zhovercardleft").makeHovercard({horizontal:"left"}),e.find(".zhovercardright").makeHovercard({horizontal:"right"}),e.hasClass(j)&&S(e.getData(o))},after_insertDOM:function(t){zjs(t).hasClass("zhovercard")&&zjs(t).makeHovercard(),zjs(t).hasClass("zhovercardcenter")&&zjs(t).makeHovercard({horizontal:"center"}),zjs(t).hasClass("zhovercardleft")&&zjs(t).makeHovercard({horizontal:"left"}),zjs(t).hasClass("zhovercardright")&&zjs(t).makeHovercard({horizontal:"right"}),zjs(t).find(".zhovercard").makeHovercard(),zjs(t).find(".zhovercardcenter").makeHovercard({horizontal:"center"}),zjs(t).find(".zhovercardleft").makeHovercard({horizontal:"left"}),zjs(t).find(".zhovercardright").makeHovercard({horizontal:"right"})}}),zjs.onready(function(){zjs(".zhovercard").makeHovercard(),zjs(".zhovercardcenter").makeHovercard({horizontal:"center"}),zjs(".zhovercardleft").makeHovercard({horizontal:"left"}),zjs(".zhovercardright").makeHovercard({horizontal:"right"})}),"required"in zjs&&zjs.required("ui.hovercard")});