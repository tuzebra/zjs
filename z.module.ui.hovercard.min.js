zjs.require("ui",function(){zjs.extendCore({moduleUiHovercardOption:{timeBeforeShow:0,timeBeforeHide:200,attribute:"title",horizontal:"left",vertical:"top",autoFixPosition:!0,autoFixArrowPosition:!0,hideWhenHoverCard:!1,customCssClass:"",left:"auto",right:"auto",top:"auto",bottom:"auto",appendToBody:!1,ajaxContent:!1,ajaxContentDataStructure:"",ajaxLoadingHtml:'<div class="loading-icon"></div>',cacheAjax:!0,customContentElement:!1}});var w=[],y=function(b,c){var a=zjs(b),d=a.getData("zmoduleuihovercardoption");
if(d)a.setData("zmoduleuihovercardoption",zjs.extend(d,c));else{var d=zjs.clone(zjs.moduleUiHovercardOption),g=a.getAttr("data-option","");zjs.isString(g)&&""!=g.trim()&&(d=zjs.extend(d,g.jsonDecode()));a.removeAttr("data-option");"undefined"!=typeof c&&(d=zjs.extend(d,c));a.setData("zmoduleuihovercardoption",d);a.addClass("zui-hovercard");var e=!1;if(zjs.isString(d.customContentElement))g=zjs(d.customContentElement),e=!0;else{g=zjs('<div class="zui-hovercard-panel-wrap zui-uiuninithide"><div class="zui-hovercard-panel-arrow"></div><div class="zui-hovercard-panel"><div class="zui-hovercard-panel-inner"></div></div></div>');
if(d.appendToBody){var f=zjs(document.body).getStyle("position");""!=f&&"static"!=f||zjs(document.body).setStyle("position","relative");g.appendTo(top.document.body).setStyle("z-index",10)}else g.insertAfter(a);""!=d.customCssClass&&g.addClass(d.customCssClass)}g.addClass("js-hovercard-panel").setData("zmoduleuihovercardel",a);a.setData("zmoduleuihovercardwrapel",g);f=a.findUp(".js-hovercard-panel");0<f.count()&&a.setData("zmoduleuihovercardparentwrapel",f);var m=!1;a.longHover(function(){window.clearTimeout(m);
m=!1;x(b)},function(a){m=window.setTimeout(function(){v(b,d.hideWhenHoverCard?!1:a)},d.timeBeforeHide)},d.timeBeforeShow);if(!d.hideWhenHoverCard)g.on("mouseover",function(a){window.clearTimeout(m);m=!1}).on("mouseout",function(a){m=window.setTimeout(function(){v(b,a)},d.timeBeforeHide)});if(e)a.setData("zmoduleuihovercardcustomwrapel",!0);else{e=g.find(".zui-hovercard-panel-inner");if(f=a.getAttr(d.attribute,""))"title"==d.attribute&&(g.addClass("zui-tooltip"),a.removeAttr("title")),e.setInnerHTML(f);
e.setData("zmoduleuihovercardel",a);g.addClass("zui-uihide").removeClass("zui-uiuninithide")}}},x=function(b){var c=zjs(b),a=c.getData("zmoduleuihovercardoption"),d=c.getData("zmoduleuihovercardwrapel"),g=c.getData("zmoduleuihovercardcustomwrapel");if(d){if(!g)try{var e=c.getStyle("position","");""!=e&&"static"!=e||c.is("tr")||c.addClass("zui-hovercard-fix")}catch(r){}d.removeClass("zui-uihide").addClass("active");q(b);(function(){q(b)}).delay(200);if(e=c.getData("zmoduleuihovercardparentwrapel")){var f=
e.getData("zmoduleuihovercardwrapelbelongcount",0).toInt()+1;e.setData("zmoduleuihovercardwrapelbelongcount",f)}if(!g&&a.ajaxContent&&!c.getData("zmoduleuihovercardajaxloaded")){d.addClass("ajax-loading");var m=d.find(".zui-hovercard-panel-inner");m.setInnerHTML(a.ajaxLoadingHtml);q(b);var n=function(a){c.setData("zmoduleuihovercardajaxloaded",!0);m.setInnerHTML(a);d.removeClass("ajax-loading");q(b)},t="aj"+a.ajaxContent.hashCode();if(a.cacheAjax&&"undefined"!==typeof w[t])n(w[t]);else{var k=""!=
a.ajaxContentDataStructure?"json":"html";zjs.ajax({url:a.ajaxContent,dataType:k,success:function(b){var c=b;"json"===k&&zjs.isObject(b)&&(c=zjs.getValueByKey(b,a.ajaxContentDataStructure));c&&(a.cacheAjax&&(w[t]=c),n(c))}})}}}},v=function(b,c){var a=zjs(b),d=a.getData("zmoduleuihovercardwrapel"),g=a.getData("zmoduleuihovercardcustomwrapel");if(d){var e=d.getData("zmoduleuihovercardwrapelbelongcount",0).toInt();if(!(0<e)){if(c){e=d.item(0,!0);try{for(var f=c.getToTarget();f;){if(f==e)return;if(f==
document)break;f=f.parentNode}}catch(m){}}g?d.removeClass("active"):(a.removeClass("zui-hovercard-fix"),d.addClass("zui-uihide").removeClass("active").removeClass("zui-left").removeClass("zui-right").removeClass("zui-top").removeClass("zui-bottom").top("auto").bottom("auto").left("auto").top("auto"));if(a=a.getData("zmoduleuihovercardparentwrapel"))e=a.getData("zmoduleuihovercardwrapelbelongcount",0).toInt()-1,0>e&&(e=0),a.setData("zmoduleuihovercardwrapelbelongcount",e),v(a.getData("zmoduleuihovercardel"),
c)}}},q=function(b){var c=zjs(b),a=c.getData("zmoduleuihovercardwrapel"),d=c.getData("zmoduleuihovercardcustomwrapel");if(a&&!d){var g=a.find(".zui-hovercard-panel-arrow");a.find(".zui-hovercard-panel-inner");d||a.removeClass("zui-left").removeClass("zui-right").removeClass("zui-top").removeClass("zui-bottom").top("auto").bottom("auto").left("auto").top("auto");var e=c.left(),f=c.right(),d=c.top(),m=c.bottom(),n=c.width(),t=c.height(),k=a.width(),r=a.height(),h=c.getData("zmoduleuihovercardoption"),
l=h.horizontal,u=h.vertical;if(h.appendToBody){for(var e=c.getAbsoluteLeft(),f=c.getAbsoluteRight(),d=c.getAbsoluteTop(),m=c.getAbsoluteBottom(),c="",q=!1;b&&b!=document.body;){try{if(c=zjs(b).getStyle("position"),"fixed"==c){q=!0;break}}catch(z){}b=b.parentNode}if(1==h.autoFixPosition){var p=zjs(window);"top"==u&&zjs(document.body).height()-m-t-r<(q?0:document.body.scrollTop)&&(u="bottom");"bottom"==u&&(b=p.height(),d+t+r>(q?0:document.body.scrollTop)+b&&(u="top"));"left"==l&&(r=p.width(),e+n+k>
document.body.scrollLeft+r&&(l="right"));"right"==l&&zjs(document.body).width()-f-n-k<document.body.scrollLeft&&(l="left")}}else 1==h.autoFixPosition&&("center"==l&&k/2>n/2+e&&(l="left"),"center"==l&&k/2>n/2+f&&(l="right"),"left"==l&&k>n+f&&(l="right"),"right"==l&&k>n+e&&(l="left"));"center"==l?(e=e-k/2+n/2,f=k/2,h.appendToBody&&(r=p.width(),p=e,e+k+10>document.body.scrollLeft+r&&(p=document.body.scrollLeft+r-k-10),e-10<document.body.scrollLeft&&(p=document.body.scrollLeft+10),e!==p&&(f-=p-e,e=p)),
a.addClass("zui-left"),a.left(e),g.left(f).right("auto")):"left"==l?(a.addClass("zui-left"),a.left("auto"==h.left?e:parseInt(h.left)),h.autoFixArrowPosition&&(f="auto"==h.left?n/2:n/2+e-h.left,f>k/2&&(f=k/2),g.left(f).right("auto"))):"right"==l&&(a.addClass("zui-right"),a.right("auto"==h.right?f:parseInt(h.right)),h.autoFixArrowPosition&&(p="auto"==h.right?n/2:n/2+f-h.right,p>k/2&&(p=k/2),g.right(p).left("auto")));"top"==u?(a.addClass("zui-top"),a.bottom("auto"==h.bottom?m+t:h.bottom)):"bottom"==
u&&(a.addClass("zui-bottom"),a.top("auto"==h.top?d+t:h.top));q?a.addClass("zui-fixed"):a.removeClass("zui-fixed")}};zjs.extendMethod({makeHovercard:function(b){return this.eachElement(function(c){y(c,b)})},hovercardShow:function(b){return this.eachElement(function(b){x(b)})},hovercardHide:function(b){return this.eachElement(function(b){v(b,!1)})},hovercardPanel:function(){var b=[];this.eachElement(function(c){(c=zjs(c).getData("zmoduleuihovercardwrapel"))&&b.push(c.item(0,!0))});return zjs(b)}});
zjs.hook({after_setInnerHTML:function(b){b=zjs(b);b.find(".zhovercard").makeHovercard();b.find(".zhovercardcenter").makeHovercard({horizontal:"center"});b.find(".zhovercardleft").makeHovercard({horizontal:"left"});b.find(".zhovercardright").makeHovercard({horizontal:"right"});b.hasClass("zui-hovercard-panel-inner")&&q(b.getData("zmoduleuihovercardel"))},after_insertDOM:function(b){zjs(b).hasClass("zhovercard")&&zjs(b).makeHovercard();zjs(b).hasClass("zhovercardcenter")&&zjs(b).makeHovercard({horizontal:"center"});
zjs(b).hasClass("zhovercardleft")&&zjs(b).makeHovercard({horizontal:"left"});zjs(b).hasClass("zhovercardright")&&zjs(b).makeHovercard({horizontal:"right"});zjs(b).find(".zhovercard").makeHovercard();zjs(b).find(".zhovercardcenter").makeHovercard({horizontal:"center"});zjs(b).find(".zhovercardleft").makeHovercard({horizontal:"left"});zjs(b).find(".zhovercardright").makeHovercard({horizontal:"right"})}});zjs.onready(function(){zjs(".zhovercard").makeHovercard();zjs(".zhovercardcenter").makeHovercard({horizontal:"center"});
zjs(".zhovercardleft").makeHovercard({horizontal:"left"});zjs(".zhovercardright").makeHovercard({horizontal:"right"})});"required"in zjs&&zjs.required("ui.hovercard")});